define([],function(){let a={READY:"ready",SPEAKING:"speaking",PAUSED:"paused",STOPPED:"stopped"},s=null,S=null,c="",p={},u=a.READY,g=0,h="speechSynthesis"in window;function l(){if(h)return(s=s||window.speechSynthesis).onvoiceschanged=()=>{p.onVoicesChanged&&p.onVoicesChanged(e())},u=a.READY,1;console.error("Web Speech Synthesis is not supported in this browser")}function n(i,r={}){return new Promise((e,n)=>{var o,t;h?s||l()?(p={onStateChange:r.onStateChange||null,onSpeaking:r.onSpeaking||null,onVoicesChanged:r.onVoicesChanged||null,lang:r.lang||"en-US",volume:void 0!==r.volume?r.volume:1,rate:void 0!==r.rate?r.rate:1,pitch:void 0!==r.pitch?r.pitch:1,voice:r.voice||null},u!==a.PAUSED||i?(E(),i&&(c=i,g=0),(S=new SpeechSynthesisUtterance(c.substring(g))).lang=p.lang,S.volume=p.volume,S.rate=p.rate,S.pitch=p.pitch,p.voice&&(S.voice=p.voice),S.onstart=()=>{A(a.SPEAKING),p.onSpeaking&&p.onSpeaking(!0)},S.onend=()=>{u!==a.PAUSED&&(g=0,A(a.READY),p.onSpeaking&&p.onSpeaking(!1),e())},S.onerror=e=>{e=new Error("Speech error: "+e.error);A(a.READY),p.onSpeaking&&p.onSpeaking(!1),n(e)},S.onpause=()=>{var e=(()=>{var e,n;return S&&u===a.SPEAKING?(e=1e3/(5*p.rate),n=Date.now()-S.startTime,n=Math.floor(n/e),Math.min(g+n,c.length)):g})();e>g&&(g=e),A(a.PAUSED),p.onSpeaking&&p.onSpeaking(!1)},S.onresume=()=>{A(a.SPEAKING),p.onSpeaking&&p.onSpeaking(!0)},s.speak(S)):(o=e,t=n,u===a.PAUSED&&S?(S.text=c.substring(g),S.onend=()=>{g=0,A(a.READY),p.onSpeaking&&p.onSpeaking(!1),o()},s.resume()):t(new Error("No speech to resume")))):n(new Error("Failed to initialize speech synthesis")):n(new Error("Web Speech Synthesis is not supported"))})}function o(){return!(!h||!s||u!==a.SPEAKING||(s.pause(),0))}function E(){return!(!h||!s||u!==a.SPEAKING&&u!==a.PAUSED||(s.cancel(),g=0,A(a.STOPPED),p.onSpeaking&&p.onSpeaking(!1),0))}function e(){return h&&s?s.getVoices():[]}function A(e){var n;u!==e&&(n=u,u=e,p.onStateChange)&&p.onStateChange(e,n)}return h&&l(),{STATES:a,isSupported:h,speak:n,pause:o,stop:E,resume:()=>n(),getState:function(){return u},isSpeaking:function(){return u===a.SPEAKING},isPaused:function(){return u===a.PAUSED},getAvailableVoices:e,setVoice:function(e){p.voice=e,u===a.SPEAKING&&(o(),setTimeout(()=>{n().catch(e=>console.error("Failed to restart speech:",e))},100))}}});