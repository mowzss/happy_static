((t,e)=>{"function"==typeof define&&define.amd?define([],function(){return e(t,t.document)}):"object"==typeof module&&module.exports?module.exports=e(t,t.document):t.TextToSpeech=e(t,t.document)})("undefined"!=typeof window?window:global,function(p,r){if(!("speechSynthesis"in p))return console.warn("当前浏览器不支持 Web Speech API，语音功能不可用。"),null;function t(t,e){this.isSpeaking=!1,t?this.initWithConfig(t,e||{}):this.initAuto()}t.prototype.initAuto=function(){var o=this,t=r.querySelectorAll("[data-speech]");Array.prototype.forEach.call(t,function(t){var e=t.getAttribute("data-speech"),n=r.querySelector(e);n?o.bindButton(t,function(){return o.getTextContent(n)},t):console.warn("未找到目标元素:",e)})},t.prototype.initWithConfig=function(t,e){var n,o,a=this,i="string"==typeof t?r.querySelector(t):t;i?(n=e.target||i.getAttribute("data-speech"),(o="string"==typeof n?r.querySelector(n):n)?this.bindButton(i,function(){return a.getTextContent(o)},i,e):console.error("未找到目标元素:",n)):console.error("未找到按钮元素:",t)},t.prototype.getTextContent=function(t){var e=t.tagName;return("TEXTAREA"===e||"INPUT"===e&&["text","search","email","url","tel"].includes(t.type)?t.value:t.innerText).trim()},t.prototype.bindButton=function(n,o,a,i){var r=this;n.addEventListener("click",function(t){t.preventDefault();var e,t=o();t?(e=r.mergeConfig(n,i),r.isSpeaking?(p.speechSynthesis.cancel(),r.isSpeaking=!1,r.updateButtonState(a,"play",e)):(p.speechSynthesis.cancel(),(t=new SpeechSynthesisUtterance(t)).lang=e.lang,t.rate=e.rate,t.pitch=e.pitch,t.volume=e.volume,t.onstart=function(){r.isSpeaking=!0,r.updateButtonState(a,"stop",e)},t.onend=function(){r.isSpeaking=!1,r.updateButtonState(a,"play",e)},t.onerror=function(t){r.isSpeaking=!1,r.updateButtonState(a,"play",e),console.error("语音朗读出错:",t.error||"Unknown error"),p.speechSynthesis.cancel()},p.speechSynthesis.speak(t))):alert("没有可朗读的文本内容。")})},t.prototype.mergeConfig=function(t,e){return{lang:e.lang||t.getAttribute("data-lang")||"zh-CN",rate:parseFloat(e.rate)||parseFloat(t.getAttribute("data-rate"))||1,pitch:parseFloat(e.pitch)||parseFloat(t.getAttribute("data-pitch"))||1,volume:parseFloat(e.volume)||parseFloat(t.getAttribute("data-volume"))||1,playText:e.playText||t.getAttribute("data-play-text")||"朗读",stopText:e.stopText||t.getAttribute("data-stop-text")||"停止"}},t.prototype.updateButtonState=function(t,e,n){t.textContent="play"===e?n.playText:n.stopText},"function"==typeof define&&define.amd||("loading"===r.readyState?r.addEventListener("DOMContentLoaded",function(){new t}):new t);function e(){p.speechSynthesis&&p.speechSynthesis.cancel()}return p.addEventListener("beforeunload",e),p.addEventListener("pagehide",e),t});