((t,e)=>{"function"==typeof define&&define.amd?define([],function(){return e(t,t.document)}):"object"==typeof module&&module.exports?module.exports=e(t,t.document):t.TextToSpeech=e(t,t.document)})("undefined"!=typeof window?window:global,function(a,o){return"speechSynthesis"in a?(t.prototype.init=function(){var n=this,t=o.querySelectorAll(this.options.selector);Array.prototype.forEach.call(t,function(e){n.setDefaultButtonText(e),e.addEventListener("click",function(t){t.preventDefault(),n.handleSpeechClick(e)})})},t.prototype.handleSpeechClick=function(t){var e,n=t.getAttribute("data-speech");n&&"string"==typeof n?(e=o.querySelector(n))?(e=this.extractText(e))?this.isSpeaking?this.stopSpeech():this.speak(e,t):this.showMessage("没有可朗读的文本内容。","warning"):this.showMessage("未找到元素: "+n,"error"):this.showMessage("缺少 data-speech 属性","error")},t.prototype.extractText=function(t){var e=t.tagName;return("TEXTAREA"===e||"INPUT"===e&&["text","search","email","url","tel"].includes(t.type)?t.value:t.innerText||t.textContent).trim()},t.prototype.speak=function(t,e){var n=this,o=parseFloat(e.getAttribute("data-rate"))||1,i=parseFloat(e.getAttribute("data-pitch"))||1,r=parseFloat(e.getAttribute("data-volume"))||1,s=e.getAttribute("data-lang")||"zh-CN";this.utterance=new SpeechSynthesisUtterance(t),this.utterance.lang=s,this.utterance.rate=o,this.utterance.pitch=i,this.utterance.volume=r,this.utterance.onstart=function(){n.isSpeaking=!0,n.currentButton=e,n.updateButtonState(e,"stop")},this.utterance.onend=function(){n.isSpeaking=!1,n.currentButton=null,n.updateButtonState(e,"play"),n.showMessage("朗读完成","success")},this.utterance.onerror=function(t){n.isSpeaking=!1,n.currentButton=null,n.updateButtonState(e,"play"),["interrupted","cancelled"].includes(t.error)||n.showMessage("语音朗读失败: "+t.error,"error")},a.speechSynthesis.speak(this.utterance)},t.prototype.stopSpeech=function(){this.isSpeaking&&(a.speechSynthesis.cancel(),this.isSpeaking=!1,this.currentButton&&this.updateButtonState(this.currentButton,"play"),this.currentButton=null)},t.prototype.updateButtonState=function(t,e){e="play"===e?t.getAttribute("data-play-text")||this.options.playText:t.getAttribute("data-stop-text")||this.options.stopText;t.textContent=e},t.prototype.setDefaultButtonText=function(t){t.textContent.trim()||(t.textContent=t.getAttribute("data-play-text")||this.options.playText)},t.prototype.showMessage=function(t,e){var n;this.options.silent||(n={success:{icon:1,time:2e3},error:{icon:2,time:3e3},warning:{icon:0,time:2500},info:{icon:-1,time:2e3}},"undefined"!=typeof layer&&"function"==typeof layer.msg?layer.msg(t,n[e]||n.info):(n={success:"✅",error:"❌",warning:"⚠️",info:"ℹ️"}[e]||"ℹ️",console["error"===e?"error":"warning"===e?"warn":"log"]("[语音]",t),"undefined"!=typeof alert&&alert(n+" "+t)))},"function"==typeof define&&define.amd||("loading"===o.readyState?o.addEventListener("DOMContentLoaded",function(){new t}):new t),["beforeunload","pagehide"].forEach(function(t){a.addEventListener(t,function(){a.speechSynthesis&&a.speechSynthesis.cancel()})}),t):(console.warn("当前浏览器不支持 Web Speech API，语音功能不可用。"),null);function t(t){this.isSpeaking=!1,this.utterance=null,this.currentButton=null,this.options=Object.assign({playText:"朗读",stopText:"停止",selector:"[data-speech]",silent:!1},t||{}),this.init()}});