var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(e){for(var t,n=1,a=arguments.length;n<a;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};import{monthToStr}from"../../utils/formatting";import{clearNode,getEventTarget}from"../../utils/dom";var defaultConfig={shorthand:!1,dateFormat:"F Y",altFormat:"F Y",theme:"light"};function monthSelectPlugin(e){var i=__assign(__assign({},defaultConfig),e);return function(c){c.config.dateFormat=i.dateFormat,c.config.altFormat=i.altFormat;var l={monthsContainer:null};function t(){if(l.monthsContainer){clearNode(l.monthsContainer);for(var e=document.createDocumentFragment(),t=0;t<12;t++){var n=c.createDay("flatpickr-monthSelect-month",new Date(c.currentYear,t),0,t);n.dateObj.getMonth()===(new Date).getMonth()&&n.dateObj.getFullYear()===(new Date).getFullYear()&&n.classList.add("today"),n.textContent=monthToStr(t,i.shorthand,c.l10n),n.addEventListener("click",o),e.appendChild(n)}l.monthsContainer.appendChild(e),c.config.minDate&&c.currentYear===c.config.minDate.getFullYear()?c.prevMonthNav.classList.add("flatpickr-disabled"):c.prevMonthNav.classList.remove("flatpickr-disabled"),c.config.maxDate&&c.currentYear===c.config.maxDate.getFullYear()?c.nextMonthNav.classList.add("flatpickr-disabled"):c.nextMonthNav.classList.remove("flatpickr-disabled")}}function a(){if(c.rContainer&&c.selectedDates.length){for(var e=c.rContainer.querySelectorAll(".flatpickr-monthSelect-month.selected"),t=0;t<e.length;t++)e[t].classList.remove("selected");var n=c.selectedDates[0].getMonth(),n=c.rContainer.querySelector(".flatpickr-monthSelect-month:nth-child("+(n+1)+")");n&&n.classList.add("selected")}}function n(){var e=c.selectedDates[0];e&&((e=new Date(e)).setFullYear(c.currentYear),c.config.minDate&&e<c.config.minDate&&(e=c.config.minDate),c.config.maxDate&&e>c.config.maxDate&&(e=c.config.maxDate),c.currentYear=e.getFullYear()),c.currentYearElement.value=String(c.currentYear),c.rContainer&&c.rContainer.querySelectorAll(".flatpickr-monthSelect-month").forEach(function(e){e.dateObj.setFullYear(c.currentYear),c.config.minDate&&e.dateObj<c.config.minDate||c.config.maxDate&&e.dateObj>c.config.maxDate?e.classList.add("flatpickr-disabled"):e.classList.remove("flatpickr-disabled")}),a()}function o(e){e.preventDefault(),e.stopPropagation();var t,e=getEventTarget(e);e instanceof Element&&(e.classList.contains("flatpickr-disabled")||e.classList.contains("notAllowed")||(s(e.dateObj),c.config.closeOnSelect&&(e="single"===c.config.mode,t="range"===c.config.mode&&2===c.selectedDates.length,e||t)&&c.close()))}function s(e){var t=new Date(c.currentYear,e.getMonth(),e.getDate()),n=[];switch(c.config.mode){case"single":n=[t];break;case"multiple":n.push(t);break;case"range":2===c.selectedDates.length?n=[t]:(n=c.selectedDates.concat([t])).sort(function(e,t){return e.getTime()-t.getTime()})}c.setDate(n,!0),a()}var d={37:-1,39:1,40:3,38:-3};function r(){var e;"range"===(null==(e=c.config)?void 0:e.mode)&&1===c.selectedDates.length&&c.clear(!1),c.selectedDates.length||t()}return{onParseConfig:function(){c.config.enableTime=!1},onValueUpdate:a,onKeyDown:function(e,t,n,a){var o,r,i=void 0!==d[a.keyCode];(i||13===a.keyCode)&&c.rContainer&&l.monthsContainer&&(r=c.rContainer.querySelector(".flatpickr-monthSelect-month.selected"),-1===(o=Array.prototype.indexOf.call(l.monthsContainer.children,document.activeElement))&&((r=r||l.monthsContainer.firstElementChild).focus(),o=r.$i),i?l.monthsContainer.children[(12+o+d[a.keyCode])%12].focus():13===a.keyCode&&l.monthsContainer.contains(document.activeElement)&&s(document.activeElement.dateObj))},onReady:[function(){i._stubbedCurrentMonth=c._initialDate.getMonth(),c._initialDate.setMonth(i._stubbedCurrentMonth),c.currentMonth=i._stubbedCurrentMonth},function(){if(c.rContainer){clearNode(c.rContainer);for(var e=0;e<c.monthElements.length;e++){var t=c.monthElements[e];t.parentNode&&t.parentNode.removeChild(t)}}},function(){c.rContainer&&(l.monthsContainer=c._createElement("div","flatpickr-monthSelect-months"),l.monthsContainer.tabIndex=-1,t(),c.rContainer.appendChild(l.monthsContainer),c.calendarContainer.classList.add("flatpickr-monthSelect-theme-"+i.theme))},function(){c._bind(c.prevMonthNav,"click",function(e){e.preventDefault(),e.stopPropagation(),c.changeYear(c.currentYear-1),n(),t()}),c._bind(c.nextMonthNav,"click",function(e){e.preventDefault(),e.stopPropagation(),c.changeYear(c.currentYear+1),n(),t()}),c._bind(l.monthsContainer,"mouseover",function(e){"range"===c.config.mode&&c.onMouseOver(getEventTarget(e),"flatpickr-monthSelect-month")})},a,function(){c.config.onClose.push(r),c.loadedPlugins.push("monthSelect")}],onDestroy:[function(){i._stubbedCurrentMonth&&(c._initialDate.setMonth(i._stubbedCurrentMonth),c.currentMonth=i._stubbedCurrentMonth,delete i._stubbedCurrentMonth)},function(){if(null!==l.monthsContainer)for(var e=l.monthsContainer.querySelectorAll(".flatpickr-monthSelect-month"),t=0;t<e.length;t++)e[t].removeEventListener("click",o)},function(){c.config.onClose=c.config.onClose.filter(function(e){return e!==r})}]}}}export default monthSelectPlugin;