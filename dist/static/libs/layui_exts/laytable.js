layui.define(["jquery","table","layer","treeTable","admin","fieldHandler"],function(e){var r=layui.jquery,l=layui.table,d=layui.treeTable,u=layui.layer,c=layui.fieldHandler;function s(e,t){let a=new URLSearchParams;var n,o,l;for(o in e.includes("?")&&([n,i]=e.split("?",2),a=new URLSearchParams(i),e=n),t)t.hasOwnProperty(o)&&(l=t[o],a.has(o)?(console.log(`Parameter "${o}" already exists and its value will be updated.`),a.set(o,l)):(console.log(`Adding new parameter "${o}".`),a.append(o,l)));var i=a.toString();return i&&(e+=(e.includes("?")?"&":"?")+i),e}e("laytable",{eventListeners:{},render:function(e){var o=this,i=((()=>{var e,t,a=new URLSearchParams(window.location.search),n={};for([e,t]of a.entries())"undefined"!==t&&""!==t&&(n[e]=t)})(),r.extend(!0,{},{where:{},on:{},isTree:!1,even:!0,skin:"row",autoSort:!1,tree:{},limit:"20",limits:[10,20,30,40,50,60,70,80,90,100,150,200],parseData:function(e){return{code:e.code,msg:e.msg,count:e.data.total,data:e.data.data}},loading:!0,initSort:{field:"id",type:"desc"}},e)),a=(i.toolbar||(i.toolbar=i.elem+"-toolbarTop"),i.url||(i.url=r(i.elem).data("url")),c.init(i),{add:function(e,t,a){o.defaultSaveHandler(this,i.dataUrls.add,function(){o.reload(e.config.id)})},del:function(e,t,a){var n=l.checkStatus(e.config.id).data.map(function(e){return e.id});o.defaultDeleteHandler(i.dataUrls.del,n,function(){o.reload(e.config.id)})}}),n={del:function(e,t,a){var n=e.data.id;o.defaultDeleteHandler(i.dataUrls.del,n,function(){o.reload(e.config.id)})},edit:function(e,t,a){var n=s(i.dataUrls.edit,{id:e.data.id});o.defaultSaveHandler(this,n,function(){o.reload(e.config.id)})}};if(e.toolEvent&&r.extend(!0,n,e.toolEvent),e.toolbarEvent&&r.extend(!0,a,e.toolbarEvent),i.on.toolbar||(i.on.toolbar=function(e){if(e.config.elem.selector!==i.elem)return!1;var t=a[e.event];"function"==typeof t&&t.call(this,e,function(){o.reload(e.config.id)},i.defaultDeleteHandler)}),i.on.tool||(i.on.tool=function(e){if(e.config.elem.selector!==i.elem)return!1;var t=n[e.event];"function"==typeof t&&t.call(this,e,function(){o.reload(e.config.id)},i.defaultDeleteHandler)}),i.on.sort||(i.on.sort=function(e){if(e.config.elem.selector!==i.elem)return!1;o.reload(e.config.id,{initSort:e,where:{_order:e.field,_by:e.type}})}),i.on.edit||(i.on.edit=function(a){var n,o,l,e;return a.config.elem.selector===i.elem&&(n=u.load(),o=a.field,l=a.value,e=a.data,a.getCol(),e=s(i.dataUrls.quick,{id:e.id}),""===l.replace(/\s/g,"")?(u.tips("值不能为空",this,{tips:1}),a.reedit()):void r.ajax({url:e,type:"POST",dataType:"json",data:{field:o,value:l},success:function(e){var t;u.close(n),0===e.code?(u.msg(e.msg,this,{tips:1}),(t={})[o]=l,a.update(t,!0)):1<=e.code&&u.msg(e.msg)},error:function(e,t,a){u.close(n),u.msg("网络请求失败")}}))}),i.isTree)for(var t in d.render(i),i.on)i.on.hasOwnProperty(t)&&d.on(t,i.on[t]);else for(var t in l.render(i),i.on)i.on.hasOwnProperty(t)&&l.on(t,i.on[t]);return o},reload:function(a,e){if(null==a){let e=r("#content"),t;if(0===(t=1===(t=e.find(".pear-tab-page.layui-tab-rollTool.layui-tab")).length?t.find(".layui-show.layui-tab-item .layui-hide.page-Table"):t.find("layui-hide.page-Table")).length)return;a=t.attr("id")}let t;(t=d&&r("#"+a).hasClass("layui-tree-table")?d:l).reload(a,e)},defaultDeleteHandler:function(t,a,n){u.confirm("确认删除？",function(e){r.ajax({url:t,type:"POST",data:{ids:a},success:function(e){0===e.code?(u.msg("删除成功"),n()):u.msg("删除失败: "+e.msg)},error:function(){u.msg("请求出错")}}),u.close(e)})},defaultSaveHandler:function(e,t,a){t=r("<a></a>").attr({href:t,"data-modal":t,style:"display:none;","data-remove-after-click":!0}).text(r(e).text());r("body").append(t),t.trigger("click")}})});