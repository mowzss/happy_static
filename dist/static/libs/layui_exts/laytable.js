layui.define(["jquery","table","layer","treeTable","admin","fieldHandler"],function(e){var i=layui.jquery,r=layui.table,d=layui.treeTable,u=layui.layer,c=layui.fieldHandler;function s(e,t){let n=new URLSearchParams;var a,o,r;for(o in e.includes("?")&&([a,l]=e.split("?",2),n=new URLSearchParams(l),e=a),t)t.hasOwnProperty(o)&&(r=t[o],n.has(o)?n.set(o,r):n.append(o,r));var l=n.toString();return l&&(e+=(e.includes("?")?"&":"?")+l),e}e("laytable",{eventListeners:{},render:function(e){var o=this,l=i.extend(!0,{},{elem:"#happyTable",where:{},on:{},isTree:!1,even:!0,skin:"row",autoSort:!1,tree:{},limit:"20",limits:[10,20,30,40,50,60,70,80,90,100,150,200],parseData:function(e){return{code:e.code,msg:e.msg,count:e.data.total,data:e.data.data}},loading:!0,initSort:{field:"id",type:"desc"},rightEdit:!0},e),n=(l.toolbar||(l.toolbar=l.elem+"ToolbarTop"),l.layFilters||(l.layFilters=l.elem.replace(/^#/,"")),l.url||(l.url=i(l.elem).data("url")),l.page||(l.limit="300"),c.init(l),{add:function(e,t,n){o.defaultSaveHandler(this,l.dataUrls.add,function(){o.reload(e.config.id)})},del:function(e,t,n){var a=r.checkStatus(e.config.id).data.map(function(e){return e.id});o.defaultDeleteHandler(l.dataUrls.del,a,function(){o.reload(e.config.id)})}}),a={del:function(e,t,n){var a=e.data.id;o.defaultDeleteHandler(l.dataUrls.del,a,function(){o.reload(e.config.id)})},edit:function(e,t,n){var a=s(l.dataUrls.edit,{id:e.data.id});o.defaultSaveHandler(this,a,function(){o.reload(e.config.id)})}};if(e.toolEvent&&i.extend(!0,a,e.toolEvent),e.toolbarEvent&&i.extend(!0,n,e.toolbarEvent),l.on.toolbar||(l.on.toolbar=function(e){if(e.config.elem.selector!==l.elem)return!1;var t=n[e.event];"function"==typeof t&&t.call(this,e,function(){o.reload(e.config.id)},l.defaultDeleteHandler)}),l.on.tool||(l.on.tool=function(e){if(e.config.elem.selector!==l.elem)return!1;var t=a[e.event];"function"==typeof t&&t.call(this,e,function(){o.reload(e.config.id)},l.defaultDeleteHandler)}),l.on.sort||(l.on.sort=function(e){if(e.config.elem.selector!==l.elem)return!1;o.reload(e.config.id,{initSort:e,where:{_order:e.field,_by:e.type}})}),l.on.edit||(l.on.edit=function(n){var a,o,r,e;return n.config.elem.selector===l.elem&&(a=u.load(),o=n.field,r=n.value,e=n.data,n.getCol(),e=s(l.dataUrls.quick,{id:e.id}),""===r.replace(/\s/g,"")?(u.tips("值不能为空",this,{tips:1}),n.reedit()):void i.ajax({url:e,type:"POST",dataType:"json",data:{field:o,value:r},success:function(e){var t;u.close(a),0===e.code?(u.msg(e.msg,this,{tips:1}),(t={})[o]=r,n.update(t,!0)):1<=e.code&&u.msg(e.msg)},error:function(e,t,n){u.close(a),u.msg("网络请求失败")}}))}),l.isTree)for(var t in d.render(l),l.on)l.on.hasOwnProperty(t)&&d.on(t+"("+l.layFilters+")",l.on[t]);else for(var t in r.render(l),l.on)l.on.hasOwnProperty(t)&&r.on(t+"("+l.layFilters+")",l.on[t]);return o},reload:function(n,e){if(null==n){let e=i("#happy-content"),t;if(0===(t=(t=e.find(".layui-body-tabs ")).find(".layui-tab-item .layui-show .page-Table")).length)return;n=t.attr("id")}let t;(t=d&&i("#"+n).hasClass("layui-tree-table")?d:r).reload(n,e)},defaultDeleteHandler:function(t,n,a){u.confirm("确认删除？",function(e){i.ajax({url:t,type:"POST",data:{ids:n},success:function(e){0===e.code?(u.msg("删除成功"),a()):u.msg("删除失败: "+e.msg)},error:function(){u.msg("请求出错")}}),u.close(e)})},defaultSaveHandler:function(e,t,n){let a=i(e).text(),o=i(window).width(),r=1400<=o?"800px":"80%";r="800px",i.ajax({url:t,method:"GET",success:function(e){if(e.code)return u.msg(e.msg);u.open({type:1,title:a,content:e,area:[r,"auto"]})},error:function(e,t,n){console.error("Error:",t,n),u.msg("请求失败: "+t+", "+n,{icon:5})}})}})});