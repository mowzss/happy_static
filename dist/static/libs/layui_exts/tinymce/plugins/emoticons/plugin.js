(()=>{var e,a,t=tinymce.util.Tools.resolve("tinymce.PluginManager"),r=t=>e=>t===e;let s=r(null),n=r(void 0),o=()=>{},l=(e=!1,()=>e);class g{constructor(e,t){this.tag=e,this.value=t}static some(e){return new g(!0,e)}static none(){return g.singletonNone}fold(e,t){return this.tag?t(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?g.some(e(this.value)):g.none()}bind(e){return this.tag?e(this.value):g.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:g.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw new Error(null!=e?e:"Called getOrDie on None")}static from(e){return null==e?g.none():g.some(e)}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}g.singletonNone=new g(!1);let i=(r,o)=>{for(let e=0,t=r.length;e<t;e++)if(o(r[e],e))return!0;return!1},u=(t,r)=>{var o=t.length,n=new Array(o);for(let e=0;e<o;e++){var a=t[e];n[e]=r(a,e)}return n},h=(r,o)=>{for(let e=0,t=r.length;e<t;e++)o(r[e],e)},c=e=>{let t=e;return{get:()=>t,set:e=>{t=e}}},d=(t,r)=>{let o=null,n=()=>{s(o)||(clearTimeout(o),o=null)};return{cancel:n,throttle:(...e)=>{n(),o=setTimeout(()=>{o=null,t.apply(null,e)},r)}}},m=(e,t)=>{e.insertContent(t)},p=Object.keys,v=Object.hasOwnProperty,y=(r,o)=>{var n=p(r);for(let e=0,t=n.length;e<t;e++){var a=n[e];o(r[a],a)}},f=(e,r)=>b(e,(e,t)=>({k:t,v:r(e,t)})),b=(e,r)=>{let o={};return y(e,(e,t)=>{e=r(e,t);o[e.k]=e.v}),o},w=(e,t)=>v.call(e,t),j=(a=(e,t)=>t,(...t)=>{if(0===t.length)throw new Error("Can't merge zero objects");var r={};for(let e=0;e<t.length;e++){var o,n=t[e];for(o in n)w(n,o)&&(r[o]=a(r[o],n[o]))}return r}),C=e=>{let t=c(g.none()),r=()=>t.get().each(e);return{clear:()=>{r(),t.set(g.none())},isSet:()=>t.get().isSome(),get:()=>t.get(),set:e=>{r(),t.set(g.some(e))}}},_=()=>{let t=C(o);return{...t,on:e=>t.get().each(e)}},A=(e,t,r)=>""===t||e.length>=t.length&&e.substr(r,r+t.length)===t,k=(e,t,r=0,o)=>{e=e.indexOf(t,r);return-1!==e&&(!!n(o)||e+t.length<=o)},O=(e,t)=>A(e,t,0);var x=tinymce.util.Tools.resolve("tinymce.Resource");let E="tinymce.plugins.emoticons",L=(r=t=>e=>e.options.get(t))("emoticons_database"),S=r("emoticons_database_url"),N=r("emoticons_database_id"),$=r("emoticons_append"),I=r("emoticons_images_url"),T="All",z={symbols:"Symbols",people:"People",animals_and_nature:"Animals and Nature",food_and_drink:"Food and Drink",activity:"Activity",travel_and_places:"Travel and Places",objects:"Objects",flags:"Flags",user:"User Defined"},M=(e,t)=>w(e,t)?e[t]:t,R=e=>{e=$(e);return f(e,e=>({keywords:[],category:"user",...e}))},U=(r,n,e)=>{let a=_(),t=_(),s=I(r),o=e=>{let r={},o=[];y(e,(e,t)=>{t={title:t,keywords:e.keywords,char:(t=e,O(t.char,"<img")?t.char.replace(/src="([^"]+)"/,(e,t)=>`src="${s}${t}"`):t.char),category:M(z,e.category)},e=void 0!==r[t.category]?r[t.category]:[];r[t.category]=e.concat([t]),o.push(t)}),a.set(r),t.set(o)};r.on("init",()=>{x.load(e,n).then(e=>{var t=R(r);o(j(e,t))},e=>{console.log("Failed to load emojis: "+e),a.set({}),t.set([])})});let l=()=>t.get().getOr([]);let i=()=>a.isSet()&&t.isSet();return{listCategories:()=>[T].concat(p(a.get().getOr({}))),hasLoaded:i,waitForLoad:()=>i()?Promise.resolve(!0):new Promise((e,t)=>{let r=15,o=setInterval(()=>{i()?(clearInterval(o),e(!0)):--r<0&&(console.log("Could not load emojis from url: "+n),clearInterval(o),t(!1))},100)}),listAll:l,listCategory:t=>t===T?l():a.get().bind(e=>g.from(e[t])).getOr([])}},B=(e,t)=>k(e.title.toLowerCase(),t)||i(e.keywords,e=>k(e.toLowerCase(),t)),D=(t,r,e)=>{var o=[],n=r.toLowerCase(),a=e.fold(()=>l,t=>e=>t<=e);for(let e=0;e<t.length&&(0!==r.length&&!B(t[e],n)||(o.push({value:t[e].char,text:t[e].title,icon:t[e].char}),!a(o.length)));e++);return o},F="pattern",q=(r,n)=>{let e={pattern:"",results:D(n.listAll(),"",g.some(300))},a=c(T),o=d(e=>{var t,r,o;t=(e=e).getData(),r=a.get(),o=n.listCategory(r),o=D(o,t[F],r===T?g.some(300):g.none()),e.setData({results:o})},200),t={label:"Search",type:"input",name:F},s={type:"collection",name:"results"},l=()=>({title:"Emojis",size:"normal",body:{type:"tabpanel",tabs:u(n.listCategories(),e=>({title:e,name:e,items:[t,s]}))},initialData:e,onTabChange:(e,t)=>{a.set(t.newTabName),o.throttle(e)},onChange:o.throttle,onAction:(e,t)=>{"results"===t.name&&(m(r,t.value),e.close())},buttons:[{type:"cancel",text:"Close",primary:!0}]}),i=r.windowManager.open(l());i.focus(F),n.hasLoaded()||(i.block("Loading emojis..."),n.waitForLoad().then(()=>{i.redial(l()),o.throttle(i),i.focus(F),i.unblock()}).catch(e=>{i.redial({title:"Emojis",body:{type:"panel",items:[{type:"alertbanner",level:"error",icon:"warning",text:"Could not load emojis"}]},buttons:[{type:"cancel",text:"Close",primary:!0}],initialData:{pattern:"",results:[]}}),i.focus(F),i.unblock()}))},P=r=>e=>{let t=()=>{e.setEnabled(r.selection.isEditable())};return r.on("NodeChange",t),t(),()=>{r.off("NodeChange",t)}};t.add("emoticons",(e,t)=>{t=t,(a=(u=e).options.register)("emoticons_database",{processor:"string",default:"emojis"}),a("emoticons_database_url",{processor:"string",default:`${t}/js/${L(u)}${u.suffix}.js`}),a("emoticons_database_id",{processor:"string",default:E}),a("emoticons_append",{processor:"object",default:{}}),a("emoticons_images_url",{processor:"string",default:"https://cdnjs.cloudflare.com/ajax/libs/twemoji/15.1.0/72x72/"});var r,o,n,a,s,l,i,t=S(e),u=N(e);let c=U(e,t,u);return r=e,o=c,r.addCommand("mceEmoticons",()=>q(r,o)),a=()=>n.execCommand("mceEmoticons"),(n=e).ui.registry.addButton("emoticons",{tooltip:"Emojis",icon:"emoji",onAction:a,onSetup:P(n)}),n.ui.registry.addMenuItem("emoticons",{text:"Emojis...",icon:"emoji",onAction:a,onSetup:P(n)}),s=e,l=c,s.ui.registry.addAutocompleter("emoticons",{trigger:":",columns:"auto",minChars:2,fetch:(t,r)=>l.waitForLoad().then(()=>{var e=l.listAll();return D(e,t,g.some(r))}),onAction:(e,t,r)=>{s.selection.setRng(t),s.insertContent(r),e.hide()}}),(i=e).on("PreInit",()=>{i.parser.addAttributeFilter("data-emoticon",e=>{h(e,e=>{e.attr("data-mce-resize","false"),e.attr("data-mce-placeholder","1")})})}),{getAllEmojis:()=>c.waitForLoad().then(()=>c.listAll())}})})();