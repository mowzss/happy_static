(()=>{var R=tinymce.util.Tools.resolve("tinymce.PluginManager");let U=(e,t,r)=>!!r(e,t.prototype)||(null==(r=e.constructor)?void 0:r.name)===t.name;var e=r=>e=>{return t=typeof(e=e),(null===e?"null":"object"==t&&Array.isArray(e)?"array":"object"==t&&U(e,String,(e,t)=>t.isPrototypeOf(e))?"string":t)===r;var t},t=t=>e=>typeof e===t;let $=e("string"),l=e("object"),H=e("array"),_=t("boolean"),F=e=>null==e,n=e=>!F(e),s=t("function"),V=t("number"),j=()=>{},K=(t,r)=>e=>t(r(e)),z=e=>()=>e,Q=(e,t)=>e===t,W=t=>e=>!t(e),q=z(!1);class d{constructor(e,t){this.tag=e,this.value=t}static some(e){return new d(!0,e)}static none(){return d.singletonNone}fold(e,t){return this.tag?t(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?d.some(e(this.value)):d.none()}bind(e){return this.tag?e(this.value):d.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:d.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw new Error(null!=e?e:"Called getOrDie on None")}static from(e){return n(e)?d.some(e):d.none()}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}d.singletonNone=new d(!1);let Z=Array.prototype.slice,G=Array.prototype.indexOf,J=Array.prototype.push,X=(e,t)=>G.call(e,t),Y=(e,t)=>-1<X(e,t),ee=(r,n)=>{for(let e=0,t=r.length;e<t;e++)if(n(r[e],e))return!0;return!1},o=(t,r)=>{var n=t.length,o=new Array(n);for(let e=0;e<n;e++){var i=t[e];o[e]=r(i,e)}return o},m=(r,n)=>{for(let e=0,t=r.length;e<t;e++)n(r[e],e)},u=(r,n)=>{var o=[];for(let e=0,t=r.length;e<t;e++){var i=r[e];n(i,e)&&o.push(i)}return o},te=(o,i)=>{if(0===o.length)return[];{let r=i(o[0]);var a=[];let n=[];for(let e=0,t=o.length;e<t;e++){var s=o[e],l=i(s);l!==r&&(a.push(n),n=[]),r=l,n.push(s)}return 0!==n.length&&a.push(n),a}},c=(e,r,n)=>(m(e,(e,t)=>{n=r(n,e,t)}),n),re=(r,n,o)=>{for(let e=0,t=r.length;e<t;e++){var i=r[e];if(n(i,e))return d.some(i);if(o(i,e))break}return d.none()},ne=(e,t)=>re(e,t,q),oe=r=>{var n=[];for(let e=0,t=r.length;e<t;++e){if(!H(r[e]))throw new Error("Arr.flatten item "+e+" was not an array, input: "+r);J.apply(n,r[e])}return n},ie=(e,t)=>oe(o(e,t)),ae=e=>{e=Z.call(e,0);return e.reverse(),e},se=(e,t)=>0<=t&&t<e.length?d.some(e[t]):d.none(),le=e=>se(e,0),de=e=>se(e,e.length-1),me=(r,n)=>{let o=[];var i=s(n)?t=>ee(o,e=>n(e,t)):e=>Y(o,e);for(let e=0,t=r.length;e<t;e++){var a=r[e];i(a)||o.push(a)}return o},ue=(e,t,r=Q)=>e.exists(e=>r(e,t)),ce=(e,t,r=Q)=>pe(e,t,r).getOr(e.isNone()&&t.isNone()),pe=(e,t,r)=>e.isSome()&&t.isSome()?d.some(r(e.getOrDie(),t.getOrDie())):d.none(),ge=8,fe=1,i=e=>{if(null==e)throw new Error("Node cannot be null or undefined");return{dom:e}},p={fromHtml:(e,t)=>{var r,t=(t||document).createElement("div");if(t.innerHTML=e,!t.hasChildNodes()||1<t.childNodes.length)throw r="HTML does not have a single root node",console.error(r,e),new Error(r);return i(t.childNodes[0])},fromTag:(e,t)=>{t=(t||document).createElement(e);return i(t)},fromText:(e,t)=>{t=(t||document).createTextNode(e);return i(t)},fromDom:i,fromPoint:(e,t,r)=>d.from(e.dom.elementFromPoint(t,r)).map(i)},he=(e,t)=>{e=e.dom;if(e.nodeType!==fe)return!1;if(void 0!==e.matches)return e.matches(t);if(void 0!==e.msMatchesSelector)return e.msMatchesSelector(t);if(void 0!==e.webkitMatchesSelector)return e.webkitMatchesSelector(t);if(void 0!==e.mozMatchesSelector)return e.mozMatchesSelector(t);throw new Error("Browser lacks native selectors")},ve=(e,t)=>e.dom===t.dom,ye=(e,t)=>{e=e.dom,t=t.dom;return e!==t&&e.contains(t)},Ce=he,be="undefined"!=typeof window?window:Function("return this;")(),Ne=(t,e)=>{let r=null!=e?e:be;for(let e=0;e<t.length&&null!=r;++e)r=r[t[e]];return r},Se=(e,t)=>{e=e.split(".");return Ne(e,t)},Le=(e,t)=>Se(e,t),De=(e,t)=>{t=Le(e,t);if(null==t)throw new Error(e+" not available on this browser");return t},Te=Object.getPrototypeOf,Oe=e=>De("HTMLElement",e),Ae=e=>{var t=Se("ownerDocument.defaultView",e);return l(e)&&(Oe(t).prototype.isPrototypeOf(e)||/^HTML\w*Element$/.test(Te(e).constructor.name))},g=e=>e.dom.nodeName.toLowerCase(),Ee=e=>e.dom.nodeType,ke=e=>Ee(e)===ge||"#comment"===g(e),we=e=>xe(e)&&Ae(e.dom),xe=(e=t=>e=>Ee(e)===t)(fe),Be=e(3),Pe=e(11),Me=(t=t=>e=>xe(e)&&g(e)===t,e=>d.from(e.dom.parentNode).map(p.fromDom)),Ie=e=>d.from(e.dom.parentElement).map(p.fromDom),Re=e=>d.from(e.dom.nextSibling).map(p.fromDom),f=e=>o(e.dom.childNodes,p.fromDom),Ue=(e,t)=>{e=e.dom.childNodes;return d.from(e[t]).map(p.fromDom)},$e=e=>Ue(e,0),He=e=>Ue(e,e.dom.childNodes.length-1),_e=e=>Pe(e)&&n(e.dom.host),Fe=e=>p.fromDom(e.dom.getRootNode()),Ve=e=>{e=Fe(e);return _e(e)?d.some(e):d.none()},je=e=>p.fromDom(e.dom.host),Ke=e=>{let t=Be(e)?e.dom.parentNode:e.dom;if(null==t||null===t.ownerDocument)return!1;let r=t.ownerDocument;return Ve(p.fromDom(t)).fold(()=>r.body.contains(t),K(Ke,je))};var ze=(e,t,r,n,o)=>e(r,n)?d.some(r):s(o)&&o(r)?d.none():t(r,n,o);let Qe=(e,t,r)=>{let n=e.dom;for(var o=s(r)?r:q;n.parentNode;){n=n.parentNode;var i=p.fromDom(n);if(t(i))return d.some(i);if(o(i))break}return d.none()},We=(e,t,r)=>ze((e,t)=>t(e),Qe,e,t,r),qe=(e,t,r)=>Qe(e,e=>he(e,t),r),Ze=(e,t,r)=>ze((e,t)=>he(e,t),qe,e,t,r),Ge=e=>Ze(e,"[contenteditable]"),Je=(e,t=!1)=>Ke(e)?e.dom.isContentEditable:Ge(e).fold(z(t),e=>"true"===Xe(e)),Xe=e=>e.dom.contentEditable,Ye=(t,r)=>{Me(t).each(e=>{e.dom.insertBefore(r.dom,t.dom)})},et=(e,t)=>{Re(e).fold(()=>{Me(e).each(e=>{a(e,t)})},e=>{Ye(e,t)})},tt=(t,r)=>{$e(t).fold(()=>{a(t,r)},e=>{t.dom.insertBefore(r.dom,e.dom)})},a=(e,t)=>{e.dom.appendChild(t.dom)},rt=(t,e)=>{m(e,e=>{Ye(t,e)})},nt=(t,e)=>{m(e,e=>{a(t,e)})},ot=e=>{e.dom.textContent="",m(f(e),e=>{it(e)})},it=e=>{e=e.dom;null!==e.parentNode&&e.parentNode.removeChild(e)};var at=tinymce.util.Tools.resolve("tinymce.dom.RangeUtils"),st=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),lt=tinymce.util.Tools.resolve("tinymce.util.VK");let dt=e=>o(e,p.fromDom),mt=Object.keys,ut=(r,n)=>{var o=mt(r);for(let e=0,t=o.length;e<t;e++){var i=o[e];n(r[i],i)}},ct=r=>(e,t)=>{r[t]=e},pt=(e,r,n,o)=>{ut(e,(e,t)=>{(r(e,t)?n:o)(e,t)})},gt=(e,t)=>{var r={};return pt(e,t,ct(r),j),r},ft=(e,t,r)=>{if(!($(r)||_(r)||V(r)))throw console.error("Invalid call to Attribute.set. Key ",t,":: Value ",r,":: Element ",e),new Error("Attribute value was not simple");e.setAttribute(t,r+"")},h=(e,t)=>{let r=e.dom;ut(t,(e,t)=>{ft(r,t,e)})},ht=e=>c(e.dom.attributes,(e,t)=>(e[t.name]=t.value,e),{}),vt=(e,t)=>p.fromDom(e.dom.cloneNode(t)),yt=e=>vt(e,!0),Ct=(e,t)=>{t=p.fromTag(t),e=ht(e);return h(t,e),t},bt=(e,t)=>{var t=Ct(e,t),r=(et(e,t),f(e));return nt(t,r),it(e),t},Nt=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils");var St,v=tinymce.util.Tools.resolve("tinymce.util.Tools"),r=t=>e=>n(e)&&t.test(e.nodeName);let y=e=>n(e)&&3===e.nodeType,C=e=>n(e)&&1===e.nodeType,b=r(/^(OL|UL|DL)$/),Lt=r(/^(OL|UL)$/),Dt=(e=t=>e=>n(e)&&e.nodeName.toLowerCase()===t)("ol"),Tt=r(/^(LI|DT|DD)$/),Ot=r(/^(DT|DD)$/),At=r(/^(TH|TD)$/),N=e("br"),Et=e=>{var t;return(null==(t=e.parentNode)?void 0:t.firstChild)===e},kt=(e,t)=>n(t)&&t.nodeName in e.schema.getTextBlockElements(),wt=(e,t)=>n(e)&&e.nodeName in t,xt=(e,t)=>n(t)&&t.nodeName in e.schema.getVoidElements(),Bt=(e,t)=>!!N(t)&&e.isBlock(t.nextSibling)&&!N(t.previousSibling),S=(e,t,r)=>{var n=e.isEmpty(t);return!(r&&0<e.select("span[data-mce-type=bookmark]",t).length)&&n},Pt=(e,t)=>e.isChildOf(t,e.getRoot()),Mt=(r=t=>e=>e.options.get(t))("lists_indent_on_tab"),It=r("forced_root_block"),Rt=r("forced_root_block_attrs"),Ut=(e,t,r={})=>{var n,o=e.dom,i=e.schema.getBlockElements(),a=o.createFragment(),s=It(e),l=Rt(e);let d,m=!1;for(d=o.create(s,{...l,...r.style?{style:r.style}:{}}),wt(t.firstChild,i)||a.appendChild(d);n=t.firstChild;){var u=n.nodeName;m||"SPAN"===u&&"bookmark"===n.getAttribute("data-mce-type")||(m=!0),wt(n,i)?(a.appendChild(n),d=null):(d||(d=o.create(s,l),a.appendChild(d)),d.appendChild(n))}return!m&&d&&d.appendChild(o.create("br",{"data-mce-bogus":"1"})),a},L=Nt.DOM,$t=(t,e,r)=>{let n=L.select('span[data-mce-type="bookmark"]',e);var o=Ut(t,r),i=L.createRng(),i=(i.setStartAfter(r),i.setEndAfter(e),i.extractContents());for(let e=i.firstChild;e;e=e.firstChild)if("LI"===e.nodeName&&t.dom.isEmpty(e)){L.remove(e);break}t.dom.isEmpty(i)||L.insertAfter(i,e),L.insertAfter(o,e);i=r.parentElement;i&&S(t.dom,i)&&(e=>{let t=e.parentNode;t&&v.each(n,e=>{t.insertBefore(e,r.parentNode)}),L.remove(e)})(i),L.remove(r),S(t.dom,e)&&L.remove(e)},Ht=t("dd"),_t=t("dt"),Ft=(t,r)=>{Ht(r)?bt(r,"dt"):_t(r)&&Ie(r).each(e=>$t(t,e.dom,r.dom))},Vt=e=>{_t(e)&&bt(e,"dd")},jt=(t,e,r)=>{"Indent"===e?m(r,Vt):m(r,e=>Ft(t,e))},Kt=(e,t)=>{var r;return y(e)?{container:e,offset:t}:(r=at.getNode(e,t),y(r)?{container:r,offset:t>=e.childNodes.length?r.data.length:0}:r.previousSibling&&y(r.previousSibling)?{container:r.previousSibling,offset:r.previousSibling.data.length}:r.nextSibling&&y(r.nextSibling)?{container:r.nextSibling,offset:0}:{container:e,offset:t})},zt=e=>{var t=e.cloneRange(),r=Kt(e.startContainer,e.startOffset),r=(t.setStart(r.container,r.offset),Kt(e.endContainer,e.endOffset));return t.setEnd(r.container,r.offset),t},Qt=["OL","UL","DL"],Wt=Qt.join(","),D=(e,t)=>{t=t||e.selection.getStart(!0);return e.dom.getParent(t,Wt,T(e,t))},qt=(e,t)=>n(e)&&1===t.length&&t[0]===e,Zt=e=>u(e.querySelectorAll(Wt),b),Gt=e=>{let t=D(e);e=e.selection.getSelectedBlocks();return qt(t,e)?Zt(t):u(e,e=>b(e)&&t!==e)},Jt=(r,e)=>{e=v.map(e,e=>{var t=r.dom.getParent(e,"li,dd,dt",T(r,e));return t||e});return me(e)},Xt=e=>{var t=e.selection.getSelectedBlocks();return u(Jt(e,t),Tt)},Yt=e=>u(Xt(e),Ot),er=(e,t)=>{t=e.dom.getParents(t,"TD,TH");return 0<t.length?t[0]:e.getBody()},tr=(t,r)=>!b(r)&&!Tt(r)&&ee(Qt,e=>t.isValidChild(r.nodeName,e)),T=(t,e)=>{e=t.dom.getParents(e,t.dom.isBlock);return ne(e,e=>e.nodeName.toLowerCase()!==It(t)&&tr(t.schema,e)).getOr(t.getBody())},rr=e=>Me(e).exists(e=>Tt(e.dom)&&$e(e).exists(e=>!b(e.dom))&&He(e).exists(e=>!b(e.dom))),nr=(e,t)=>{e=e.dom.getParents(t,"ol,ul",T(e,t));return de(e)},or=e=>{var t=nr(e,e.selection.getStart()),e=u(e.selection.getSelectedBlocks(),Lt);return t.toArray().concat(e)},ir=e=>{var t=e.selection.getStart();return e.dom.getParents(t,"ol,ul",T(e,t))},ar=e=>{let t=or(e);var r=ir(e);return ne(r,e=>rr(p.fromDom(e))).fold(()=>sr(e,t),e=>[e])},sr=(t,e)=>{e=o(e,e=>nr(t,e).getOr(e));return me(e)},O=e=>/\btox\-/.test(e.className),lr=(e,t)=>re(e,b,At).exists(e=>e.nodeName===t&&!O(e)),dr=(e,t)=>null!==t&&!e.dom.isEditable(t),mr=e=>{var t=D(e);return dr(e,t)||!e.selection.isEditable()},A=(e,t)=>{t=e.dom.getParent(t,"ol,ul,dl");return dr(e,t)||!e.selection.isEditable()},ur=(e,t)=>{var r=e.selection.getNode();return t({parents:e.dom.getParents(r),element:r}),e.on("NodeChange",t),()=>e.off("NodeChange",t)},cr=(e,t)=>{let r=(t||document).createDocumentFragment();return m(e,e=>{r.appendChild(e.dom)}),p.fromDom(r)},E=(e,t,r)=>e.dispatch("ListMutation",{action:t,element:r}),pr=(St=/^\s+|\s+$/g,e=>e.replace(St,"")),gr=e=>0<e.length,fr=e=>!gr(e),hr=e=>void 0!==e.style&&s(e.style.getPropertyValue),vr=(e,t,r)=>{if(!$(r))throw console.error("Invalid call to CSS.set. Property ",t,":: Value ",r,":: Element ",e),new Error("CSS value must be a string: "+r);hr(e)&&e.style.setProperty(t,r)},yr=(e,t,r)=>{e=e.dom;vr(e,t,r)},k=e=>Ce(e,"OL,UL"),Cr=e=>Ce(e,"LI"),br=e=>$e(e).exists(k),Nr=e=>He(e).exists(k),w=e=>"listAttributes"in e,Sr=e=>"isComment"in e,Lr=e=>"isFragment"in e,Dr=e=>0<e.depth,Tr=e=>e.isSelected,Or=e=>{var t=f(e),e=Nr(e)?t.slice(0,-1):t;return o(e,yt)},Ar=(t,r,n)=>Me(t).filter(xe).map(e=>({depth:r,dirty:!1,isSelected:n,content:Or(t),itemAttributes:ht(t),listAttributes:ht(e),listType:g(e),isInPreviousLi:!1})),Er=(e,t)=>{a(e.item,t.list)},kr=t=>{for(let e=1;e<t.length;e++)Er(t[e-1],t[e])},wr=(e,t)=>{pe(de(e),le(t),Er)},xr=(e,t)=>{t={list:p.fromTag(t,e),item:p.fromTag("li",e)};return a(t.list,t.item),t},Br=(t,r,n)=>{var o=[];for(let e=0;e<n;e++)o.push(xr(t,w(r)?r.listType:r.parentListType));return o},Pr=(t,r)=>{for(let e=0;e<t.length-1;e++)yr(t[e].item,"list-style-type","none");de(t).each(e=>{w(r)&&(h(e.list,r.listAttributes),h(e.item,r.itemAttributes)),nt(e.item,r.content)})},Mr=(e,t)=>{g(e.list)!==t.listType&&(e.list=bt(e.list,t.listType)),h(e.list,t.listAttributes)},Ir=(e,t,r)=>{e=p.fromTag("li",e);return h(e,t),nt(e,r),e},Rr=(e,t)=>{a(e.list,t),e.item=t},Ur=(r,e,n)=>{e=e.slice(0,n.depth);return de(e).each(e=>{var t;w(n)?(t=Ir(r,n.itemAttributes,n.content),Rr(e,t),Mr(e,n)):Lr(n)?nt(e.item,n.content):(t=p.fromHtml(`<!--${n.content}-->`),a(e.list,t))}),e},$r=(e,t,r)=>{e=Br(e,r,r.depth-t.length);return kr(e),Pr(e,r),wr(t,e),t.concat(e)},Hr=(n,e)=>{let o=d.none(),r=c(e,(e,t,r)=>Sr(t)?0===r?(o=d.some(t),e):Ur(n,e,t):(t.depth>e.length?$r:Ur)(n,e,t),[]);return o.each(e=>{let t=p.fromHtml(`<!--${e.content}-->`);le(r).each(e=>{tt(e.list,t)})}),le(r).map(e=>e.list)},_r=(e,t)=>{switch(e){case"Indent":t.depth++;break;case"Outdent":t.depth--;break;case"Flatten":t.depth=0}t.dirty=!0},Fr=(e,t)=>{w(e)&&w(t)&&(e.listType=t.listType,e.listAttributes={...t.listAttributes})},Vr=e=>{e.listAttributes=gt(e.listAttributes,(e,t)=>"start"!==t)},jr=(e,t)=>{let r=e[t].depth,n=e=>e.depth===r&&!e.dirty,o=e=>e.depth<r;return re(ae(e.slice(0,t)),n,o).orThunk(()=>re(e.slice(t+1),n,o))},Kr=r=>(m(r,(t,e)=>{jr(r,e).fold(()=>{t.dirty&&w(t)&&Vr(t)},e=>Fr(t,e))}),r),zr=e=>{let t=e;return{get:()=>t,set:e=>{t=e}}},Qr=(t,r,n,o)=>{if(ke(o))return[{depth:t+1,content:null!=(e=o.dom.nodeValue)?e:"",dirty:!1,isSelected:!1,isComment:!0}];r.each(e=>{ve(e.start,o)&&n.set(!0)});var e=Ar(o,t,n.get()),i=(r.each(e=>{ve(e.end,o)&&n.set(!1)}),He(o).filter(k).map(e=>qr(t,r,n,e)).getOr([]));return e.toArray().concat(i)},Wr=(o,i,a,t)=>$e(t).filter(k).fold(()=>Qr(o,i,a,t),n=>{var e=c(f(t),(e,t,r)=>0===r?e:Cr(t)?e.concat(Qr(o,i,a,t)):(r={isFragment:!0,depth:o,content:[t],isSelected:!1,dirty:!1,parentListType:g(n)},e.concat(r)),[]);return qr(o,i,a,n).concat(e)}),qr=(t,r,n,e)=>ie(f(e),e=>(k(e)?qr:Wr)(t+1,r,n,e)),Zr=(e,t)=>{let r=zr(!1);return o(e,e=>({sourceList:e,entries:qr(0,t,r,e)}))},Gr=(r,e)=>{e=Kr(e);return o(e,e=>{var t=Sr(e)?cr([p.fromHtml(`<!--${e.content}-->`)]):cr(e.content),e=w(e)?e.itemAttributes:{};return p.fromDom(Ut(r,t.dom,e))})},Jr=(e,t)=>{t=Kr(t);return Hr(e.contentDocument,t).toArray()},Xr=(t,e)=>ie(te(e,Dr),e=>(le(e).exists(Dr)?Jr:Gr)(t,e)),Yr=(e,t)=>{m(u(e,Tr),e=>_r(t,e))},en=e=>{e=o(Xt(e),p.fromDom);return pe(ne(e,W(br)),ne(ae(e),W(br)),(e,t)=>({start:e,end:t}))},tn=(r,e,n)=>{e=Zr(e,en(r));m(e,e=>{Yr(e.entries,n);var t=Xr(r,e.entries);m(t,e=>{E(r,"Indent"===n?"IndentList":"OutdentList",e.dom)}),rt(e.sourceList,t),it(e.sourceList)})},rn=(e,t)=>{var r,n=dt(ar(e)),o=dt(Yt(e));let i=!1;return(n.length||o.length)&&(r=e.selection.getBookmark(),tn(e,n,t),jt(e,t,o),e.selection.moveToBookmark(r),e.selection.setRng(zt(e.selection.getRng())),e.nodeChanged(),i=!0),i},nn=(e,t)=>!mr(e)&&rn(e,t),on=e=>nn(e,"Indent"),an=e=>nn(e,"Outdent"),sn=e=>nn(e,"Flatten"),ln="\ufeff",dn=e=>e===ln,mn=(e,t,r)=>Qe(e,t,r).isSome(),un=(e,t)=>{return mn(e,(r=ve,n=[t],(...e)=>{e=n.concat(e);return r.apply(null,e)}));var r,n};var cn=tinymce.util.Tools.resolve("tinymce.dom.BookmarkManager");let x=Nt.DOM,B=o=>{let i={};var e=e=>{let t=o[e?"startContainer":"endContainer"],r=o[e?"startOffset":"endOffset"];var n;C(t)&&(n=x.create("span",{"data-mce-type":"bookmark"}),t.hasChildNodes()?(r=Math.min(r,t.childNodes.length-1),e?t.insertBefore(n,t.childNodes[r]):x.insertAfter(n,t.childNodes[r])):t.appendChild(n),t=n,r=0),i[e?"startContainer":"endContainer"]=t,i[e?"startOffset":"endOffset"]=r};return e(!0),o.collapsed||e(),i},P=o=>{var e=e=>{var t;let r=o[e?"startContainer":"endContainer"],n=o[e?"startOffset":"endOffset"];r&&(C(r)&&r.parentNode&&(t=r,n=(e=>{let t,r=null==(t=e.parentNode)?void 0:t.firstChild,n=0;for(;r;){if(r===e)return n;C(r)&&"bookmark"===r.getAttribute("data-mce-type")||n++,r=r.nextSibling}return-1})(r),r=r.parentNode,x.remove(t),!r.hasChildNodes())&&x.isBlock(r)&&r.appendChild(x.create("br")),o[e?"startContainer":"endContainer"]=r,o[e?"startOffset":"endOffset"]=n)},e=(e(!0),e(),x.createRng());return e.setStart(o.startContainer,o.startOffset),o.endContainer&&e.setEnd(o.endContainer,o.endOffset),zt(e)},M=e=>{switch(e){case"UL":return"ToggleUlList";case"OL":return"ToggleOlList";case"DL":return"ToggleDLList"}},pn=(e,t,r)=>{r=r["list-style-type"]||null;e.setStyle(t,"list-style-type",r)},gn=(r,e)=>{v.each(e,(e,t)=>{r.setAttribute(t,e)})},fn=(e,t,r)=>{gn(t,r["list-attributes"]),v.each(e.select("li",t),e=>{gn(e,r["list-item-attributes"])})},I=(e,t,r)=>{pn(e,t,r),fn(e,t,r)},hn=(t,r,e)=>{v.each(e,e=>t.setStyle(r,e,""))},vn=(e,t)=>n(t)&&!wt(t,e.schema.getBlockElements()),yn=(a,e,t,s)=>{let r=e[t?"startContainer":"endContainer"];e=e[t?"startOffset":"endOffset"];C(r)&&(r=r.childNodes[Math.min(e,r.childNodes.length-1)]||r),!t&&N(r.nextSibling)&&(r=r.nextSibling);e=(e,t)=>{for(var r,n,o=new st(e,(e=>{for(;!a.dom.isBlock(e)&&e.parentNode&&s!==e;)e=e.parentNode;return e})(e)),i=t?"next":"prev";n=o[i]();)if(!xt(a,n)&&!dn(n.textContent)&&0!==(null==(r=n.textContent)?void 0:r.length))return d.some(n);return d.none()};if(t&&y(r))if(dn(r.textContent))r=e(r,!1).getOr(r);else for(null!==r.parentNode&&vn(a,r.parentNode)&&(r=r.parentNode);null!==r.previousSibling&&(vn(a,r.previousSibling)||y(r.previousSibling));)r=r.previousSibling;if(!t&&y(r))if(dn(r.textContent))r=e(r,!0).getOr(r);else for(null!==r.parentNode&&vn(a,r.parentNode)&&(r=r.parentNode);null!==r.nextSibling&&(vn(a,r.nextSibling)||y(r.nextSibling));)r=r.nextSibling;for(;r.parentNode!==s;){var n=r.parentNode;if(kt(a,r))return r;if(/^(TD|TH)$/.test(n.nodeName))return r;r=n}return r},Cn=(r,e,n)=>{let o=[],i=r.dom;var t=yn(r,e,!0,n),a=yn(r,e,!1,n);let s;var l=[];for(let e=t;e&&(l.push(e),e!==a);e=e.nextSibling);return v.each(l,e=>{var t;kt(r,e)?(o.push(e),s=null):i.isBlock(e)||N(e)?(N(e)&&i.remove(e),s=null):(t=e.nextSibling,cn.isBookmarkNode(e)&&(b(t)||kt(r,t)||!t&&e.parentNode===n)?s=null:(s||(s=i.create("p"),null!=(t=e.parentNode)&&t.insertBefore(s,e),o.push(s)),s.appendChild(e)))}),o},bn=(e,t,r)=>{e=e.getStyle(t,"list-style-type"),t=r?r["list-style-type"]:"";return e===(null===t?"":t)},Nn=(e,t)=>{var r=e.selection.getStart(!0),e=yn(e,t,!0,e.getBody());return un(p.fromDom(e),p.fromDom(t.commonAncestorContainer))?t.commonAncestorContainer:r},Sn=(o,i,a)=>{var e=o.selection.getRng();let s="LI";var t,r=T(o,Nn(o,e));let l=o.dom;"false"!==l.getContentEditable(o.selection.getNode())&&("DL"===(i=i.toUpperCase())&&(s="DT"),t=B(e),e=u(Cn(o,e,r),o.dom.isEditable),v.each(e,e=>{let t;var r=e.previousSibling,n=e.parentNode;Tt(n)||(r&&b(r)&&r.nodeName===i&&bn(l,r,a)?(t=r,e=l.rename(e,s),r.appendChild(e)):(t=l.create(i),n.insertBefore(t,e),t.appendChild(e),e=l.rename(e,s)),hn(l,e,["margin","margin-right","margin-bottom","margin-left","margin-top","padding","padding-right","padding-bottom","padding-left","padding-top"]),I(l,t,a),An(o.dom,t))}),o.selection.setRng(P(t)))},Ln=(e,t)=>b(e)&&e.nodeName===(null==t?void 0:t.nodeName),Dn=(e,t,r)=>e.getStyle(t,"list-style-type",!0)===e.getStyle(r,"list-style-type",!0),Tn=(e,t)=>e.className===t.className,On=(e,t,r)=>Ln(t,r)&&Dn(e,t,r)&&Tn(t,r),An=(e,t)=>{let r;var n=t.nextSibling;if(On(e,t,n)){for(var o=n;r=o.firstChild;)t.appendChild(r);e.remove(o)}if(n=t.previousSibling,On(e,t,n)){for(var i=n;r=i.lastChild;)t.insertBefore(r,t.firstChild);e.remove(i)}},En=(e,t,r,n)=>{var o;t.nodeName!==r?(o=e.dom.rename(t,r),I(e.dom,o,n),E(e,M(r),o)):(I(e.dom,t,n),E(e,M(r),t))},kn=(e,n,t,r)=>{var o;n.classList.forEach((e,t,r)=>{e.startsWith("tox-")&&(r.remove(e),0===r.length)&&n.removeAttribute("class")}),n.nodeName!==t?(o=e.dom.rename(n,t),I(e.dom,o,r),E(e,M(t),o)):(I(e.dom,n,r),E(e,M(t),n))},wn=(r,e,n,o,i)=>{var a=b(e);if(!a||e.nodeName!==o||xn(i)||O(e)){Sn(r,o,i);var s=B(r.selection.getRng()),n=a?[e,...n]:n;let t=a&&O(e)?kn:En;v.each(n,e=>{t(r,e,o,i)}),r.selection.setRng(P(s))}else sn(r)},xn=e=>"list-style-type"in e,Bn=(e,n,t,r)=>{var o,i;n!==e.getBody()&&(n?n.nodeName!==t||xn(r)||O(n)?(o=B(e.selection.getRng()),O(n)&&n.classList.forEach((e,t,r)=>{e.startsWith("tox-")&&(r.remove(e),0===r.length)&&n.removeAttribute("class")}),I(e.dom,n,r),i=e.dom.rename(n,t),An(e.dom,i),e.selection.setRng(P(o)),Sn(e,t,r),E(e,M(t),i)):sn(e):(Sn(e,t,r),E(e,M(t),n)))},Pn=(e,t,r)=>{var n,o=D(e);A(e,o)||(n=Gt(e),r=l(r)?r:{},0<n.length?wn(e,o,n,t,r):Bn(e,o,t,r))},Mn=Nt.DOM,In=(e,t)=>{var r,n=t.parentElement;n&&"LI"===n.nodeName&&n.firstChild===t&&((r=n.previousSibling)&&"LI"===r.nodeName?(r.appendChild(t),S(e,n)&&Mn.remove(n)):Mn.setStyle(n,"listStyleType","none")),b(n)&&(r=n.previousSibling)&&"LI"===r.nodeName&&r.appendChild(t)},Rn=(t,e)=>{e=v.grep(t.select("ol,ul",e));v.each(e,e=>{In(t,e)})},Un=(e,t,r,n)=>{let o=t.startContainer;t=t.startOffset;if(y(o)&&(r?t<o.data.length:0<t))return o;for(var i=e.schema.getNonEmptyElements(),t=(C(o)&&(o=at.getNode(o,t)),new st(o,n)),a=(r&&Bt(e.dom,o)&&t.next(),(r?t.next:t.prev2).bind(t));o=a();){if("LI"===o.nodeName&&!o.hasChildNodes())return o;if(i[o.nodeName])return o;if(y(o)&&0<o.data.length)return o}return null},$n=(e,t)=>{t=t.childNodes;return 1===t.length&&!b(t[0])&&e.isBlock(t[0])},Hn=e=>d.from(e).map(p.fromDom).filter(we).exists(e=>Je(e)&&!Y(["details"],g(e))),_n=(e,t)=>{$n(e,t)&&Hn(t.firstChild)&&e.remove(t.firstChild,!0)},Fn=(e,t,r)=>{var n,o=$n(e,r)?r.firstChild:r;if(_n(e,t),!S(e,t,!0))for(;n=t.firstChild;)o.appendChild(n)},Vn=(t,e,r)=>{let n;var o=e.parentNode;Pt(t,e)&&Pt(t,r)&&(b(r.lastChild)&&(n=r.lastChild),o===r.lastChild&&N(o.previousSibling)&&t.remove(o.previousSibling),(o=r.lastChild)&&N(o)&&e.hasChildNodes()&&t.remove(o),S(t,r,!0)&&ot(p.fromDom(r)),Fn(t,e,r),n&&r.appendChild(n),o=ye(p.fromDom(r),p.fromDom(e))?t.getParents(e,b,r):[],t.remove(e),m(o,e=>{S(t,e)&&e!==t.getRoot()&&t.remove(e)}))},jn=(e,t,r)=>{ot(p.fromDom(r)),Vn(e.dom,t,r),e.selection.setCursorLocation(r,0)},Kn=(e,t,r,n)=>{var o=e.dom;o.isEmpty(n)?jn(e,r,n):(t=B(t),Vn(o,r,n),e.selection.setRng(P(t)))},zn=(e,t,r,n)=>{t=B(t),Vn(e.dom,r,n),r=P(t);e.selection.setRng(r)},Qn=(o,e)=>{let i=o.dom,t=o.selection;var a=t.getStart(),a=er(o,a);let s=i.getParent(t.getStart(),"LI",a);if(s){var l=s.parentElement;if(l===o.getBody()&&S(i,l))return!0;let r=zt(t.getRng()),n=i.getParent(Un(o,r,e,a),"LI",a);l=n&&(e?i.isChildOf(s,n):i.isChildOf(n,s));if(n&&n!==s&&!l)return o.undoManager.transact(()=>{e?Kn(o,r,n,s):Et(s)?an(o):zn(o,r,s,n)}),!0;if(l&&!e&&n!==s)return o.undoManager.transact(()=>{var e,t;r.commonAncestorContainer.parentElement&&(e=B(r),t=r.commonAncestorContainer.parentElement,Fn(i,r.commonAncestorContainer.parentElement,n),t.remove(),t=P(e),o.selection.setRng(t))}),!0;if(!n&&!e&&0===r.startOffset&&0===r.endOffset)return o.undoManager.transact(()=>{sn(o)}),!0}return!1},Wn=(e,t,r)=>{r=e.getParent(t.parentNode,e.isBlock,r);e.remove(t),r&&e.isEmpty(r)&&e.remove(r)},qn=(r,n)=>{let o=r.dom;var e=r.selection.getStart();let i=er(r,e),a=o.getParent(e,o.isBlock,i);if(a&&o.isEmpty(a,void 0,{checkRootAsContent:!0})){var s,l,d,e=zt(r.selection.getRng());let t=o.getParent(Un(r,e,n,i),"LI",i);if(t)return s=e=>Y(["td","th","caption"],g(e)),l=e=>e.dom===i,d=We(p.fromDom(t),s,l),e=We(p.fromDom(e.startContainer),s,l),!!ce(d,e,ve)&&(r.undoManager.transact(()=>{var e=t.parentNode;Wn(o,a,i),An(o,e),r.selection.select(t,!0),r.selection.collapse(n)}),!0)}return!1},Zn=(e,t)=>Qn(e,t)||qn(e,t),Gn=e=>{var t=e.selection.getStart(),r=er(e,t);return e.dom.getParent(t,"LI,DT,DD",r)||0<Xt(e).length},Jn=r=>!!Gn(r)&&(r.undoManager.transact(()=>{let e=!0;var t=()=>e=!1;r.on("input",t),r.execCommand("Delete"),r.off("input",t),e&&r.dispatch("input"),Rn(r.dom,r.getBody())}),!0),Xn=(e,t)=>{var r=e.selection;return!A(e,r.getNode())&&(r.isCollapsed()?Zn(e,t):Jn(e))},Yn=t=>{t.on("ExecCommand",e=>{e=e.command.toLowerCase();"delete"!==e&&"forwarddelete"!==e||!Gn(t)||Rn(t.dom,t.getBody())}),t.on("keydown",e=>{e.keyCode===lt.BACKSPACE?Xn(t,!1)&&e.preventDefault():e.keyCode===lt.DELETE&&Xn(t,!0)&&e.preventDefault()})},eo=(r,e)=>{let n=D(r);null===n||A(r,n)||r.undoManager.transact(()=>{l(e.styles)&&r.dom.setStyles(n,e.styles),l(e.attrs)&&ut(e.attrs,(e,t)=>r.dom.setAttrib(n,t,e))})},to=e=>{e=ae(pr(e).split("")),e=o(e,(e,t)=>{e=e.toUpperCase().charCodeAt(0)-"A".charCodeAt(0)+1;return Math.pow(26,t)*e});return c(e,(e,t)=>e+t,0)},ro=e=>{var t;return--e<0?"":(t=e%26,e=Math.floor(e/26),ro(e)+String.fromCharCode("A".charCodeAt(0)+t))},no=e=>/^[A-Z]+$/.test(e),oo=e=>/^[a-z]+$/.test(e),io=e=>/^[0-9]+$/.test(e),ao=e=>io(e)?2:no(e)?0:oo(e)?1:fr(e)?3:4,so=e=>{switch(ao(e)){case 2:return d.some({listStyleType:d.none(),start:e});case 0:return d.some({listStyleType:d.some("upper-alpha"),start:to(e).toString()});case 1:return d.some({listStyleType:d.some("lower-alpha"),start:to(e).toString()});case 3:return d.some({listStyleType:d.none(),start:""});case 4:return d.none()}},lo=e=>{var t=parseInt(e.start,10);return ue(e.listStyleType,"upper-alpha")?ro(t):ue(e.listStyleType,"lower-alpha")?ro(t).toLowerCase():e.start},mo=r=>{var e=D(r);Dt(e)&&!A(r,e)&&r.windowManager.open({title:"List Properties",body:{type:"panel",items:[{type:"input",name:"start",label:"Start list at number",inputMode:"numeric"}]},initialData:{start:lo({start:r.dom.getAttrib(e,"start","1"),listStyleType:d.from(r.dom.getStyle(e,"list-style-type"))})},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],onSubmit:e=>{var t=e.getData();so(t.start).each(e=>{r.execCommand("mceListUpdate",!1,{attrs:{start:"1"===e.start?"":e.start},styles:{"list-style-type":e.listStyleType.getOr("")}})}),e.close()}})},uo=(t,r)=>()=>{var e=D(t);return n(e)&&e.nodeName===r},co=e=>{e.addCommand("mceListProps",()=>{mo(e)})};var po=tinymce.util.Tools.resolve("tinymce.html.Node");let go=e=>3===e.type,fo=e=>0===e.length,ho=n=>{let r=(e,t)=>{let r=po.create("li");m(e,e=>r.append(e)),t?n.insert(r,t,!0):n.append(r)};var e=c(n.children(),(e,t)=>go(t)?[...e,t]:fo(e)||go(t)?e:(r(e,t),[]),[]);fo(e)||r(e)},vo=t=>{t.on("keydown",e=>{e.keyCode!==lt.TAB||lt.metaKeyPressed(e)||t.undoManager.transact(()=>{(e.shiftKey?an:on)(t)&&e.preventDefault()})})},yo=(r,n)=>t=>(t.setEnabled(r.selection.isEditable()),ur(r,e=>{t.setActive(lr(e.parents,n)),t.setEnabled(!A(r,e.element)&&r.selection.isEditable())})),Co=(r,n)=>t=>ur(r,e=>t.setEnabled(lr(e.parents,n)&&!A(r,e.element)));R.add("lists",e=>{var t,r,n,o,i,a,s;return(0,e.options.register)("lists_indent_on_tab",{processor:"boolean",default:!0}),(t=e).on("PreInit",()=>{var e=t.parser;e.addNodeFilter("ul,ol",e=>m(e,ho))}),e.hasPlugin("rtc",!0)?co(e):(o=e,Mt(o)&&vo(o),Yn(o),(r=e).on("BeforeExecCommand",e=>{e=e.command.toLowerCase();"indent"===e?on(r):"outdent"===e&&an(r)}),r.addCommand("InsertUnorderedList",(e,t)=>{Pn(r,"UL",t)}),r.addCommand("InsertOrderedList",(e,t)=>{Pn(r,"OL",t)}),r.addCommand("InsertDefinitionList",(e,t)=>{Pn(r,"DL",t)}),r.addCommand("RemoveList",()=>{sn(r)}),co(r),r.addCommand("mceListUpdate",(e,t)=>{l(t)&&eo(r,t)}),r.addQueryStateHandler("InsertUnorderedList",uo(r,"UL")),r.addQueryStateHandler("InsertOrderedList",uo(r,"OL")),r.addQueryStateHandler("InsertDefinitionList",uo(r,"DL"))),o=e=>()=>n.execCommand(e),(n=e).hasPlugin("advlist")||(n.ui.registry.addToggleButton("numlist",{icon:"ordered-list",active:!1,tooltip:"Numbered list",onAction:o("InsertOrderedList"),onSetup:yo(n,"OL")}),n.ui.registry.addToggleButton("bullist",{icon:"unordered-list",active:!1,tooltip:"Bullet list",onAction:o("InsertUnorderedList"),onSetup:yo(n,"UL")})),i=e,a={text:"List properties...",icon:"ordered-list",onAction:()=>i.execCommand("mceListProps"),onSetup:Co(i,"OL")},i.ui.registry.addMenuItem("listprops",a),i.ui.registry.addContextMenu("lists",{update:e=>{e=D(i,e);return Dt(e)?["listprops"]:[]}}),s=e,{backspaceDelete:e=>{Xn(s,e)}}})})();