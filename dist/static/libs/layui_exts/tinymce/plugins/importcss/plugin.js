(()=>{var e=tinymce.util.Tools.resolve("tinymce.PluginManager");let s=(e,t,r)=>!!r(e,t.prototype)||(null==(r=e.constructor)?void 0:r.name)===t.name;var t,r=r=>e=>{return t=typeof(e=e),(null===e?"null":"object"==t&&Array.isArray(e)?"array":"object"==t&&s(e,String,(e,t)=>t.isPrototypeOf(e))?"string":t)===r;var t};let o=r("string"),l=r("object"),i=r("array"),n=(t="function",e=>typeof e===t);var c=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),a=tinymce.util.Tools.resolve("tinymce.EditorManager"),p=tinymce.util.Tools.resolve("tinymce.Env"),u=tinymce.util.Tools.resolve("tinymce.util.Tools");let m=(r=t=>e=>e.options.get(t))("importcss_merge_classes"),f=r("importcss_exclusive"),v=r("importcss_selector_converter"),y=r("importcss_selector_filter"),d=r("importcss_groups"),h=r("importcss_append"),g=r("importcss_file_filter"),_=r("skin"),b=r("skin_url"),x=Array.prototype.push,T=(t,r)=>{var s=t.length,o=new Array(s);for(let e=0;e<s;e++){var l=t[e];o[e]=r(l,e)}return o},S=r=>{var s=[];for(let e=0,t=r.length;e<t;++e){if(!i(r[e]))throw new Error("Arr.flatten item "+e+" was not an array, input: "+r);x.apply(s,r[e])}return s},k=(e,t)=>S(T(e,t)),M=()=>{let t=[],r=[],s={};return{addItemToGroup:(e,t)=>{s[e]?s[e].push(t):(r.push(e),s[e]=[t])},addItem:e=>{t.push(e)},toFormats:()=>k(r,e=>{var t=s[e];return 0===t.length?[]:[{title:e,items:t}]}).concat(t)}},w=/^\.(?:ephox|tiny-pageembed|mce)(?:[.-]+\w+)+$/,A=e=>{var t=p.cacheSuffix;return e=o(e)?e.replace("?"+t,"").replace("&"+t,""):e},E=(e,t)=>{var r,s,o=_(e);return!!o&&(r=(r=b(e))?e.documentBaseURI.toAbsolute(r):a.baseURL+"/skins/ui/"+o,o=a.baseURL+"/skins/content/",s=e.editorManager.suffix,t===r+"/content"+(e.inline?".inline":"")+s+".css"||-1!==t.indexOf(o))},I=t=>o(t)?e=>-1!==e.indexOf(t):t instanceof RegExp?e=>t.test(e):t,j=e=>e.styleSheet,O=e=>e.selectorText,R=(o,e,l)=>{let i=[],r={},n=(e,t)=>{var r=e.href;let s;if((r=A(r))&&(!l||l(r,t))&&!E(o,r)){u.each(e.imports,e=>{n(e,!0)});try{s=e.cssRules||e.rules}catch(e){}u.each(s,e=>{j(e)&&e.styleSheet?n(e.styleSheet,!0):O(e)&&u.each(e.selectorText.split(","),e=>{i.push(u.trim(e))})})}};u.each(o.contentCSS,e=>{r[e]=!0}),l=l||((e,t)=>t||r[e]);try{u.each(e.styleSheets,e=>{n(e)})}catch(e){}return i},U=(e,t)=>{let r={};var s,o,l,i=/^(?:([a-z0-9\-_]+))?(\.[a-z0-9_\-\.]+)$/i.exec(t);if(i)return s=i[1],o=i[2].substr(1).split(".").join(" "),l=u.makeMap("a,img"),i[1]?(r={title:t},e.schema.getTextBlockElements()[s]?r.block=s:e.schema.getBlockElements()[s]||l[s.toLowerCase()]?r.selector=s:r.inline=s):i[2]&&(r={inline:"span",title:t.substr(1),classes:o}),m(e)?r.classes=o:r.attributes={class:o},r},B=(e,t)=>u.grep(e,e=>!e.filter||e.filter(t)),F=e=>u.map(e,e=>u.extend({},e,{original:e,selectors:{},filter:I(e.filter)})),D=(e,t)=>null===t||f(e),L=(e,t,r,s)=>!(D(e,r)?t in s:t in r.selectors),z=(e,t,r,s)=>{D(e,r)?s[t]=!0:r.selectors[t]=!0},C=(e,t,r,s)=>{let o;var l=v(e);return(o=s&&s.selector_converter?s.selector_converter:l||(()=>U(e,r))).call(t,r,s)};e.add("importcss",e=>{var t,r,i,s;return t=(t=e).options.register,r=e=>o(e)||n(e)||l(e),t("importcss_merge_classes",{processor:"boolean",default:!0}),t("importcss_exclusive",{processor:"boolean",default:!0}),t("importcss_selector_converter",{processor:"function"}),t("importcss_selector_filter",{processor:r}),t("importcss_file_filter",{processor:r}),t("importcss_groups",{processor:"object[]"}),t("importcss_append",{processor:"boolean",default:!1}),(i=e).on("init",()=>{let s=M(),r={},t=I(y(i)),o=F(d(i)),l=(e,t)=>{if(L(i,e,t,r)){z(i,e,t,r);e=C(i,i.plugins.importcss,e,t);if(e)return t=e.name||c.DOM.uniqueId(),i.formatter.register(t,e),{title:e.title,format:t}}return null};u.each(R(i,i.getDoc(),I(g(i))),r=>{var e;w.test(r)||t&&!t(r)||(0<(e=B(o,r)).length?u.each(e,e=>{var t=l(r,e);t&&s.addItemToGroup(e.title,t)}):(e=l(r,null))&&s.addItem(e))});var e=s.toFormats();i.dispatch("addStyleModifications",{items:e,replace:!h(i)})}),s=e,{convertSelectorToFormat:e=>U(s,e)}})})();