(()=>{var r,t,e=tinymce.util.Tools.resolve("tinymce.PluginManager");let a=(e,t,r)=>!!r(e,t.prototype)||(null==(r=e.constructor)?void 0:r.name)===t.name,s=(r="string",e=>{return t=typeof(e=e),(null===e?"null":"object"==t&&Array.isArray(e)?"array":"object"==t&&a(e,String,(e,t)=>t.isPrototypeOf(e))?"string":t)===r;var t}),o=(t=void 0,e=>t===e);var n=tinymce.util.Tools.resolve("tinymce.util.Delay"),i=tinymce.util.Tools.resolve("tinymce.util.LocalStorage"),l=tinymce.util.Tools.resolve("tinymce.util.Tools");let u=e=>e.dispatch("RestoreDraft"),m=e=>e.dispatch("StoreDraft"),v=e=>e.dispatch("RemoveDraft"),d=e=>{var t=/^(\d+)([ms]?)$/.exec(e);return(t&&t[2]?{s:1e3,m:6e4}[t[2]]:1)*parseInt(e,10)};var f=t=>e=>e.options.get(t);let c=f("autosave_ask_before_unload"),p=f("autosave_restore_when_empty"),y=f("autosave_interval"),g=f("autosave_retention"),D=e=>{var t=document.location;return e.options.get("autosave_prefix").replace(/{path}/g,t.pathname).replace(/{query}/g,t.search).replace(/{hash}/g,t.hash).replace(/{id}/g,e.id)},h=(e,t)=>o(t)?e.dom.isEmpty(e.getBody()):""===(t=l.trim(t))||(t=(new DOMParser).parseFromString(t,"text/html"),e.dom.isEmpty(t)),_=e=>{var t=parseInt(null!=(t=i.getItem(D(e)+"time"))?t:"0",10)||0;return!((new Date).getTime()-t>g(e)&&(I(e,!1),1))},I=(e,t)=>{var r=D(e);i.removeItem(r+"draft"),i.removeItem(r+"time"),!1!==t&&v(e)},b=e=>{var t=D(e);!h(e)&&e.isDirty()&&(i.setItem(t+"draft",e.getContent({format:"raw",no_events:!0})),i.setItem(t+"time",(new Date).getTime().toString()),m(e))},w=e=>{var t=D(e);_(e)&&(e.setContent(null!=(t=i.getItem(t+"draft"))?t:"",{format:"raw"}),u(e))},R=e=>{var t=y(e);n.setEditorInterval(e,()=>{b(e)},t)},S=e=>{e.undoManager.transact(()=>{w(e),I(e)}),e.focus()};var E=tinymce.util.Tools.resolve("tinymce.EditorManager");let T=a=>e=>{let t=()=>_(a)&&!a.mode.isReadOnly(),r=(e.setEnabled(t()),()=>e.setEnabled(t()));return a.on("StoreDraft RestoreDraft RemoveDraft",r),()=>a.off("StoreDraft RestoreDraft RemoveDraft",r)};e.add("autosave",e=>{var t,r,a,o;return a=(a=e).options.register,t=e=>{var t=s(e);return t?{value:d(e),valid:t}:{valid:!1,message:"Must be a string."}},a("autosave_ask_before_unload",{processor:"boolean",default:!0}),a("autosave_prefix",{processor:"string",default:"tinymce-autosave-{path}{query}{hash}-{id}-"}),a("autosave_restore_when_empty",{processor:"boolean",default:!1}),a("autosave_interval",{processor:t,default:"30s"}),a("autosave_retention",{processor:t,default:"20m"}),e.editorManager.on("BeforeUnload",e=>{let t;l.each(E.get(),e=>{e.plugins.autosave&&e.plugins.autosave.storeDraft(),!t&&e.isDirty()&&c(e)&&(t=e.translate("You have unsaved changes are you sure you want to navigate away?"))}),t&&(e.preventDefault(),e.returnValue=t)}),r=e,R(r),a=()=>{S(r)},r.ui.registry.addButton("restoredraft",{tooltip:"Restore last draft",icon:"restore-draft",onAction:a,onSetup:T(r)}),r.ui.registry.addMenuItem("restoredraft",{text:"Restore last draft",icon:"restore-draft",onAction:a,onSetup:T(r)}),e.on("init",()=>{p(e)&&e.dom.isEmpty(e.getBody())&&w(e)}),o=e,{hasDraft:()=>_(o),storeDraft:()=>b(o),restoreDraft:()=>w(o),removeDraft:e=>I(o,e),isEmpty:e=>h(o,e)}})})();