layui.define(["form","layer","jquery","layTable","tabs"],function(t){let o=layui.form,u=layui.layer,a=layui.tabs,n=layui.layTable,c=layui.jquery,i={render:function(t){t=t||{};var e=c(t.formSelector||"#form"),a=t.triggers||[];return this.form(t),this.icon(),c("[data-file]").each(function(){let n=this;layui.use(["uploads"],function(){var t=layui.uploads,e="true"===n.dataset.multiple,a=n.dataset.file;new t({elem:"#"+c(n).attr("id"),type:a,multiple:e,sort:e})})}),this.inputDate(),this.color(),this.triggers(a,e),this.editor(),this.xmSelect(),this.cron(),i},form:function(t){o.render(),o.on("submit("+(t.layFilter||"")+")",function(t){var e=t.field,t=t.form.action;return c.ajax({type:"POST",url:t,data:e,dataType:"json",success:function(t){0===t.code?u.msg(t.msg,function(){u.closeAll();var t,e=c(".page-Table");0<e.length?n.reload(e.attr("id")):0===c(".happy-container").find(".layui-setting-box").length&&(t=(e=c("#happy-content").find(".layui-body-tabs")).find(".happy-tab-content").data("pageId"),e=e.attr("id"),a.close(e,t))}):u.alert(t.msg)}}),!1})},xmSelect:function(){c("[data-xm-select]").each(function(){let e=[],t=c(this),i=t.data("name"),a="#"+t.attr("id"),n=JSON.parse(c('[xm-select-value="'+i+'"]').text()),r=JSON.parse(c('[xm-select="'+i+'"]').text());layui.use(["xmSelect"],function(t){(r=Object.assign({},r,{el:a,theme:{color:"#16b777"},name:i,autoRow:!0,toolbar:{show:!0},filterable:!0,empty:"输入内容搜一下吧！",paging:!0,pageRemote:!0,prop:{name:"title",value:"id"},radio:r.radio||!1,data:r.dataInit??n})).remoteSearch&&r.searchUrl&&(r.remoteMethod=function(t,e,a,n){if(!t)return e([]);c.ajax({type:"POST",url:r.searchUrl,data:{keyword:t,add:r.autoAdd||!1,page:n},success:function(t){e(t.data.data,t.data.last_page)},error:function(){u.msg(i+"远程搜索异常")}})}),e[i]=t.render(r),r.dataInit&&c.ajax({type:"POST",url:r.dataInit,data:{id:n},success:function(t){e[i].update({data:t.data.data,autoRow:!0})},error:function(){u.msg("初始化"+i+"数据异常")}})})})},cron:function(){c("[data-input-cron]").each(function(){let t="#"+c(this).attr("id"),e=this.dataset.inputCron;layui.use(["cron"],function(){layui.cron.render({elem:t,run:e})})})},inputDate:function(){c("[data-input-date]").each(function(){let a=this,n=this.dataset.inputDate||"date",i=this.dataset.range||"";layui.use(["laydate"],function(){var t=layui.laydate,e={elem:a,type:n};i&&(e.range=i,e.rangeLinked=!0),t.render(e)})})},color:function(){c("[data-input-color]").each(function(){let t=this.dataset.inputColor,e=c("[name="+t+"]"),a=e.val()||"#1c97f5";layui.use(["colorpicker"],function(){layui.colorpicker.render({elem:this,color:a,done:function(t){e.val(t)}})})})},icon:function(){c("[data-icon]").on("click",function(){var t=this.dataset.icon;u.open({type:2,content:t,title:"图标选择",area:["800px","80%"]})}),c("[data-input-icon]").on("change",function(){c(this).next().find("i").get(0).className=this.value}).each(function(){c(this).trigger("change")})},editor:function(){c("[data-input-editor]").each(function(){let t=this.dataset.type,e=(this.dataset.inputEditor,c(this).attr("id"));switch(t){case"tinymce":layui.use(["tiny"],function(){layui.tiny.render({selector:"#"+e})});break;case"wangeditor":layui.use(["wangEdit"],function(){layui.wangEdit.render({elem:"#"+e})});break;case"ueditor":layui.use(["ueditor"],function(){layui.ueditor.render("#"+e)})}})},triggers:function(t,n){function i(t){return t.replace(/\[|\]/g,function(t){return"\\"+t})}function r(t,a){if(Array.isArray(t.values)){let e=new Set;t.values.forEach(function(t){Array.isArray(t.field)&&t.field.forEach(function(t){e.add(t)})}),e.forEach(function(t){t=i(t);n.find("#item-"+t).hide()});t.values.forEach(function(t){if(a.value===t.value)return Array.isArray(t.field)&&t.field.forEach(function(t){t=i(t);n.find("#item-"+t).show()}),!1})}}function e(a){Array.isArray(t)&&0!==t.length&&c.each(t,function(t,e){a.elem.getAttribute("name")===e.name&&r(e,a)})}function a(){Array.isArray(t)&&0!==t.length&&c.each(t,function(t,e){var a=i(e.name),a=n.find('[name="'+a+'"]'),a=(a=a).is(":radio")?a.filter(":checked").val():a.is(":checkbox")?a.is(":checked")?a.val():null:(a.is("select")&&console.log(a),a.val());r(e,{elem:null,value:a})})}Array.isArray(t)&&0<t.length&&(n.find("input").on("change",function(){e({elem:this,value:c(this).val()})}),o.on("radio",function(t){e(t)}),o.on("select",function(t){e(t)}),a())}};t("formsbuild",i)});