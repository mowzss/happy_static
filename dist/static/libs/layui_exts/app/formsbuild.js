layui.define(["form","layer","jquery","laytable","element"],function(t){var r=layui.form,i=layui.layer,n=layui.element,l=layui.jquery,o={render:function(t){var e=l((t=t||{}).formSelector||"#form"),a=t.triggers||[];return this.form(t),this.icon(),l("[data-file]").each(function(){var i=this;layui.use(["uploads"],function(){var t=layui.uploads,e="true"===i.dataset.multiple,a=i.dataset.file;new t({elem:"#"+l(i).attr("id"),type:a,multiple:e,sort:e})})}),this.inputDate(),this.color(),this.triggers(a,e),this.editor(),o},form:function(t){r.render(),r.on("submit("+(t.layFilter||"")+")",function(a){var t=a.field,e=a.form.action;return l.ajax({type:"POST",url:e,data:t,dataType:"json",success:function(t){0===t.code?i.msg(t.msg,function(){i.closeAll();var t,e=l(".page-Table");0<e.length?layui.laytable.reload(e.attr("id")):(e=l("#happy-content").find(".layui-body-tabs"),t=l(a.elem.form).attr("action"),t=e.find('[data-src="'+t+'"]').data("pageId"),e=e.attr("lay-filter"),n.tabDelete(e,t))}):i.alert(t.msg)}}),!1})},xmSelect:function(){l("[data-xm-select]").each(function(){let e=[],t=l(this),a=t.data("name"),i=t.attr("id");layui.use(["xmSelect"],function(t){e[a]=t.render({el:i})})})},inputDate:function(){l("[data-input-date]").each(function(){var t=this,e=this.dataset.inputDate||"date";layui.use(["laydate"],function(){layui.laydate.render({elem:t,type:e})})})},color:function(){l("[data-input-color]").each(function(){let t=this.dataset.inputColor,e=l("[name="+t+"]"),a=e.val()||"#1c97f5";layui.use(["colorpicker"],function(){layui.colorpicker.render({elem:this,color:a,done:function(t){e.val(t)}})})})},icon:function(){l("[data-icon]").on("click",function(){var t=this.dataset.icon;i.open({type:2,content:t,title:"图标选择",area:["800px","80%"]})}),l("[data-input-icon]").on("change",function(){l(this).next().find("i").get(0).className=this.value}).each(function(){l(this).trigger("change")})},editor:function(){l("[data-input-editor]").each(function(){var t=this.dataset.type,e=(this.dataset.inputEditor,l(this).attr("id"));switch(t){case"tinymce":layui.use(["tiny"],function(){layui.tiny.render({selector:"#"+e})});break;case"wangeditor":layui.use(["wangEdit"],function(){layui.wangEdit.render({elem:"#"+e})});break;case"ueditor":layui.use(["ueditor"],function(){layui.ueditor.render("#"+e)})}})},triggers:function(t,e){function i(t){return t.replace(/\[|\]/g,function(t){return"\\"+t})}function n(t,a){if(Array.isArray(t.values)){let e=new Set;t.values.forEach(function(t){Array.isArray(t.field)&&t.field.forEach(function(t){e.add(t)})}),e.forEach(function(t){t=i(t);l("#item-"+t).hide()});t.values.forEach(function(t){if(a.value===t.value)return Array.isArray(t.field)&&t.field.forEach(function(t){t=i(t);l("#item-"+t).show()}),!1})}}function a(a){Array.isArray(t)&&0!==t.length&&l.each(t,function(t,e){a.elem.getAttribute("name")===e.name&&n(e,a)})}Array.isArray(t)&&0<t.length&&(e.find("input").on("change",function(){a({elem:this,value:l(this).val()})}),r.on("radio",function(t){a(t)}),r.on("select",function(t){a(t)}),Array.isArray(t))&&0!==t.length&&l.each(t,function(t,e){var a=i(e.name),a=l('[name="'+a+'"]');n(e,{elem:null,value:(e=a).is(":radio")?e.filter(":checked").val():e.is(":checkbox")?e.is(":checked")?e.val():null:(e.is("select"),e.val())})})}};t("formsbuild",o)});