layui.define(["form","layer","jquery","laytable","element"],function(e){var a=layui.form,o=layui.layer,i=layui.element,l=layui.jquery,n={render:function(e){var t=l((e=e||{}).formSelector||"#form"),a=e.triggers||[];return this.form(e),this.icon(),l("[data-file]").each(function(){var i=this;layui.use(["uploads"],function(){var e=layui.uploads,t="true"===i.dataset.multiple,a=i.dataset.file;new e({elem:"#"+l(i).attr("id"),type:a,multiple:t,sort:t})})}),this.inputDate(),this.color(),this.triggers(a,t),this.editor(),this.xmSelect(),n},form:function(e){a.render(),a.on("submit("+(e.layFilter||"")+")",function(a){var e=a.field,t=a.form.action;return l.ajax({type:"POST",url:t,data:e,dataType:"json",success:function(e){0===e.code?o.msg(e.msg,function(){o.closeAll();var e,t=l(".page-Table");0<t.length?layui.laytable.reload(t.attr("id")):(t=l("#happy-content").find(".layui-body-tabs"),e=l(a.elem.form).attr("action"),e=t.find('[data-src="'+e+'"]').data("pageId"),t=t.attr("lay-filter"),i.tabDelete(t,e))}):o.alert(e.msg)}}),!1})},xmSelect:function(){l("[data-xm-select]").each(function(){let t=[],e=l(this),a=e.data("name"),i="#"+e.attr("id"),n=JSON.parse(l('[xm-select-value="'+a+'"]').text()||"[]"),r=JSON.parse(l('[xm-select="'+a+'"]').text()||"{}");layui.use(["xmSelect"],function(e){(r=Object.assign({},r,{el:i,theme:{color:"#16b777"},name:a,autoRow:!0,toolbar:{show:!0},filterable:!0,empty:"输入内容搜一下吧！",max:"{$max}",paging:!0,pageRemote:!0,prop:{name:"title",value:"id"},data:n})).remoteSearch&&r.searchUrl&&(r.remoteMethod=function(e,t,a,i){if(!e)return t([]);l.ajax({type:"POST",url:r.searchUrl,data:{keyword:e,add:r.autoAdd||!1,page:i},success:function(e){t(e.data.data,e.data.last_page)},error:function(){o.msg("搜索异常")}})}),t[a]=e.render(r)})})},inputDate:function(){l("[data-input-date]").each(function(){var a=this,i=this.dataset.inputDate||"date",n=this.dataset.range||"";layui.use(["laydate"],function(){var e=layui.laydate,t={elem:a,type:i};n&&(t.range=n,t.rangeLinked=!0),e.render(t)})})},color:function(){l("[data-input-color]").each(function(){let e=this.dataset.inputColor,t=l("[name="+e+"]"),a=t.val()||"#1c97f5";layui.use(["colorpicker"],function(){layui.colorpicker.render({elem:this,color:a,done:function(e){t.val(e)}})})})},icon:function(){l("[data-icon]").on("click",function(){var e=this.dataset.icon;o.open({type:2,content:e,title:"图标选择",area:["800px","80%"]})}),l("[data-input-icon]").on("change",function(){l(this).next().find("i").get(0).className=this.value}).each(function(){l(this).trigger("change")})},editor:function(){l("[data-input-editor]").each(function(){var e=this.dataset.type,t=(this.dataset.inputEditor,l(this).attr("id"));switch(e){case"tinymce":layui.use(["tiny"],function(){layui.tiny.render({selector:"#"+t})});break;case"wangeditor":layui.use(["wangEdit"],function(){layui.wangEdit.render({elem:"#"+t})});break;case"ueditor":layui.use(["ueditor"],function(){layui.ueditor.render("#"+t)})}})},triggers:function(e,i){function n(e){return e.replace(/\[|\]/g,function(e){return"\\"+e})}function r(e,a){if(Array.isArray(e.values)){let t=new Set;e.values.forEach(function(e){Array.isArray(e.field)&&e.field.forEach(function(e){t.add(e)})}),t.forEach(function(e){e=n(e);i.find("#item-"+e).hide()});e.values.forEach(function(e){if(a.value===e.value)return Array.isArray(e.field)&&e.field.forEach(function(e){e=n(e);i.find("#item-"+e).show()}),!1})}}function t(a){Array.isArray(e)&&0!==e.length&&l.each(e,function(e,t){a.elem.getAttribute("name")===t.name&&r(t,a)})}Array.isArray(e)&&0<e.length&&(i.find("input").on("change",function(){t({elem:this,value:l(this).val()})}),a.on("radio",function(e){t(e)}),a.on("select",function(e){t(e)}),Array.isArray(e))&&0!==e.length&&l.each(e,function(e,t){var a=n(t.name),a=l('[name="'+a+'"]');r(t,{elem:null,value:(t=a).is(":radio")?t.filter(":checked").val():t.is(":checkbox")?t.is(":checked")?t.val():null:(t.is("select"),t.val())})})}};e("formsbuild",n)});