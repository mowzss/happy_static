layui.define(["form","layer","jquery","layTable","tabs"],function(t){let a=layui.form,o=layui.layer,n=layui.tabs,i=layui.layTable,u=layui.jquery,r={render:function(t){t=t||{};var e=u(t.formSelector||"#form"),a=t.triggers||[];return this.form(t),this.icon(),u("[data-file]").each(function(){let n=this;layui.use(["uploads"],function(){var t=layui.uploads,e="true"===n.dataset.multiple,a=n.dataset.file;new t({elem:"#"+u(n).attr("id"),type:a,multiple:e,sort:e})})}),this.inputDate(),this.color(),this.triggers(a,e),this.editor(),this.xmSelect(),this.cron(),r},form:function(t){a.render(),a.on("submit("+(t.layFilter||"")+")",function(t){var e=t.field,t=t.form.action;return u.ajax({type:"POST",url:t,data:e,dataType:"json",success:function(t){0===t.code?o.msg(t.msg,function(){o.closeAll();var t,e=u(".page-Table");0<e.length?i.reload(e.attr("id")):0===u(".happy-container").find(".layui-setting-box").length&&(t=(e=u("#happy-content").find(".layui-body-tabs")).find(".happy-tab-content").data("pageId"),e=e.attr("id"),n.close(e,t))}):o.alert(t.msg)}}),!1})},xmSelect:function(){u("[data-xm-select]").each(function(){let e=[],t=u(this),a=t.data("name"),n="#"+t.attr("id"),i=JSON.parse(u('[xm-select-value="'+a+'"]').text()),r=JSON.parse(u('[xm-select="'+a+'"]').text());layui.use(["xmSelect"],function(t){(r=Object.assign({},r,{el:n,theme:{color:"#16b777"},name:a,autoRow:!0,toolbar:{show:!0},filterable:!0,empty:"输入内容搜一下吧！",paging:!0,pageRemote:!0,prop:{name:"title",value:"id"},data:i,radio:r.radio||!1})).remoteSearch&&r.searchUrl&&(r.remoteMethod=function(t,e,a,n){if(!t)return e([]);u.ajax({type:"POST",url:r.searchUrl,data:{keyword:t,add:r.autoAdd||!1,page:n},success:function(t){e(t.data.data,t.data.last_page)},error:function(){o.msg("搜索异常")}})}),e[a]=t.render(r)})})},cron:function(){u("[data-input-cron]").each(function(){let t="#"+u(this).attr("id"),e=this.dataset.inputCron;layui.use(["cron"],function(){layui.cron.render({elem:t,run:e})})})},inputDate:function(){u("[data-input-date]").each(function(){let a=this,n=this.dataset.inputDate||"date",i=this.dataset.range||"";layui.use(["laydate"],function(){var t=layui.laydate,e={elem:a,type:n};i&&(e.range=i,e.rangeLinked=!0),t.render(e)})})},color:function(){u("[data-input-color]").each(function(){let t=this.dataset.inputColor,e=u("[name="+t+"]"),a=e.val()||"#1c97f5";layui.use(["colorpicker"],function(){layui.colorpicker.render({elem:this,color:a,done:function(t){e.val(t)}})})})},icon:function(){u("[data-icon]").on("click",function(){var t=this.dataset.icon;o.open({type:2,content:t,title:"图标选择",area:["800px","80%"]})}),u("[data-input-icon]").on("change",function(){u(this).next().find("i").get(0).className=this.value}).each(function(){u(this).trigger("change")})},editor:function(){u("[data-input-editor]").each(function(){let t=this.dataset.type,e=(this.dataset.inputEditor,u(this).attr("id"));switch(t){case"tinymce":layui.use(["tiny"],function(){layui.tiny.render({selector:"#"+e})});break;case"wangeditor":layui.use(["wangEdit"],function(){layui.wangEdit.render({elem:"#"+e})});break;case"ueditor":layui.use(["ueditor"],function(){layui.ueditor.render("#"+e)})}})},triggers:function(t,n){function i(t){return t.replace(/\[|\]/g,function(t){return"\\"+t})}function r(t,a){if(Array.isArray(t.values)){let e=new Set;t.values.forEach(function(t){Array.isArray(t.field)&&t.field.forEach(function(t){e.add(t)})}),e.forEach(function(t){t=i(t);n.find("#item-"+t).hide()});t.values.forEach(function(t){if(a.value===t.value)return Array.isArray(t.field)&&t.field.forEach(function(t){t=i(t);n.find("#item-"+t).show()}),!1})}}function e(a){Array.isArray(t)&&0!==t.length&&u.each(t,function(t,e){a.elem.getAttribute("name")===e.name&&r(e,a)})}Array.isArray(t)&&0<t.length&&(n.find("input").on("change",function(){e({elem:this,value:u(this).val()})}),a.on("radio",function(t){e(t)}),a.on("select",function(t){e(t)}),Array.isArray(t))&&0!==t.length&&u.each(t,function(t,e){var a=i(e.name),a=u('[name="'+a+'"]'),a=(a=a).is(":radio")?a.filter(":checked").val():a.is(":checkbox")?a.is(":checked")?a.val():null:(a.is("select"),a.val());r(e,{elem:null,value:a})})}};t("formsbuild",r)});