layui.define(["form","layer","jquery","layTable","tabs"],function(e){let a=layui.form,o=layui.layer,n=layui.element,i=layui.layTable,l=layui.jquery,r={render:function(e){e=e||{};var t=l(e.formSelector||"#form"),a=e.triggers||[];return this.form(e),this.icon(),l("[data-file]").each(function(){let n=this;layui.use(["uploads"],function(){var e=layui.uploads,t="true"===n.dataset.multiple,a=n.dataset.file;new e({elem:"#"+l(n).attr("id"),type:a,multiple:t,sort:t})})}),this.inputDate(),this.color(),this.triggers(a,t),this.editor(),this.xmSelect(),this.cron(),r},form:function(e){a.render(),a.on("submit("+(e.layFilter||"")+")",function(e){var t=e.field,e=e.form.action;return l.ajax({type:"POST",url:e,data:t,dataType:"json",success:function(e){0===e.code?o.msg(e.msg,function(){o.closeAll();var e,t=l(".page-Table");0<t.length?i.reload(t.attr("id")):0===l(".happy-container").find(".layui-setting-box").length&&(e=(t=l("#happy-content").find(".layui-body-tabs")).find(".happy-tab-content").data("pageId"),t=t.attr("id"),n.close(t,e))}):o.alert(e.msg)}}),!1})},xmSelect:function(){l("[data-xm-select]").each(function(){let t=[],e=l(this),a=e.data("name"),n="#"+e.attr("id"),i=JSON.parse(l('[xm-select-value="'+a+'"]').text()||"[]"),r=JSON.parse(l('[xm-select="'+a+'"]').text()||"{}");layui.use(["xmSelect"],function(e){(r=Object.assign({},r,{el:n,theme:{color:"#16b777"},name:a,autoRow:!0,toolbar:{show:!0},filterable:!0,empty:"输入内容搜一下吧！",paging:!0,pageRemote:!0,prop:{name:"title",value:"id"},data:i})).remoteSearch&&r.searchUrl&&(r.remoteMethod=function(e,t,a,n){if(!e)return t([]);l.ajax({type:"POST",url:r.searchUrl,data:{keyword:e,add:r.autoAdd||!1,page:n},success:function(e){t(e.data.data,e.data.last_page)},error:function(){o.msg("搜索异常")}})}),t[a]=e.render(r)})})},cron:function(){l("[data-input-cron]").each(function(){let e="#"+l(this).attr("id"),t=this.dataset.inputCron;layui.use(["cron"],function(){layui.cron.render({elem:e,run:t})})})},inputDate:function(){l("[data-input-date]").each(function(){let a=this,n=this.dataset.inputDate||"date",i=this.dataset.range||"";layui.use(["laydate"],function(){var e=layui.laydate,t={elem:a,type:n};i&&(t.range=i,t.rangeLinked=!0),e.render(t)})})},color:function(){l("[data-input-color]").each(function(){let e=this.dataset.inputColor,t=l("[name="+e+"]"),a=t.val()||"#1c97f5";layui.use(["colorpicker"],function(){layui.colorpicker.render({elem:this,color:a,done:function(e){t.val(e)}})})})},icon:function(){l("[data-icon]").on("click",function(){var e=this.dataset.icon;o.open({type:2,content:e,title:"图标选择",area:["800px","80%"]})}),l("[data-input-icon]").on("change",function(){l(this).next().find("i").get(0).className=this.value}).each(function(){l(this).trigger("change")})},editor:function(){l("[data-input-editor]").each(function(){let e=this.dataset.type,t=(this.dataset.inputEditor,l(this).attr("id"));switch(e){case"tinymce":layui.use(["tiny"],function(){layui.tiny.render({selector:"#"+t})});break;case"wangeditor":layui.use(["wangEdit"],function(){layui.wangEdit.render({elem:"#"+t})});break;case"ueditor":layui.use(["ueditor"],function(){layui.ueditor.render("#"+t)})}})},triggers:function(e,n){function i(e){return e.replace(/\[|\]/g,function(e){return"\\"+e})}function r(e,a){if(Array.isArray(e.values)){let t=new Set;e.values.forEach(function(e){Array.isArray(e.field)&&e.field.forEach(function(e){t.add(e)})}),t.forEach(function(e){e=i(e);n.find("#item-"+e).hide()});e.values.forEach(function(e){if(a.value===e.value)return Array.isArray(e.field)&&e.field.forEach(function(e){e=i(e);n.find("#item-"+e).show()}),!1})}}function t(a){Array.isArray(e)&&0!==e.length&&l.each(e,function(e,t){a.elem.getAttribute("name")===t.name&&r(t,a)})}Array.isArray(e)&&0<e.length&&(n.find("input").on("change",function(){t({elem:this,value:l(this).val()})}),a.on("radio",function(e){t(e)}),a.on("select",function(e){t(e)}),Array.isArray(e))&&0!==e.length&&l.each(e,function(e,t){var a=i(t.name),a=l('[name="'+a+'"]'),a=(a=a).is(":radio")?a.filter(":checked").val():a.is(":checkbox")?a.is(":checked")?a.val():null:(a.is("select"),a.val());r(t,{elem:null,value:a})})}};e("formsbuild",r)});