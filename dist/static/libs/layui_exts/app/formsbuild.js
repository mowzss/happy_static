layui.define(["form","layer","jquery","laytable","element"],function(e){let a=layui.form,l=layui.layer,i=layui.element,n=layui.laytable,o=layui.jquery,r={render:function(e){e=e||{};var t=o(e.formSelector||"#form"),a=e.triggers||[];return this.form(e),this.icon(),o("[data-file]").each(function(){let i=this;layui.use(["uploads"],function(){var e=layui.uploads,t="true"===i.dataset.multiple,a=i.dataset.file;new e({elem:"#"+o(i).attr("id"),type:a,multiple:t,sort:t})})}),this.inputDate(),this.color(),this.triggers(a,t),this.editor(),this.xmSelect(),r},form:function(e){a.render(),a.on("submit("+(e.layFilter||"")+")",function(e){var t=e.field,e=e.form.action;return o.ajax({type:"POST",url:e,data:t,dataType:"json",success:function(e){0===e.code?l.msg(e.msg,function(){l.closeAll();var e,t=o(".page-Table");0<t.length?n.reload(t.attr("id")):0===o(".happy-container").find(".layui-setting-box").length&&(e=(t=o("#happy-content").find(".layui-body-tabs")).find(".happy-tab-content").data("pageId"),t=t.attr("lay-filter"),i.tabDelete(t,e))}):l.alert(e.msg)}}),!1})},xmSelect:function(){o("[data-xm-select]").each(function(){let t=[],e=o(this),a=e.data("name"),i="#"+e.attr("id"),n=JSON.parse(o('[xm-select-value="'+a+'"]').text()||"[]"),r=JSON.parse(o('[xm-select="'+a+'"]').text()||"{}");layui.use(["xmSelect"],function(e){(r=Object.assign({},r,{el:i,theme:{color:"#16b777"},name:a,autoRow:!0,toolbar:{show:!0},filterable:!0,empty:"输入内容搜一下吧！",max:"{$max}",paging:!0,pageRemote:!0,prop:{name:"title",value:"id"},data:n})).remoteSearch&&r.searchUrl&&(r.remoteMethod=function(e,t,a,i){if(!e)return t([]);o.ajax({type:"POST",url:r.searchUrl,data:{keyword:e,add:r.autoAdd||!1,page:i},success:function(e){t(e.data.data,e.data.last_page)},error:function(){l.msg("搜索异常")}})}),t[a]=e.render(r)})})},inputDate:function(){o("[data-input-date]").each(function(){let a=this,i=this.dataset.inputDate||"date",n=this.dataset.range||"";layui.use(["laydate"],function(){var e=layui.laydate,t={elem:a,type:i};n&&(t.range=n,t.rangeLinked=!0),e.render(t)})})},color:function(){o("[data-input-color]").each(function(){let e=this.dataset.inputColor,t=o("[name="+e+"]"),a=t.val()||"#1c97f5";layui.use(["colorpicker"],function(){layui.colorpicker.render({elem:this,color:a,done:function(e){t.val(e)}})})})},icon:function(){o("[data-icon]").on("click",function(){var e=this.dataset.icon;l.open({type:2,content:e,title:"图标选择",area:["800px","80%"]})}),o("[data-input-icon]").on("change",function(){o(this).next().find("i").get(0).className=this.value}).each(function(){o(this).trigger("change")})},editor:function(){o("[data-input-editor]").each(function(){let e=this.dataset.type,t=(this.dataset.inputEditor,o(this).attr("id"));switch(e){case"tinymce":layui.use(["tiny"],function(){layui.tiny.render({selector:"#"+t})});break;case"wangeditor":layui.use(["wangEdit"],function(){layui.wangEdit.render({elem:"#"+t})});break;case"ueditor":layui.use(["ueditor"],function(){layui.ueditor.render("#"+t)})}})},triggers:function(e,i){function n(e){return e.replace(/\[|\]/g,function(e){return"\\"+e})}function r(e,a){if(Array.isArray(e.values)){let t=new Set;e.values.forEach(function(e){Array.isArray(e.field)&&e.field.forEach(function(e){t.add(e)})}),t.forEach(function(e){e=n(e);i.find("#item-"+e).hide()});e.values.forEach(function(e){if(a.value===e.value)return Array.isArray(e.field)&&e.field.forEach(function(e){e=n(e);i.find("#item-"+e).show()}),!1})}}function t(a){Array.isArray(e)&&0!==e.length&&o.each(e,function(e,t){a.elem.getAttribute("name")===t.name&&r(t,a)})}Array.isArray(e)&&0<e.length&&(i.find("input").on("change",function(){t({elem:this,value:o(this).val()})}),a.on("radio",function(e){t(e)}),a.on("select",function(e){t(e)}),Array.isArray(e))&&0!==e.length&&o.each(e,function(e,t){var a=n(t.name),a=o('[name="'+a+'"]'),a=(a=a).is(":radio")?a.filter(":checked").val():a.is(":checkbox")?a.is(":checked")?a.val():null:(a.is("select"),a.val());r(t,{elem:null,value:a})})}};e("formsbuild",r)});