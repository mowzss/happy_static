layui.define(["tabs","layer","jquery","dropdown"],function(e){let s=layui.jquery,o=layui.tabs,t=layui.dropdown,l=layui.layer;e("layTabs",{config:{elem:"layTabs"},rightMenu:function(e){let a=this;t.render({elem:"#"+a.config.elem+" .layui-tabs-header>li",trigger:"contextmenu",data:[{title:"关闭",icon:"iconfont icon-cuowuguanbiquxiao",action:"close",mode:"this"},{title:"刷新",icon:"iconfont icon-shuaxin",action:"refresh",mode:"this"},{type:"-"},{title:"关闭右侧",icon:"iconfont icon-zuihouye",action:"close",mode:"right"},{title:"关闭其它",icon:"iconfont icon-hengxiangshouqi",action:"close",mode:"other"},{type:"-"},{title:"关闭所有",icon:"iconfont icon-guanbiquanbu",action:"close",mode:"all"}],click:function(e,t,i){var n=this.elem.index();"close"===e.action?"this"===e.mode?o.close(a.config.elem,n):o.closeMult(a.config.elem,e.mode,n):"refresh"===e.action&&"this"===e.mode&&o.change(a.config.elem,n)},templet:function(e){return'<i class="'+e.icon+'" style="font-size: 14px"></> '+e.title}})},showLoadingBar:function(){s("#loading-bar").css("width","0%").show(),setTimeout(()=>{s("#loading-bar").css("width","100%")},0)},hideLoadingBar:function(){setTimeout(()=>{s("#loading-bar").css("width","0%").hide()},2e3)},on:function(){let a=this;o.on("beforeChange("+a.config.elem+")",function(e){s("#"+a.config.elem).find(".layui-tabs-body > .layui-tabs-item").empty()}),o.on("afterChange("+a.config.elem+")",function(t){var e=s(t.thisHeaderItem);let i=e.attr("lay-url"),n=e.attr("lay-id");i&&s.ajax({url:i,type:"GET",dataType:"html",success:function(e){e.startsWith("{")||e.startsWith("[")?((e=JSON.parse(e)).info&&l.msg(e.info),e.url&&setTimeout(function(){window.location.href=e.url},1500)):(s(t.thisBodyItem).html(`<div class="happy-tab-content" style="display: block"
                                 data-page-id="${n}" 
                                 data-src="${i}">
                                ${e}
                            </div>`),setTimeout(()=>{s(t.thisBodyItem).find(".happy-tab-content").addClass("animated slideInFromBottom")},200))},error:function(){l.msg("加载失败，请重试！")}}),sessionStorage.setItem("tabsActiveId",n),a.activeTabMenu(n)}),o.on("beforeClose("+a.config.elem+")",function(e){var t=e.index,e=s(e.container.header.items).eq(t).attr("lay-id");a.delSessionTabs(e)}),o.on("afterClose("+a.config.elem+")",function(e){a.delSessionTabsAll();e=e.container.header.items;0<e.length&&layui.each(e,function(e,t){t=s(t),t={id:t.attr("lay-id"),title:t.text(),url:t.attr("lay-url"),closable:t.attr("lay-closable")};a.updataSessionTabs(t.id,t)})})},add:function(e){let t=this,i=String(e.id),n=s.extend({id:String(e.id),done:function(){t.rightMenu()}},e);t.showLoadingBar(),t.tabIsExist(i)?o.change(t.config.elem,i):o.add(t.config.elem,n),t.updataSessionTabs(i,n),t.hideLoadingBar()},tabIsExist:function(e){let t=!1;return s("#"+this.config.elem).find(".layui-tabs-header li").each(function(){if(s(this).attr("lay-id")===e)return!(t=!0)}),t},activeTabMenu:function(e){var t=s("#menu-container"),i=t.find("[lay-id]").filter(function(){return s(this).attr("lay-id")===e});t.find(".layui-nav-item").removeClass("layui-this"),0<i.length&&(t.find(".side-menu-container").hide(),t=i.parents(".side-menu-container").show().attr("data-tab-id"),i.parent(".layui-nav-item").addClass("layui-this"),(i=i.parents(".side-menu-container > .layui-nav-item")).hasClass("layui-nav-itemed")||i.addClass("layui-nav-itemed"),t)&&((i=s("#topNav")).find(".layui-nav-item").removeClass("layui-this"),i.find('.layui-nav-item[data-tab-id="'+t+'"]').addClass("layui-this"))},updataSessionTabs:function(e,t){var i=JSON.parse(sessionStorage.getItem("tabsList"))||[];let n=String(e);-1===i.findIndex(e=>e.id===n)&&i.push({id:n,...t}),sessionStorage.setItem("tabsList",JSON.stringify(i)),sessionStorage.setItem("tabsActiveId",n)},delSessionTabs:function(t){var e=JSON.parse(sessionStorage.getItem("tabsList"))||[],i=e.findIndex(e=>e.id===t);-1!==i&&(e.splice(i,1),sessionStorage.setItem("tabsList",JSON.stringify(e)))},delSessionTabsAll:function(){sessionStorage.removeItem("tabsList")},requestFullscreen:function(i){return new Promise((e,t)=>{i.requestFullscreen?i.requestFullscreen().then(e).catch(t):i.mozRequestFullScreen?i.mozRequestFullScreen().then(e).catch(t):i.webkitRequestFullscreen?i.webkitRequestFullscreen().then(e).catch(t):i.msRequestFullscreen?i.msRequestFullscreen().then(e).catch(t):t(new Error("浏览器不支持全屏"))})},exitFullscreen:function(){return new Promise((e,t)=>{document.exitFullscreen?document.exitFullscreen().then(e).catch(t):document.mozCancelFullScreen?document.mozCancelFullScreen().then(e).catch(t):document.webkitExitFullscreen?document.webkitExitFullscreen().then(e).catch(t):document.msExitFullscreen?document.msExitFullscreen().then(e).catch(t):t(new Error("浏览器不支持退出全屏"))})}})});