layui.define(["util","element","layer","jquery","pageTab","menu"],function(e){let a=layui.util,i=layui.layer,l=layui.jquery,n=layui.pageTab,t=layui.menu,s=layui.element,o={config:{tabFilter:"layout-filter-tab",tabsContent:"#happy-content > .layui-body-tabs",menuUrl:""},render:function(e){this.config=l.extend({},this.config,e),this.renderTabs(),t.render(this.config.menuUrl),this.events(),this.initTabs(),n.rightMenu({filter:this.config.tabFilter}),this.closeLoading()},initTabs:function(){var e=JSON.parse(sessionStorage.getItem("tabsList"))||[];let a=String(sessionStorage.getItem("tabsActiveId"));e.forEach(e=>{n.addTab(e)}),a&&e.some(e=>e.id===a)?s.tabChange(this.config.tabFilter,a):0<e.length&&s.tabChange(this.config.tabFilter,e[0].id),s.init()},renderTabs:function(){var e=`
        <div class="layui-body-tabs layui-tab-rollTool layui-tab" lay-allowclose="true" lay-unauto lay-filter="${o.config.tabFilter}">
            <ul class="layui-tab-title"></ul>
            <div class="layui-tab-content"></div>
            <div class="layui-tab-subsidiary">
                <span class="layui-tab-subsidiary-refresh" lay-header-event="refreshTab">
                    <em class="layui-icon layui-icon-refresh"></em>
                </span>
                <span class="layui-tab-subsidiary-screen-full" lay-header-event="tabFullScreen">
                    <em class="layui-icon layui-icon-screen-full"></em>
                </span>
                <span class="layui-tab-subsidiary-prev" lay-header-event="moveTabs" data-value="prev"><em class="layui-icon layui-icon-prev"></em></span>
                <span class="layui-tab-subsidiary-next" lay-header-event="moveTabs" data-value="next"><em class="layui-icon layui-icon-next"></em></span>
                 
            </div>
        </div>
    `;l("#happy-content").html(e),s.render("tab",o.config.tabFilter)},closeLoading:function(){l(".loading-mask").addClass("hidden")},events:function(){n.onTab(),a.event("lay-header-event",{cleanCache:function(e){let a=e.data("url");i.confirm("确认清理缓存？",function(){sessionStorage.clear(),a?l.ajax({url:a,type:"GET",success:function(e){i.msg(e.msg)}}):i.msg("本地缓存已清空")})},fullScreen:function(e){let a=e.find("em");if(document.fullscreenElement)try{n.exitFullscreen().then(()=>{a.removeClass("layui-icon-screen-restore").addClass("layui-icon-screen-full"),e.attr("title","全屏")}).catch(e=>{i.msg("无法退出全屏模式,请手动操作")})}catch(e){i.msg("无法退出全屏模式,请手动操作")}else try{n.requestFullscreen(document.documentElement).then(()=>{a.removeClass("layui-icon-screen-full").addClass("layui-icon-screen-restore"),e.attr("title","退出全屏")}).catch(e=>{i.msg("无法进入全屏模式,请手动操作")})}catch(e){i.msg("无法进入全屏模式,请手动操作")}},tabFullScreen:function(e){l(".right-menu").find('[data-event="toggleFullScreen"]').trigger("click")},menuSwitch:function(e){var a=l(".happy-admin-layout").find(".layui-layout-admin");a.hasClass("mini-nav")?(l(".layui-nav-item i").css("left",25),a.removeClass("mini-nav"),localStorage.setItem("mimiMenu","false")):(l(".layui-nav-item i").css("left",20),a.addClass("mini-nav"),localStorage.setItem("mimiMenu","true"))},refreshTab:function(){n.refreshTab()},moveTabs:function(e){e=e.data("value");n.moveTabs(e)},logout:function(e){let a=e.data("href");a&&i.confirm("确认退出系统？",function(){l.ajax({url:a,type:"GET",success:function(e){i.msg(e.msg),0===e.code&&setTimeout(function(){sessionStorage.clear(),localStorage.clear(),location.href=e.url},1e3)}})})},menuRight:function(e){i.open({type:1,title:"系统信息",area:["300px","100%"],offset:"r",anim:"slideLeft",closeBtn:0,shadeClose:!0,content:""})}}),a.event("lay-on",{open:function(){}}),s.on("nav(lay-nav)",function(e){var a,t,e=l(e);1===e.parents(".mini-nav").length&&l('[lay-header-event="menuSwitch"]').trigger("click"),0===e.find(".layui-nav-more").length&&(a=(e=l(this)).find(".happy-nav-title").html(),t=e.attr("lay-id"),e=e.attr("lay-url"),n.addTab({id:t,title:a,url:e,change:!0}))}),this.onBody()},onBody:function(){var e=l("body");e.on("click","[data-open]",function(e){var a=l(e.target).data("open"),t=a.split("?")[0],e=l(e.target).text();n.addTab({id:t,title:e,url:a,allowClose:!0,change:!0})}),e.on("click","[data-win-open]",function(e){e=l(e.target).data("winOpen");window.open(e,"_blank")}),e.on("click","[data-ajax]",function(e){let a=i.load(1);e.preventDefault();var e=this.dataset.ajax,t=this.dataset.type||"GET",n=this.dataset.value||{};l.ajax({url:e,type:t,data:n,success:function(e){i.close(a),e.code,i.msg(e.msg)},error:function(){i.close(a),i.msg("网络错误")}})})}};e("admin",o)});