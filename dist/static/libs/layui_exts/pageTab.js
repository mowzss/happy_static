layui.define(["element","util","layer"],function(t){let a=layui.element,o=layui.jquery,s=layui.layer;function e(t){var e={filter:c.config.tabFilter,pintabIDs:["home"],navArr:[{eventName:"closeThis",title:"关闭",icon:"iconfont icon-cuowuguanbiquxiao"},{eventName:"refreshThis",title:"刷新标签",icon:"iconfont icon-shuaxin"},{eventName:"line",title:""},{eventName:"closeLeft",title:"关闭左侧标签页",icon:"iconfont icon-diyiye"},{eventName:"closeRight",title:"关闭右侧标签页",icon:"iconfont icon-zuihouye"},{eventName:"line",title:""},{eventName:"closeOther",title:"关闭其它标签页",icon:"iconfont icon-hengxiangshouqi"},{eventName:"closeAll",title:"关闭所有标签页",icon:"iconfont icon-guanbiquanbu"}]};this.config={...e,...t},this.pintabIDs=this.config.pintabIDs,this.menuElement=null,this.currentActiveTabID=null,this.config&&this.render(this.config)}function r(t,e){t.scrollLeft();var i=e.offset().left-t.offset().left+t.scrollLeft(),e=e.outerWidth();t.animate({scrollLeft:i-(t.width()-e)/2},300)}e.prototype.render=function(t){t.filter?(this.filter=t.filter,this.pintabIDs=t.pintabIDs||[],this.navArr=t.navArr||defaultConfig.navArr,this.menuElement||(this.menuElement=o("<ul class='right-menu'></ul>").appendTo("body")),this.renderMenuItems(),this.bindEvents()):console.error("[ERROR] 使用 tabRightMenu 组件需要指定 'filter' 属性！")},e.prototype.renderMenuItems=function(){var t=this.navArr.map(t=>"line"===t.eventName?"<hr/>":`<li data-type="${t.eventName}"><i class="${t.icon||""}"></i>${t.title}</li>`).join("");this.menuElement.html(t)},e.prototype.bindEvents=function(){var e=this;o("#happy-content .layui-body-tabs").on("contextmenu",".layui-tab-title > li",t=>{t.preventDefault(),e.showMenu(t,o(t.currentTarget).attr("lay-id"))}),o(document).off("click.rightMenu"),o(document).on("click.rightMenu",t=>{e.menuElement.is(t.target)||0!==e.menuElement.has(t.target).length||e.hideMenu()}),this.menuElement.on("click","li[data-type]",t=>{t.stopPropagation();t=o(t.currentTarget).attr("data-type");t&&e.handleMenuItemClick(t)})},e.prototype.showMenu=function(t,e){var i;e&&(this.currentActiveTabID=e,e=this.menuElement,i=o(document).width()-t.clientX<e.width()?t.clientX-e.width():t.clientX,t=o(document).height()-t.clientY<e.height()?t.clientY-e.height():t.clientY,e.css({left:i,top:t}).show())},e.prototype.hideMenu=function(){this.menuElement.hide()},e.prototype.handleMenuItemClick=function(e){if(e){let t=o(".layui-tab[lay-filter='"+this.filter+"'] li"),n=!1;switch(e){case"refreshThis":var i=o(`.layui-tab-item[lay-id="${this.currentActiveTabID}"]`);i.length&&i.load();break;case"closeThis":this.isAllowClose(this.currentActiveTabID)?(a.tabDelete(this.filter,this.currentActiveTabID),(i=t.not(`[lay-id="${this.currentActiveTabID}"]`).first()).length&&a.tabChange(this.filter,i.attr("lay-id"))):s.msg("此页不允许关闭");break;case"closeAll":o.each(t,(t,e)=>{e=o(e).attr("lay-id");this.isAllowClose(e)&&a.tabDelete(this.filter,e)});break;case"closeOther":o.each(t,(t,e)=>{e=o(e).attr("lay-id");this.isAllowClose(e)&&e!==this.currentActiveTabID&&a.tabDelete(this.filter,e)});break;case"closeLeft":o.each(t,(t,e)=>{e=o(e).attr("lay-id");e===this.currentActiveTabID?n=!0:n||this.isAllowClose(e)&&a.tabDelete(this.filter,e)});break;case"closeRight":n=!1,o.each(t,(t,e)=>{var i=o(e).attr("lay-id");i===this.currentActiveTabID?n=!0:n&&this.isAllowClose(i)&&setTimeout(()=>{a.tabDelete(this.filter,i)},0)})}this.hideMenu()}},e.prototype.isAllowClose=function(t){return!(this.pintabIDs.includes(t)||void 0===t)};let c={config:{tabFilter:"layout-filter-tab",tabsContent:"#happy-content > .layui-body-tabs"},showLoadingBar:function(){o("#loading-bar").css("width","0%").show(),setTimeout(()=>{o("#loading-bar").css("width","100%")},0)},hideLoadingBar:function(){setTimeout(()=>{o("#loading-bar").css("width","0%").hide()},2e3)},getActiveTabId:function(){return o(this.config.tabsContent).find(".layui-tab-title li[lay-id].layui-this").attr("lay-id")},refreshTab:function(){let n=this,t=this.getActiveTabId();if(t){var a=o(this.config.tabsContent).find(`.layui-tab-title li[lay-id="${t}"]`).attr("lay-url");if(a){let e=o(this.config.tabsContent).find(`.layui-tab-item[lay-id="${t}"] .happy-tab-content`),i=s.load();e.empty(),this.showLoadingBar(),o.ajax({url:a,type:"GET",success:function(t){e.html(t),s.close(i),setTimeout(()=>{e.show().addClass("animated slideInFromBottom")},100),n.hideLoadingBar()},error:function(){s.msg("刷新失败，请重试！"),n.hideLoadingBar()}})}else s.msg("该标签页没有关联的URL，无法刷新！")}},addTab:function(t){var e=t.id,i=t.url,t=t.title;this.tabIsExist(e)?a.tabChange(this.config.tabFilter,e):a.tabAdd(this.config.tabFilter,{id:e,title:t,url:i,change:!0,allowClose:!0})},tabIsExist:function(t){let e=!1;return o(this.config.tabsContent).find(".layui-tab-title li").each(function(){if(o(this).attr("lay-id")===t)return!(e=!0)}),e},clearOtherTabsContent:function(t){o(this.config.tabsContent).find(".layui-tab-item").each(function(){o(this).attr("lay-id")!==t&&o(this).empty()})},changeTab:function(){a.on("tab("+this.config.tabFilter+")",function(t){var e=o(t.elem),i=e.find(".layui-this");r(e,i);let n=t.id,a=o(`.layui-tab-title li[lay-id="${n}"]`).attr("lay-url"),l=o(`.layui-tab-item[lay-id="${n}"]`);0!==l.find(".happy-tab-content").length&&l.find(".happy-tab-content").is(":visible")?setTimeout(()=>{l.find(".happy-tab-content").show().addClass("animated slideInFromBottom")},100):a&&(c.showLoadingBar(),o.ajax({url:a,type:"GET",success:function(t){l.html(`
                            <div class="happy-tab-content" 
                                 style="display:none;" 
                                 data-page-id="${n}" 
                                 data-src="${a}">
                                ${t}
                            </div>
                        `),setTimeout(()=>{l.find(".happy-tab-content").show().addClass("animated slideInFromBottom")},100),c.hideLoadingBar()},error:function(){s.msg("加载失败，请重试！"),c.hideLoadingBar()}})),c.clearOtherTabsContent(n)})},rightMenu:function(t){return new e(t)},close:function(t){a.tabDelete(this.config.tabFilter,t)},closeOther:function(e){o(this.config.tabsContent).find(".layui-tab-title li").each(function(t){t!==e&&a.tabDelete(c.config.tabFilter,t)})},moveTabs:function(t){var e,i=o(this.config.tabsContent).find(".layui-tab-title"),n=i.find(".layui-this"),a=i.children("li"),n=a.index(n);"prev"===t&&0<n?e=n-1:"next"===t&&n<a.length-1&&(e=n+1),void 0!==e&&((t=a.eq(e)).trigger("click"),r(i,t))}};t("pageTab",c)});