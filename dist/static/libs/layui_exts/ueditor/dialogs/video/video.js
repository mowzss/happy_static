/*! UEditorPlus v2.0.0*/
(()=>{function t(){for(var e,t=["videoFloat","upload_alignment"],i=0;e=t[i++];){var a,o=$G(e),r={none:lang.default,left:lang.floatLeft,right:lang.floatRight,center:lang.block};for(a in r){var n=document.createElement("div");n.setAttribute("name",a),"none"==a&&(n.className="focus"),n.style.cssText="background:url(images/"+a+"_focus.jpg);",n.setAttribute("title",r[a]),o.appendChild(n)}(e=>{for(var t,i=$G(e).children,a=0;t=i[a++];)domUtils.on(t,"click",function(){for(var e,t=0;e=i[t++];)e.className="",e.removeAttribute&&e.removeAttribute("class");this.className="focus"})})(e)}l=$G("videoUrl"),browser.ie?l.onpropertychange=function(){h(this.value)}:l.addEventListener("input",function(){h(this.value)},!1),dialog.onok=function(){var e,t;switch($G("preview").innerHTML="",v("tabHeads","tabSrc")){case"video":return m=$G("videoWidth"),e=$G("videoHeight"),a=$G("videoUrl").value,t=v("videoFloat","name"),!!a&&!!(e=>{for(var t,i=0;t=e[i++];){var a=t.value;if(!/(0|^[1-9]\d*$)/.test(a)&&a)return alert(lang.numError),t.value="",t.focus(),0}return 1})([m,e])&&void editor.execCommand("insertvideo",{url:g(a),width:m.value,height:e.value,align:t},w?"upload":null);case"videoSearch":for(var i,a="searchList",o=domUtils.getElementsByTagName($G(a),"img"),r=[],n=0;i=o[n++];)i.getAttribute("selected")&&r.push({url:i.getAttribute("ue_video_url"),width:420,height:280,align:"none"});return void editor.execCommand("insertvideo",r);case"upload":var s,l=[],d=editor.getOpt("videoUrlPrefix"),u=$G("upload_width").value||420,c=$G("upload_height").value||280,p=v("upload_alignment","name")||"none";for(s in S){var f=S[s];l.push({url:d+f.url,width:u,height:c,align:p})}var m=b.getQueueCount();return m?($(".info","#queueList").html('<span style="color:red;">'+"还有2个未上传文件".replace(/[\d]/,m)+"</span>"),!1):void editor.execCommand("insertvideo",l,"upload")}},dialog.oncancel=function(){$G("preview").innerHTML=""};var s,l=editor.selection.getRange().getClosedNode();if(l&&l.className){var d="edui-faked-video"==l.className,u=-1!=l.className.indexOf("edui-upload-video");if(d||u){$G("videoUrl").value=s=l.getAttribute("_url"),$G("videoWidth").value=l.width,$G("videoHeight").value=l.height;for(var c,d=domUtils.getComputedStyle(l,"float"),p="center"===domUtils.getComputedStyle(l.parentNode,"text-align")?"center":d,f=$G("videoFloat").children,m=0;c=f[m++];)c.getAttribute("name")==p?"focus"!=c.className&&(c.className="focus"):"focus"==c.className&&(c.className="")}u&&(w=!0)}h(s)}function v(e,t){for(var i,a,o=$G(e).children,r=0;a=o[r++];)if("focus"==a.className){i=a.getAttribute(t);break}return i}function g(e){return e?utils.trim(e).replace(/v\.youku\.com\/v_show\/id_([\w\-=]+)\.html/i,"player.youku.com/embed/$1").replace(/v\.qq\.com\/x\/cover\/[\w]+\/([\w]+)\.html/i,"v.qq.com/iframe/player.html?vid=$1&tiny=0&auto=0").replace(/v\.qq\.com\/x\/page\/([\w]+)\.html/i,"v.qq.com/iframe/player.html?vid=$1&tiny=0&auto=0").replace(/www\.bilibili\.com\/video\/([a-zA-Z0-9]+)\/?.*$/i,"player.bilibili.com/player.html?bvid=$1"):""}function h(e){e&&(e=g(e),e=utils.unhtml(e),$G("preview").innerHTML='<div class="previewMsg"><span>'+lang.urlError+'</span></div><iframe class="previewVideo"  src="'+e+'" width="420" height="280" frameborder=0 allowfullscreen></iframe>')}function i(e){this.$wrap=e.constructor==String?$("#"+e):$(e),this.init()}var b,S=[],w=!1,a={};window.onload=function(){a=editor.getOpt("videoConfig"),$focus($G("videoUrl"));for(var o=$G("tabHeads").children,e=0;e<o.length;e++)domUtils.on(o[e],"click",function(e){for(var t,i=e.target||e.srcElement,a=0;a<o.length;a++)t=o[a].getAttribute("data-content-id"),o[a]==i?(domUtils.addClass(o[a],"focus"),domUtils.addClass($G(t),"focus")):(domUtils.removeClasses(o[a],"focus"),domUtils.removeClasses($G(t),"focus"))});a.disableUpload||($G("tabHeads").querySelector('[data-content-id="upload"]').style.display="inline-block"),a.selectCallback&&($G("videoSelect").style.display="inline-block",domUtils.on($G("videoSelect"),"click",function(e){a.selectCallback(editor,function(e){e&&($G("videoUrl").value=e.path,h(e.path))})})),t(),b=new i("queueList")},i.prototype={init:function(){this.fileList=[],this.initContainer(),this.initUploader()},initContainer:function(){this.$queue=this.$wrap.find(".filelist")},initUploader:function(){function t(i){function a(e){switch(e){case"exceed_size":text=lang.errorExceedSize;break;case"interrupt":text=lang.errorInterrupt;break;case"http":text=lang.errorHttp;break;case"not_allow_type":text=lang.errorFileType;break;default:text=lang.errorUploadRetry}l.text(text).show()}var o=u('<li id="'+i.id+'"><p class="title">'+i.name+'</p><p class="imgWrap"></p><p class="progress"><span></span></p></li>'),r=u('<div class="file-panel"><span class="cancel">'+lang.uploadDelete+'</span><span class="rotateRight">'+lang.uploadTurnRight+'</span><span class="rotateLeft">'+lang.uploadTurnLeft+"</span></div>").appendTo(o),n=o.find("p.progress span"),s=o.find("p.imgWrap"),l=u('<p class="error"></p>').hide().appendTo(o);"invalid"===i.getStatus()?a(i.statusText):(s.text(lang.uploadPreview),-1=="|png|jpg|jpeg|bmp|gif|".indexOf("|"+i.ext.toLowerCase()+"|")?s.empty().addClass("notimage").append('<i class="file-preview file-type-'+i.ext.toLowerCase()+'"></i><span class="file-title">'+i.name+"</span>"):browser.ie&&browser.version<=7?s.text(lang.uploadNoPreview):d.makeThumb(i,function(e,t){e||!t||/^data:/.test(t)&&browser.ie&&browser.version<=7?s.text(lang.uploadNoPreview):(e=u('<img src="'+t+'">'),s.empty().append(e),e.on("error",function(){s.text(lang.uploadNoPreview)}))},h,b),y[i.id]=[i.size,0],i.rotation=0,i.ext&&-1!=k.indexOf(i.ext.toLowerCase())||(a("not_allow_type"),d.removeFile(i))),i.on("statuschange",function(e,t){"progress"===t?n.hide().width(0):"queued"===t&&(o.off("mouseenter mouseleave"),r.remove()),"error"===e||"invalid"===e?(a(i.statusText),y[i.id][1]=1):"interrupt"===e?a("interrupt"):"queued"===e?y[i.id][1]=0:"progress"===e&&(l.hide(),n.css("display","block")),o.removeClass("state-"+t).addClass("state-"+e)}),o.on("mouseenter",function(){r.stop().animate({height:30})}),o.on("mouseleave",function(){r.stop().animate({height:0})}),r.on("click","span",function(){var e;switch(u(this).index()){case 0:return void d.removeFile(i);case 1:i.rotation+=90;break;case 2:i.rotation-=90}C?(e="rotate("+i.rotation+"deg)",s.css({"-webkit-transform":e,"-mos-transform":e,"-o-transform":e,transform:e})):s.css("filter","progid:DXImageTransform.Microsoft.BasicImage(rotation="+~~(i.rotation/90%4+4)%4+")")}),o.insertBefore(p)}function i(){var e,i=0,a=0,t=m.children();u.each(y,function(e,t){a+=t[0],i+=t[0]*t[1]}),e=a?i/a:0,t.eq(0).text(Math.round(100*e)+"%"),t.eq(1).css("width",Math.round(100*e)+"%"),o()}function a(e){if(e!=w){var t=d.getStats();switch(c.removeClass("state-"+w),c.addClass("state-"+e),e){case"pedding":n.addClass("element-invisible"),s.addClass("element-invisible"),f.removeClass("element-invisible"),m.hide(),l.hide(),d.refresh();break;case"ready":f.addClass("element-invisible"),n.removeClass("element-invisible"),s.removeClass("element-invisible"),m.hide(),l.show(),c.text(lang.uploadStart),d.refresh();break;case"uploading":m.show(),l.hide(),c.text(lang.uploadPause);break;case"paused":m.show(),l.hide(),c.text(lang.uploadContinue);break;case"confirm":if(m.show(),l.hide(),c.text(lang.uploadStart),(t=d.getStats()).successNum&&!t.uploadFailNum)return void a("finish");break;case"finish":m.hide(),l.show(),t.uploadFailNum?c.text(lang.uploadRetry):c.text(lang.uploadStart)}w=e,o()}r.getQueueCount()?c.removeClass("disabled"):c.addClass("disabled")}function o(){var e,t="";"ready"===w?t=lang.updateStatusReady.replace("_",v).replace("_KB",WebUploader.formatSize(g)):"confirm"===w?(e=d.getStats()).uploadFailNum&&(t=lang.updateStatusConfirm.replace("_",e.successNum).replace("_",e.successNum)):(e=d.getStats(),t=lang.updateStatusFinish.replace("_",v).replace("_KB",WebUploader.formatSize(g)).replace("_",e.successNum),e.uploadFailNum&&(t+=lang.updateStatusError.replace("_",e.uploadFailNum))),l.html(t)}var d,r=this,u=jQuery,e=r.$wrap,n=e.find(".filelist"),s=e.find(".statusBar"),l=s.find(".info"),c=e.find(".uploadBtn"),p=(e.find(".filePickerBtn"),e.find(".filePickerBlock")),f=e.find(".placeholder"),m=s.find(".progress").hide(),v=0,g=0,e=window.devicePixelRatio||1,h=113*e,b=113*e,w="",y={},C=e="transition"in(e=document.createElement("p").style)||"WebkitTransition"in e||"MozTransition"in e||"msTransition"in e||"OTransition"in e,x=editor.getActionUrl(editor.getOpt("videoActionName")),e=editor.getOpt("videoMaxSize"),k=(editor.getOpt("videoAllowFiles")||[]).join("").replace(/\./g,",").replace(/^[,]/,"");WebUploader.Uploader.support()?editor.getOpt("videoActionName")?(e={pick:{id:"#filePickerReady",label:lang.uploadSelectFile},swf:"../../third-party/webuploader/Uploader.swf",server:x,fileVal:editor.getOpt("videoFieldName"),duplicate:!0,fileSingleSizeLimit:e,headers:editor.getOpt("serverHeaders")||{},compress:!1},editor.getOpt("uploadServiceEnable")&&(e.customUpload=function(t,i){editor.getOpt("uploadServiceUpload")("video",t,{success:function(e){i.onSuccess(t,{_raw:JSON.stringify(e)})},error:function(e){i.onError(t,e)},progress:function(e){i.onProgress(t,e)}},{from:"video"})}),(d=r.uploader=WebUploader.create(e)).addButton({id:"#filePickerBlock"}),d.addButton({id:"#filePickerBtn",label:lang.uploadAddFile}),a("pedding"),d.on("fileQueued",function(e){v++,g+=e.size,1===v&&(f.addClass("element-invisible"),s.show()),t(e)}),d.on("fileDequeued",function(e){var t;v--,g-=e.size,t=u("#"+(e=e).id),delete y[e.id],i(),t.off().find(".file-panel").off().end().remove(),i()}),d.on("filesQueued",function(e){d.isInProgress()||"pedding"!=w&&"finish"!=w&&"confirm"!=w&&"ready"!=w||a("ready"),i()}),d.on("all",function(e,t){switch(e){case"uploadFinished":a("confirm");break;case"startUpload":var i=utils.serializeParam(editor.queryCommandValue("serverparam"))||"",i=utils.formatUrl(x+(-1==x.indexOf("?")?"?":"&")+"encode=utf-8&"+i);d.option("server",i),a("uploading");break;case"stopUpload":a("paused")}}),d.on("uploadBeforeSend",function(e,t,i){-1!=x.toLowerCase().indexOf("jsp")&&(i.X_Requested_With="XMLHttpRequest")}),d.on("uploadProgress",function(e,t){u("#"+e.id).find(".progress span").css("width",100*t+"%"),y[e.id][1]=t,i()}),d.on("uploadSuccess",function(t,e){t=u("#"+t.id);try{var i=e._raw||e,a=utils.str2json(i);"SUCCESS"==(a=editor.getOpt("serverResponsePrepare")(a)).state?(S.push({url:a.url,type:a.type,original:a.original}),t.append('<span class="success"></span>'),editor.fireEvent("uploadsuccess",{res:a,type:"video"})):t.find(".error").text(a.state).show()}catch(e){t.find(".error").text(lang.errorServerUpload).show()}}),d.on("uploadError",function(e,t){}),d.on("error",function(e,t,i){"F_EXCEED_SIZE"===e?editor.getOpt("tipError")(lang.errorExceedSize+" "+(t/1024/1024).toFixed(1)+"MB"):console.log("error",e,t,i)}),d.on("uploadComplete",function(e,t){}),c.on("click",function(){return!u(this).hasClass("disabled")&&void("ready"===w||"paused"===w?d.upload():"uploading"===w&&d.stop())}),c.addClass("state-"+w),i()):u("#filePickerReady").after(u("<div>").html(lang.errorLoadConfig)).hide():u("#filePickerReady").after(u("<div>").html(lang.errorNotSupport)).hide()},getQueueCount:function(){for(var e,t=0,i=this.uploader.getFiles(),a=0;e=i[a++];)"queued"!=(e=e.getStatus())&&"uploading"!=e&&"progress"!=e||t++;return t},refresh:function(){this.uploader.refresh()}}})();