(()=>{let i=e=>{let t=e;return{get:()=>t,set:e=>{t=e}}};var P=tinymce.util.Tools.resolve("tinymce.PluginManager");let W=(e,t,n)=>!!n(e,t.prototype)||(null==(n=e.constructor)?void 0:n.name)===t.name;var e=n=>e=>{return t=typeof(e=e),(null===e?"null":"object"==t&&Array.isArray(e)?"array":"object"==t&&W(e,String,(e,t)=>t.isPrototypeOf(e))?"string":t)===n;var t},t=t=>e=>typeof e===t;let $=e("string"),V=e("array"),j=t("boolean"),H=t("number"),z=()=>{},o=(e=e=>()=>e)(!0);t=e("[~№|!-*+-\\/:;?@\\[-`{}¡«·»¿;·՚-՟։֊־׀׃׆׳״؉؊،؍؛؞؟٪-٭۔܀-܍߷-߹࠰-࠾࡞।॥॰෴๏๚๛༄-༒༺-༽྅࿐-࿔࿙࿚၊-၏჻፡-፨᐀᙭᙮᚛᚜᛫-᛭᜵᜶។-៖៘-៚᠀-᠊᥄᥅᨞᨟᪠-᪦᪨-᪭᭚-᭠᯼-᯿᰻-᰿᱾᱿᳓‐-‧‰-⁃⁅-⁑⁓-⁞⁽⁾₍₎〈〉❨-❵⟅⟆⟦-⟯⦃-⦘⧘-⧛⧼⧽⳹-⳼⳾⳿⵰⸀-⸮⸰⸱、-〃〈-】〔-〟〰〽゠・꓾꓿꘍-꘏꙳꙾꛲-꛷꡴-꡷꣎꣏꣸-꣺꤮꤯꥟꧁-꧍꧞꧟꩜-꩟꫞꫟꯫﴾﴿︐-︙︰-﹒﹔-﹡﹣﹨﹪﹫！-＃％-＊，-／：；？＠［-］＿｛｝｟-･]");class a{constructor(e,t){this.tag=e,this.value=t}static some(e){return new a(!0,e)}static none(){return a.singletonNone}fold(e,t){return this.tag?t(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?a.some(e(this.value)):a.none()}bind(e){return this.tag?e(this.value):a.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:a.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw new Error(null!=e?e:"Called getOrDie on None")}static from(e){return null==e?a.none():a.some(e)}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}a.singletonNone=new a(!1);let n=t;var r,g=tinymce.util.Tools.resolve("tinymce.Env"),f=tinymce.util.Tools.resolve("tinymce.util.Tools");let L=Array.prototype.slice,U=Array.prototype.push,l=(t,n)=>{var r=t.length,a=new Array(r);for(let e=0;e<r;e++){var o=t[e];a[e]=n(o,e)}return a},p=(n,r)=>{for(let e=0,t=n.length;e<t;e++)r(n[e],e)},s=(t,n)=>{for(let e=t.length-1;0<=e;e--)n(t[e],e)},_=(a,o)=>{if(0===a.length)return[];{let n=o(a[0]);var l=[];let r=[];for(let e=0,t=a.length;e<t;e++){var s=a[e],i=o(s);i!==n&&(l.push(r),r=[]),n=i,r.push(s)}return 0!==r.length&&l.push(r),l}},q=(e,n,r)=>(p(e,(e,t)=>{r=n(r,e,t)}),r),G=n=>{var r=[];for(let e=0,t=n.length;e<t;++e){if(!V(n[e]))throw new Error("Arr.flatten item "+e+" was not an array, input: "+n);U.apply(r,n[e])}return r},d=(e,t)=>G(l(e,t)),K=(e,t)=>{e=L.call(e,0);return e.sort(t),e},J=Object.hasOwnProperty,c=(e,t)=>J.call(e,t),Q=("undefined"!=typeof window||Function("return this;")(),9),X=11,Y=1,Z=(r=3,(e,t,n)=>{if(!($(n)||j(n)||H(n)))throw console.error("Invalid call to Attribute.set. Key ",t,":: Value ",n,":: Element ",e),new Error("Attribute value was not simple");e.setAttribute(t,n+"")}),ee=(e,t,n)=>{Z(e.dom,t,n)},m=e=>{if(null==e)throw new Error("Node cannot be null or undefined");return{dom:e}},u={fromHtml:(e,t)=>{var n,t=(t||document).createElement("div");if(t.innerHTML=e,!t.hasChildNodes()||1<t.childNodes.length)throw n="HTML does not have a single root node",console.error(n,e),new Error(n);return m(t.childNodes[0])},fromTag:(e,t)=>{t=(t||document).createElement(e);return m(t)},fromText:(e,t)=>{t=(t||document).createTextNode(e);return m(t)},fromDom:m,fromPoint:(e,t,n)=>a.from(e.dom.elementFromPoint(t,n)).map(m)},te=e=>e.nodeType!==Y&&e.nodeType!==Q&&e.nodeType!==X||0===e.childElementCount,ne=(e,t)=>{t=void 0===t?document:t.dom;return te(t)?[]:l(t.querySelectorAll(e),u.fromDom)},re=e=>a.from(e.dom.parentNode).map(u.fromDom),ae=e=>l(e.dom.childNodes,u.fromDom),h=(e,t)=>({element:e,offset:t}),oe=(e,t)=>{var n=ae(e);return 0<n.length&&t<n.length?h(n[t],0):h(e,t)},le=(t,n)=>{re(t).each(e=>{e.dom.insertBefore(n.dom,t.dom)})},se=(e,t)=>{e.dom.appendChild(t.dom)},v=(e,t)=>{le(e,t),se(t,e)},ie=((n,r)=>{let t=e=>n(e)?a.from(e.dom.nodeValue):a.none();return{get:e=>{if(n(e))return t(e).getOr("");throw new Error("Can only get "+r+" value of a "+r+" node")},getOption:t,set:(e,t)=>{if(!n(e))throw new Error("Can only set raw "+r+" value of a "+r+" node");e.dom.nodeValue=t}}})(e=>e.dom.nodeType===r,"text"),x=e=>ie.get(e),de=(e,t,n)=>0!=(e.compareDocumentPosition(t)&n),ce=(e,t)=>de(e,t,Node.DOCUMENT_POSITION_PRECEDING),me=(e,t)=>ne(t,e);var y=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker");let b=(e,t)=>e.isBlock(t)||c(e.schema.getVoidElements(),t.nodeName),w=(e,t)=>!e.isEditable(t),ue=(e,t)=>"true"===e.getContentEditable(t)&&t.parentNode&&!e.isEditable(t.parentNode),E=(e,t)=>!e.isBlock(t)&&c(e.schema.getWhitespaceElements(),t.nodeName),he=(e,t)=>b(e,t)||w(e,t)||E(e,t)||ue(e,t),ge=e=>3===e.nodeType,N=()=>({sOffset:0,fOffset:0,elements:[]}),C=(e,t)=>oe(u.fromDom(e),t),T=(e,t,n,r,a,o=!0)=>{let l=o?t(!1):n;for(;l;){var s=w(e,l);if(s||E(e,l)){if(s?r.cef(l):r.boundary(l))break;l=t(!0)}else{if(b(e,l)){if(r.boundary(l))break}else ge(l)&&r.text(l);if(l===a)break;l=t(!1)}}},O=(e,t,n,r,a)=>{he(e,n)||(r=null!=(r=e.getParent(r,e.isBlock))?r:e.getRoot(),r=new y(n,r),r=(a?r.next:r.prev).bind(r),T(e,r,n,{boundary:o,cef:o,text:e=>{a?t.fOffset+=e.length:t.sOffset+=e.length,t.elements.push(u.fromDom(e))}}))},k=(e,t,n,r,a,o=!0)=>{var l=new y(n,t);let s=[],i=N(),d=(O(e,i,n,t,!1),()=>(0<i.elements.length&&(s.push(i),i=N()),!1));return T(e,l.next.bind(l),n,{boundary:d,cef:e=>(d(),a&&s.push(...a.cef(e)),!1),text:e=>{i.elements.push(u.fromDom(e)),a&&a.text(e,i)}},r,o),r&&O(e,i,r,t,!0),d(),s},fe=(t,e)=>{let n=C(e.startContainer,e.startOffset),r=n.element.dom,a=C(e.endContainer,e.endOffset),o=a.element.dom;return k(t,e.commonAncestorContainer,r,o,{text:(e,t)=>{e===o?t.fOffset+=e.length-a.offset:e===r&&(t.sOffset+=n.offset)},cef:e=>{e=d(me(u.fromDom(e),"*[contenteditable=true]"),e=>{e=e.dom;return k(t,e,e)});return K(e,(e,t)=>ce(e.elements[0].dom,t.elements[0].dom)?1:-1)}},!1)},pe=(e,t)=>t.collapsed?[]:fe(e,t),ve=(e,t)=>{var n=e.createRng();return n.selectNode(t),pe(e,n)},xe=(t,e)=>d(e,e=>ve(t,e)),ye=(e,t,n=0,r=e.length)=>{for(var a=t.regex,o=(a.lastIndex=n,[]);s=a.exec(e);){var l=s[t.matchIndex],s=s.index+s[0].indexOf(l),l=s+l.length;if(r<l)break;o.push({start:s,finish:l}),a.lastIndex=l}return o},be=(e,o)=>{e=q(e,(e,n)=>{var t=x(n);let r=e.last,a=r+t.length;t=d(o,(e,t)=>e.start<a&&e.finish>r?[{element:n,start:Math.max(r,e.start)-r,finish:Math.min(a,e.finish)-r,matchId:t}]:[]);return{results:e.results.concat(t),last:a}},{results:[],last:0}).results;return _(e,e=>e.matchId)},we=(r,e)=>d(e,e=>{var t=e.elements,n=l(t,x).join(""),n=ye(n,r,e.sOffset,n.length-e.fOffset);return be(t,n)}),Ee=(e,a)=>{s(e,(e,r)=>{s(e,e=>{var t=u.fromDom(a.cloneNode(!1)),n=(ee(t,"data-mce-index",r),e.element.dom);n.length===e.finish&&0===e.start?v(e.element,t):(n.length!==e.finish&&n.splitText(e.finish),n=n.splitText(e.start),v(u.fromDom(n),t))})})},Ne=(e,t,n,r)=>{e=ve(e,n),n=we(t,e);return Ee(n,r),n.length},Ce=(e,t,n,r)=>{var a=n.getBookmark(),o=e.select("td[data-mce-selected],th[data-mce-selected]"),o=0<o.length?xe(e,o):pe(e,n.getRng()),e=we(t,o);return Ee(e,r),n.moveToBookmark(a),e.length},A=e=>e.getAttribute("data-mce-index"),Te=(e,t,n,r)=>{var a=e.dom.create("span",{"data-mce-bogus":1}),o=(a.className="mce-match-marker",e.getBody());return I(e,t,!1),r?Ce(e.dom,n,e.selection,a):Ne(e.dom,n,o,a)},Oe=e=>{var t=e.parentNode;e.firstChild&&t.insertBefore(e.firstChild,e),null!=(t=e.parentNode)&&t.removeChild(e)},D=(e,t)=>{var n=[],r=f.toArray(e.getBody().getElementsByTagName("span"));if(r.length)for(let e=0;e<r.length;e++){var a=A(r[e]);null!==a&&a.length&&a===t.toString()&&n.push(r[e])}return n},S=(e,t,n)=>{t=t.get();let r=t.index;var a=e.dom,n=(n?r+1===t.count?r=0:r++:r-1==-1?r=t.count-1:r--,a.removeClass(D(e,t.index),"mce-match-marker-selected"),D(e,r));return n.length?(a.addClass(D(e,r),"mce-match-marker-selected"),e.selection.scrollIntoView(n[0]),r):-1},ke=(e,t)=>{var n=t.parentNode;e.remove(t),n&&e.isEmpty(n)&&e.remove(n)},Ae=(e,t)=>{e="("+e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&").replace(/\s/g,"[^\\S\\r\\n\\uFEFF]")+")";return t?`(?:^|\\s|${n()})`+e+`(?=$|\\s|${n()})`:e},De=(e,t,n,r,a,o)=>{var l=e.selection,s=Ae(n,a),i=l.isForward(),s={regex:new RegExp(s,r?"g":"gi"),matchIndex:1},s=Te(e,t,s,o);return g.browser.isSafari()&&l.setRng(l.getRng(),i),s&&(l=S(e,t,!0),t.set({index:l,count:s,text:n,matchCase:r,wholeWord:a,inSelection:o})),s},F=(e,t)=>{e=S(e,t,!0);t.set({...t.get(),index:e})},M=(e,t)=>{e=S(e,t,!1);t.set({...t.get(),index:e})},Se=e=>{e=A(e);return null!==e&&0<e.length},B=(n,e,r,a,o)=>{var l=e.get(),s=l.index;let i,d=s;a=!1!==a;var t=n.getBody(),c=f.grep(f.toArray(t.getElementsByTagName("span")),Se);for(let t=0;t<c.length;t++){var m=A(c[t]);let e=i=parseInt(m,10);if(o||e===l.index){for(r.length?(c[t].innerText=r,Oe(c[t])):ke(n.dom,c[t]);c[++t];){if((e=parseInt(A(c[t]),10))!==i){t--;break}ke(n.dom,c[t])}a&&d--}else s<i&&c[t].setAttribute("data-mce-index",String(i-1))}return e.set({...l,count:o?0:l.count-1,index:d}),(a?F:M)(n,e),!o&&0<e.get().count},I=(e,t,n)=>{let r,a;var o=t.get(),l=f.toArray(e.getBody().getElementsByTagName("span"));for(let e=0;e<l.length;e++){var s=A(l[e]);null!==s&&s.length&&(s===o.index.toString()&&(r=r||l[e].firstChild,a=l[e].firstChild),Oe(l[e]))}if(t.set({...o,index:-1,count:0,text:""}),r&&a)return(t=e.dom.createRng()).setStart(r,0),t.setEnd(a,a.data.length),!1!==n&&e.selection.setRng(t),t},Fe=(e,t)=>1<t.get().count,Me=(e,t)=>1<t.get().count,Be=e=>{let t=i(a.none()),n=()=>t.get().each(e);return{clear:()=>{n(),t.set(a.none())},isSet:()=>t.get().isSome(),get:()=>t.get(),set:e=>{n(),t.set(a.some(e))}}},Ie=()=>{let t=Be(z);return{...t,on:e=>t.get().each(e)}},Re=(r,a)=>{var e=Ie(),t=(r.undoManager.add(),f.trim(r.selection.getContent({format:"text"})));let o=e=>{e.setEnabled("next",Fe(r,a)),e.setEnabled("prev",Me(r,a))},l=e=>{var e=e.getData(),t=a.get();a.set({...t,matchCase:e.matchcase,wholeWord:e.wholewords,inSelection:e.inselection})},s=(t,n)=>{p(["replace","replaceall","prev","next"],e=>t.setEnabled(e,!n))},i=(e,t)=>{t.redial(h(e,t.getData()))},d=(e,t)=>{g.browser.isSafari()&&g.deviceType.isTouch()&&("find"===t||"replace"===t||"replaceall"===t)&&e.focus(t)},c=e=>{I(r,a,!1),s(e,!0),o(e)},m=e=>{var t=e.getData(),n=a.get();(t.findtext.length?(n.text===t.findtext&&n.matchCase===t.matchcase&&n.wholeWord===t.wholewords?F(r,a):((n=De(r,a,t.findtext,t.matchcase,t.wholewords,t.inselection))<=0&&i(!0,e),s(e,0===n)),o):c)(e)};var n=a.get(),t={findtext:t,replacetext:"",wholewords:n.wholeWord,matchcase:n.matchCase,inselection:n.inSelection};let u=e=>{var t=[{type:"label",label:"Find",for:"findtext",items:[{type:"bar",items:[{type:"input",name:"findtext",maximized:!0,inputMode:"search"},{type:"button",name:"prev",text:"Previous",icon:"action-prev",enabled:!1,borderless:!0},{type:"button",name:"next",text:"Next",icon:"action-next",enabled:!1,borderless:!0}]}]},{type:"input",name:"replacetext",label:"Replace with",inputMode:"search"}];return e&&t.push({type:"alertbanner",level:"error",text:"Could not find the specified string.",icon:"warning"}),t},h=(n,e)=>({title:"Find and Replace",size:"normal",body:{type:"panel",items:u(n)},buttons:[{type:"menu",name:"options",icon:"preferences",tooltip:"Preferences",align:"start",items:[{type:"togglemenuitem",name:"matchcase",text:"Match case"},{type:"togglemenuitem",name:"wholewords",text:"Find whole words only"},{type:"togglemenuitem",name:"inselection",text:"Find in selection"}]},{type:"custom",name:"find",text:"Find",primary:!0},{type:"custom",name:"replace",text:"Replace",enabled:!1},{type:"custom",name:"replaceall",text:"Replace all",enabled:!1}],initialData:e,onChange:(e,t)=>{n&&i(!1,e),"findtext"===t.name&&0<a.get().count&&c(e)},onAction:(e,t)=>{var n=e.getData();switch(t.name){case"find":m(e);break;case"replace":(B(r,a,n.replacetext)?o:c)(e);break;case"replaceall":B(r,a,n.replacetext,!0,!0),c(e);break;case"prev":M(r,a),o(e);break;case"next":F(r,a),o(e);break;case"matchcase":case"wholewords":case"inselection":i(!1,e),l(e),c(e)}d(e,t.name)},onSubmit:e=>{m(e),d(e,"find")},onClose:()=>{r.focus(),I(r,a),r.undoManager.add()}});e.set(r.windowManager.open(h(!1,t),{inline:"toolbar"}))},R=(e,t)=>()=>{Re(e,t)};P.add("searchreplace",e=>{var t,n,r,a,o,l,s=i({index:-1,count:0,text:"",matchCase:!1,wholeWord:!1,inSelection:!1});return n=s,(t=e).addCommand("SearchReplace",()=>{Re(t,n)}),a=s,(r=e).ui.registry.addMenuItem("searchreplace",{text:"Find and replace...",shortcut:"Meta+F",onAction:R(r,a),icon:"search"}),r.ui.registry.addButton("searchreplace",{tooltip:"Find and replace",onAction:R(r,a),icon:"search",shortcut:"Meta+F"}),r.shortcuts.add("Meta+F","",R(r,a)),o=e,l=s,{done:e=>I(o,l,e),find:(e,t,n,r=!1)=>De(o,l,e,t,n,r),next:()=>F(o,l),prev:()=>M(o,l),replace:(e,t,n)=>B(o,l,e,t,n)}})})();