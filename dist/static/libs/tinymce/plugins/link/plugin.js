(()=>{var U=tinymce.util.Tools.resolve("tinymce.PluginManager");let B=(e,t,n)=>!!n(e,t.prototype)||(null==(n=e.constructor)?void 0:n.name)===t.name;var t,e=n=>e=>{return t=typeof(e=e),(null===e?"null":"object"==t&&Array.isArray(e)?"array":"object"==t&&B(e,String,(e,t)=>t.isPrototypeOf(e))?"string":t)===n;var t},n=t=>e=>typeof e===t;let o=e("string"),a=e("object"),l=e("array"),I=(t=null,e=>t===e),i=n("boolean"),K=e=>null==e,r=e=>!K(e),s=n("function"),u=(n,r)=>{if(l(n)){for(let e=0,t=n.length;e<t;++e)if(!r(n[e]))return!1;return!0}return!1},c=()=>{},j=e=>()=>e,z=(e,t)=>e===t;class g{constructor(e,t){this.tag=e,this.value=t}static some(e){return new g(!0,e)}static none(){return g.singletonNone}fold(e,t){return this.tag?t(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?g.some(e(this.value)):g.none()}bind(e){return this.tag?e(this.value):g.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:g.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw new Error(null!=e?e:"Called getOrDie on None")}static from(e){return r(e)?g.some(e):g.none()}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}g.singletonNone=new g(!1);let q=Array.prototype.indexOf,V=Array.prototype.push,F=(e,t)=>q.call(e,t),W=(t,n)=>{var r=t.length,l=new Array(r);for(let e=0;e<r;e++){var o=t[e];l[e]=n(o,e)}return l},$=(n,r)=>{for(let e=0,t=n.length;e<t;e++)r(n[e],e)},G=(e,n,r)=>($(e,(e,t)=>{r=n(r,e,t)}),r),h=n=>{var r=[];for(let e=0,t=n.length;e<t;++e){if(!l(n[e]))throw new Error("Arr.flatten item "+e+" was not an array, input: "+n);V.apply(r,n[e])}return r},d=(t,n)=>{for(let e=0;e<t.length;e++){var r=n(t[e],e);if(r.isSome())return r}return g.none()},m=(e,t,n=z)=>e.exists(e=>n(e,t)),H=t=>{let n=[];var r=e=>{n.push(e)};for(let e=0;e<t.length;e++)t[e].each(r);return n},p=(e,t)=>e?g.some(t):g.none(),v=(e=t=>e=>e.options.get(t))("link_assume_external_targets"),J=e("link_context_toolbar"),Q=e("link_list"),f=e("link_default_target"),X=e("link_default_protocol"),Y=e("link_target_list"),Z=e("link_rel_list"),ee=e("link_class_list"),te=e("link_title"),ne=e("allow_unsafe_link_target"),re=e("link_quicklink"),le=Object.keys,oe=Object.hasOwnProperty,ae=(n,r)=>{var l=le(n);for(let e=0,t=l.length;e<t;e++){var o=l[e];r(n[o],o)}},ie=n=>(e,t)=>{n[t]=e},se=(e,n,r,l)=>{ae(e,(e,t)=>{(n(e,t)?r:l)(e,t)})},ue=(e,t)=>{var n={};return se(e,t,ie(n),c),n},k=(e,t)=>oe.call(e,t),ce=(e,t)=>k(e,t)&&null!=e[t];var ge=tinymce.util.Tools.resolve("tinymce.util.URI"),he=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),b=tinymce.util.Tools.resolve("tinymce.util.Tools");let de=e=>r(e)&&"a"===e.nodeName.toLowerCase(),x=e=>de(e)&&!!y(e),me=(t,n)=>{if(t.collapsed)return[];{var t=t.cloneContents(),r=t.firstChild,l=new he(r,t),o=[];let e=r;for(;n(e)&&o.push(e),e=l.next(););return o}},pe=e=>/^\w+:/i.test(e),y=e=>{var t;return null!=(t=null!=(t=e.getAttribute("data-mce-href"))?t:e.getAttribute("href"))?t:""},ve=(e,t)=>{let n=["noopener"];e=e?e.split(/\s+/):[];let r=e=>e.filter(e=>-1===b.inArray(n,e));t=t?0<(t=r(t=e)).length?t.concat(n):n:r(e);return 0<t.length?b.trim(t.sort().join(" ")):""},fe=e=>e.replace(/\uFEFF/g,""),_=(e,t)=>(t=t||C(e.selection.getRng())[0]||e.selection.getNode(),S(t)?g.from(e.dom.select("a[href]",t)[0]):g.from(e.dom.getParent(t,"a[href]"))),w=(e,t)=>_(e,t).isSome(),ke=(e,t)=>{t=t.fold(()=>e.getContent({format:"text"}),e=>e.innerText||e.textContent||"");return fe(t)},C=e=>me(e,x),O=e=>b.grep(e,x),be=e=>0<O(e).length,xe=e=>0<C(e).length,ye=e=>{let t=e.schema.getTextInlineElements();return!(_(e).exists(e=>e.hasAttribute("data-mce-block"))||!(e=e.selection.getRng()).collapsed&&0!==me(e,e=>1===e.nodeType&&!de(e)&&!k(t,e.nodeName.toLowerCase())).length)},S=e=>r(e)&&"FIGURE"===e.nodeName&&/\bimage\b/i.test(e.className),_e=e=>G(["title","rel","class","target"],(t,n)=>(e[n].each(e=>{t[n]=0<e.length?e:null}),t),{href:e.href}),we=(e,t)=>"http"!==t&&"https"!==t||pe(e)?e:t+"://"+e,Ce=(e,t)=>{var n,t={...t};return 0!==Z(e).length||ne(e)||(n=ve(t.rel,"_blank"===t.target),t.rel=n||null),g.from(t.target).isNone()&&!1===Y(e)&&(t.target=f(e)),t.href=we(t.href,v(e)),t},Oe=(e,t,n,r)=>{n.each(e=>{k(t,"innerText")?t.innerText=e:t.textContent=e}),e.dom.setAttribs(t,r),e.selection.select(t)},Se=(t,e,n,r)=>{let l=t.dom;S(e)?Me(l,e,r):n.fold(()=>{t.execCommand("mceInsertLink",!1,r)},e=>{t.insertContent(l.createHTML("a",r,l.encode(e)))})},Ne=(t,e,n)=>{let r=t.selection.getNode(),l=_(t,r),o=Ce(t,_e(n));t.undoManager.transact(()=>{n.href===e.href&&e.attach(),l.fold(()=>{Se(t,r,n.text,o)},e=>{t.focus(),Oe(t,e,n.text,o)})})},Ae=e=>{var t=e.dom,n=e.selection,r=n.getBookmark(),l=n.getRng().cloneRange(),o=t.getParent(l.startContainer,"a[href]",e.getBody()),t=t.getParent(l.endContainer,"a[href]",e.getBody());o&&l.setStartBefore(o),t&&l.setEndAfter(t),n.setRng(l),e.execCommand("unlink"),n.moveToBookmark(r)},Te=t=>{t.undoManager.transact(()=>{var e=t.selection.getNode();S(e)?Pe(t,e):Ae(t),t.focus()})},Ee=e=>{var{class:e,href:t,rel:n,target:r,text:l,title:o}=e;return ue({class:e.getOrNull(),href:t,rel:n.getOrNull(),target:r.getOrNull(),text:l.getOrNull(),title:o.getOrNull()},(e,t)=>!1===I(e))},Le=(e,t)=>{var e=e.options.get,e={allow_html_data_urls:e("allow_html_data_urls"),allow_script_urls:e("allow_script_urls"),allow_svg_data_urls:e("allow_svg_data_urls")},n=t.href;return{...t,href:ge.isDomSafe(n,"a",e)?n:""}},Re=(e,t,n)=>{n=Le(e,n);e.hasPlugin("rtc",!0)?e.execCommand("createlink",!1,Ee(n)):Ne(e,t,n)},N=e=>{e.hasPlugin("rtc",!0)?e.execCommand("unlink"):Te(e)},Pe=(e,t)=>{var n,r=e.dom.select("img",t)[0];r&&(t=e.dom.getParents(r,"a[href]",t)[0])&&(null!=(n=t.parentNode)&&n.insertBefore(r,t),e.dom.remove(t))},Me=(e,t,n)=>{t=e.select("img",t)[0];t&&(e=e.create("a",n),null!=(n=t.parentNode)&&n.insertBefore(e,t),e.appendChild(t))},A=e=>o(e.value)?e.value:"",De=e=>o(e.text)?e.text:o(e.title)?e.title:"",Ue=(e,r)=>{let l=[];return b.each(e,e=>{var t,n=De(e);void 0!==e.menu?(t=Ue(e.menu,r),l.push({text:n,items:t})):(t=r(e),l.push({text:n,value:t}))}),l},Be=(t=A)=>e=>g.from(e).map(e=>Ue(e,t)),T={sanitize:e=>Be(A)(e),sanitizeWith:Be,createUi:(t,n)=>e=>({name:t,type:"listbox",label:n,items:e}),getValue:A},Ie=e=>ce(e,"items"),Ke=(t,e)=>d(e,e=>Ie(e)?Ke(t,e.items):p(e.value===t,e)),je=(t,e,n,r)=>{r=r[e];let l=0<t.length;return void 0!==r?Ke(r,n).map(e=>({url:{value:e.value,meta:{text:l?t:e.text,attach:c}},text:l?t:e.text})):g.none()},ze={init:(e,l)=>{let o={text:e.text,title:e.title},a=e=>p(o.title.length<=0,g.from(null==(e=e.meta)?void 0:e.title).getOr("")),i=e=>{var t;return p(o.text.length<=0,g.from(null==(t=e.meta)?void 0:t.text).getOr(e.value))},s=(e,t)=>{n=l;var n,r=("link"===(r=t)?n.link:"anchor"===r?n.anchor:g.none()).getOr([]);return je(o.text,t,r,e)};return{onChange:(e,t)=>{var n,r,t=t.name;return"url"===t?(n=e(),r=i(n.url),n=a(n.url),r.isSome()||n.isSome()?g.some({...r.map(e=>({text:e})).getOr({}),...n.map(e=>({title:e})).getOr({})}):g.none()):(r=["anchor","link"],n=t,-1<F(r,n)?s(e(),t):(("text"===t||"title"===t)&&(o[t]=e()[t]),g.none()))}}},getDelta:je};var qe=tinymce.util.Tools.resolve("tinymce.util.Delay");let Ve=e=>{let t=e.href;return 0<t.indexOf("@")&&-1===t.indexOf("/")&&-1===t.indexOf("mailto:")?g.some({message:"The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",preprocess:e=>({...e,href:"mailto:"+t})}):g.none()},Fe={preprocess:(e,r)=>{return d([Ve,(n=v(e),l=X(e),e=>{let t=e.href;return 1===n&&!pe(t)||0===n&&/^\s*www(\.|\d\.)/i.test(t)?g.some({message:`The URL you entered seems to be an external link. Do you want to add the required ${l}:// prefix?`,preprocess:e=>({...e,href:l+"://"+t})}):g.none()})],e=>e(r)).fold(()=>Promise.resolve(r),n=>new Promise(t=>{((t,e,n)=>{let r=t.selection.getRng();qe.setEditorTimeout(t,()=>{t.windowManager.confirm(e,e=>{t.selection.setRng(r),n(e)})})})(e,n.message,e=>{t(e?n.preprocess(r):r)})}));var n,l}},We={getAnchors:e=>{var t,e=e.dom.select("a:not([href])"),e=(e=e,t=e=>{e=e.name||e.id;return e?[{text:e,value:"#"+e}]:[]},h(W(e,t)));return 0<e.length?g.some([{text:"None",value:""}].concat(e)):g.none()}},$e={getClasses:e=>{e=ee(e);return 0<e.length?T.sanitize(e):g.none()}},Ge=e=>{try{return g.some(JSON.parse(e))}catch(e){return g.none()}},He={getLinks:t=>{let n=e=>t.convertURL(e.value||e.url||"","href"),e=Q(t);return new Promise(t=>{o(e)?fetch(e).then(e=>e.ok?e.text().then(Ge):Promise.reject()).then(t,()=>t(g.none())):s(e)?e(e=>t(g.some(e))):t(g.from(e))}).then(e=>e.bind(T.sanitizeWith(n)).map(e=>0<e.length?[{text:"None",value:""}].concat(e):e))}},Je={getRels:(e,n)=>{var r=Z(e);if(0<r.length){let t=m(n,"_blank");return(!1===ne(e)?T.sanitizeWith(e=>ve(T.getValue(e),t)):T.sanitize)(r)}return g.none()}},Qe=[{text:"Current window",value:""},{text:"New window",value:"_blank"}],Xe={getTargets:e=>{e=Y(e);return l(e)?T.sanitize(e).orThunk(()=>g.some(Qe)):!1===e?g.none():g.some(Qe)}},E=(e,t,n)=>{e=e.getAttrib(t,n);return null!==e&&0<e.length?g.some(e):g.none()},Ye={collect:(n,r)=>He.getLinks(n).then(e=>{var t=((e,t)=>{let n=e.dom;var e=ye(e)?g.some(ke(e.selection,t)):g.none(),r=t.bind(e=>g.from(n.getAttrib(e,"href"))),l=t.bind(e=>g.from(n.getAttrib(e,"target"))),o=t.bind(e=>E(n,e,"rel")),a=t.bind(e=>E(n,e,"class"));return{url:r,text:e,title:t.bind(e=>E(n,e,"title")),target:l,rel:o,linkClass:a}})(n,r);return{anchor:t,catalogs:{targets:Xe.getTargets(n),rels:Je.getRels(n,t.target),classes:$e.getClasses(n),anchor:We.getAnchors(n),link:e},optNode:r,flags:{titleEnabled:te(n)}}})},Ze=(l,o)=>e=>{let n=e.getData();if(n.url.value){var r=t=>g.from(n[t]).filter(e=>!m(o.anchor[t],e)),r={href:n.url.value,text:r("text"),target:r("target"),rel:r("rel"),class:r("linkClass"),title:r("title")};let t={href:n.url.value,attach:void 0!==n.url.meta&&n.url.meta.attach?n.url.meta.attach:c};Fe.preprocess(l,r).then(e=>{Re(l,t,e)})}else N(l);e.close()},et=e=>{var t=_(e);return Ye.collect(e,t)},tt=(e,t)=>{var e=e.anchor,n=e.url.getOr("");return{url:{value:n,meta:{original:{value:n}}},text:e.text.getOr(""),title:e.title.getOr(""),anchor:n,link:n,rel:e.rel.getOr(""),target:e.target.or(t).getOr(""),linkClass:e.linkClass.getOr("")}},nt=(e,t,n)=>{var r=e.anchor.text.map(()=>({name:"text",type:"input",label:"Text to display"})).toArray(),l=e.flags.titleEnabled?[{name:"title",type:"input",label:"Title"}]:[],n=g.from(f(n)),n=tt(e,n),e=e.catalogs;let o=ze.init(n,e);return{title:"Insert/Edit Link",size:"normal",body:{type:"panel",items:h([[{name:"url",type:"urlinput",filetype:"file",label:"URL",picker_text:"Browse links"}],r,l,H([e.anchor.map(T.createUi("anchor","Anchors")),e.rels.map(T.createUi("rel","Rel")),e.targets.map(T.createUi("target","Open link in...")),e.link.map(T.createUi("link","Link list")),e.classes.map(T.createUi("linkClass","Class"))])])},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:n,onChange:(t,{name:e})=>{o.onChange(t.getData,{name:e}).each(e=>{t.setData(e)})},onSubmit:t}},rt=n=>{et(n).then(e=>{var t=Ze(n,e);return nt(e,t,n)}).then(e=>{n.windowManager.open(e)})},lt=e=>{let t=e;return{get:()=>t,set:e=>{t=e}}},ot=e=>{let t=lt(g.none()),n=()=>t.get().each(e);return{clear:()=>{n(),t.set(g.none())},isSet:()=>t.get().isSome(),get:()=>t.get(),set:e=>{n(),t.set(g.some(e))}}},at=()=>{let t=ot(c);return{...t,on:e=>t.get().each(e)}},it=(e,t)=>e.substring(t),st=(e,t,n)=>""===t||e.length>=t.length&&e.substr(n,n+t.length)===t,ut=(e,t)=>ct(e,t)?it(e,t.length):e,ct=(e,t)=>st(e,t,0);var gt=tinymce.util.Tools.resolve("tinymce.util.VK");let ht=(e,t)=>{document.body.appendChild(e),e.dispatchEvent(t),document.body.removeChild(e)},dt=e=>{var t=document.createElement("a"),e=(t.target="_blank",t.href=e,t.rel="noreferrer noopener",new MouseEvent("click",{bubbles:!0,cancelable:!0,view:window}));document.dispatchEvent(e),ht(t,e)},mt=e=>!0===e.altKey&&!1===e.shiftKey&&!1===e.ctrlKey&&!1===e.metaKey,L=(e,t)=>{var n;t&&(n=y(t),/^#/.test(n)?(n=e.dom.select(`${n},[name="${ut(n,"#")}"]`)).length&&e.selection.scrollIntoView(n[0],!0):dt(t.href))},pt=e=>{var t=e.selection.getRng(),n=t.startContainer;return x(n)&&t.startContainer===t.endContainer&&1===e.dom.select("img",n).length},R=(e,t)=>{e=O(e.dom.getParents(t));return p(1===e.length,e[0])},vt=e=>{var t=C(e.selection.getRng());return p(0<t.length,t[0]).or(R(e,e.selection.getNode()))},ft=e=>e.selection.isCollapsed()||pt(e)?R(e,e.selection.getStart()):vt(e),kt=n=>{let r=at(),e=()=>r.get().or(ft(n));return n.on("contextmenu",e=>{R(n,e.target).each(r.set)}),n.on("SelectionChange",()=>{r.isSet()||ft(n).each(r.set)}),n.on("click",e=>{r.clear();var t=O(n.dom.getParents(e.target));1===t.length&&gt.metaKeyPressed(e)&&(e.preventDefault(),L(n,t[0]))}),n.on("keydown",t=>{r.clear(),!t.isDefaultPrevented()&&13===t.keyCode&&mt(t)&&e().each(e=>{t.preventDefault(),L(n,e)})}),{gotoSelectedLink:()=>e().each(e=>L(n,e))}},bt=e=>()=>{e.execCommand("mceLink",!1,{dialog:!0})},P=(e,t)=>(e.on("NodeChange",t),()=>e.off("NodeChange",t)),M=n=>e=>{var t=()=>{e.setActive(!n.mode.isReadOnly()&&w(n,n.selection.getNode())),e.setEnabled(n.selection.isEditable())};return t(),P(n,t)},xt=n=>e=>{var t=()=>{e.setEnabled(n.selection.isEditable())};return t(),P(n,t)},D=l=>t=>{let n=e=>be(e)||xe(l.selection.getRng());var e=l.dom.getParents(l.selection.getStart());let r=e=>{t.setEnabled(n(e)&&l.selection.isEditable())};return r(e),P(l,e=>r(e.parents))},yt=(e,t)=>{e.ui.registry.addToggleButton("link",{icon:"link",tooltip:"Insert/edit link",shortcut:"Meta+K",onAction:bt(e),onSetup:M(e)}),e.ui.registry.addButton("openlink",{icon:"new-tab",tooltip:"Open link",onAction:t.gotoSelectedLink,onSetup:D(e)}),e.ui.registry.addButton("unlink",{icon:"unlink",tooltip:"Remove link",onAction:()=>N(e),onSetup:D(e)})},_t=(e,t)=>{e.ui.registry.addMenuItem("openlink",{text:"Open link",icon:"new-tab",onAction:t.gotoSelectedLink,onSetup:D(e)}),e.ui.registry.addMenuItem("link",{icon:"link",text:"Link...",shortcut:"Meta+K",onAction:bt(e),onSetup:xt(e)}),e.ui.registry.addMenuItem("unlink",{icon:"unlink",text:"Remove link",onAction:()=>N(e),onSetup:D(e)})},wt=t=>{t.ui.registry.addContextMenu("link",{update:e=>t.dom.isEditable(e)?be(t.dom.getParents(e,"a"))?"link unlink openlink":"link":""})},Ct=(o,t)=>{var e=e=>{var t=o.selection.getNode();return e.setEnabled(w(o,t)&&o.selection.isEditable()),c};o.ui.registry.addContextForm("quicklink",{launch:{type:"contextformtogglebutton",icon:"link",tooltip:"Link",onSetup:M(o)},label:"Link",predicate:e=>J(o)&&w(o,e),initValue:()=>_(o).fold(j(""),y),commands:[{type:"contextformtogglebutton",icon:"link",tooltip:"Link",primary:!0,onSetup:e=>{var t=o.selection.getNode();return e.setActive(w(o,t)),M(o)(e)},onAction:e=>{var t,n=e.getValue(),r=(t=n,r=_(o),l=ye(o),r.isNone()&&l?(l=ke(o.selection,r),p(0===l.length,t)):g.none()),l={href:n,attach:c};Re(o,l,{href:n,text:r,title:g.none(),rel:g.none(),target:g.from(f(o)),class:g.none()}),o.selection.collapse(!1),e.hide()}},{type:"contextformbutton",icon:"unlink",tooltip:"Remove link",onSetup:e,onAction:e=>{N(o),e.hide()}},{type:"contextformbutton",icon:"new-tab",tooltip:"Open link",onSetup:e,onAction:e=>{t.gotoSelectedLink(),e.hide()}}]})};U.add("link",e=>{var n,t,r,l;(e=>{e=e.options.register;e("link_assume_external_targets",{processor:e=>{var t=o(e)||i(e);return t?!0===e?{value:1,valid:t}:"http"===e||"https"===e?{value:e,valid:t}:{value:0,valid:t}:{valid:!1,message:"Must be a string or a boolean."}},default:!1}),e("link_context_toolbar",{processor:"boolean",default:!1}),e("link_list",{processor:e=>o(e)||s(e)||u(e,a)}),e("link_default_target",{processor:"string"}),e("link_default_protocol",{processor:"string",default:"https"}),e("link_target_list",{processor:e=>i(e)||u(e,a),default:!0}),e("link_rel_list",{processor:"object[]",default:[]}),e("link_class_list",{processor:"object[]",default:[]}),e("link_title",{processor:"boolean",default:!0}),e("allow_unsafe_link_target",{processor:"boolean",default:!1}),e("link_quicklink",{processor:"boolean",default:!1})})(e),(n=e).addCommand("mceLink",(e,t)=>{!0!==(null==t?void 0:t.dialog)&&re(n)?n.dispatch("contexttoolbar-show",{toolbarKey:"quicklink"}):rt(n)}),t=e,r=kt(t),yt(t,r),_t(t,r),wt(t),Ct(t,r),(l=e).addShortcut("Meta+K","",()=>{l.execCommand("mceLink")})})})();