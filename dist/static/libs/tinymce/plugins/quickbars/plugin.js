(()=>{var e=tinymce.util.Tools.resolve("tinymce.PluginManager");let r=()=>window.crypto.getRandomValues(new Uint32Array(1))[0]/4294967295,o=0,i=e=>{var t=(new Date).getTime();return e+"_"+Math.floor(1e9*r())+ ++o+String(t)},s=(e,t,r)=>{e.execCommand("mceInsertTable",!1,{rows:r,columns:t})},l=(e,t,r)=>{var o=e.editorUpload.blobCache,r=o.create(i("mceu"),r,t);o.add(r),e.insertContent(e.dom.createHTML("img",{src:r.blobUri()}))},u=r=>new Promise(e=>{let t=new FileReader;t.onloadend=()=>{e(t.result.split(",")[1])},t.readAsDataURL(r)});var c=tinymce.util.Tools.resolve("tinymce.util.Delay");let d=s=>new Promise(r=>{let o=!1,i=document.createElement("input"),n=(i.type="file",i.accept="image/*",i.style.position="fixed",i.style.left="0",i.style.top="0",i.style.opacity="0.001",document.body.appendChild(i),e=>{var t;o||(null!=(t=i.parentNode)&&t.removeChild(i),o=!0,r(e))});var e=e=>{n(Array.prototype.slice.call(e.target.files))};i.addEventListener("input",e),i.addEventListener("change",e);let a=e=>{var t=()=>{n([])};o||("focusin"===e.type?c.setEditorTimeout(s,t,1e3):t()),s.off("focusin remove",a)};s.on("focusin remove",a),i.click()}),n=(e,t,r)=>!!r(e,t.prototype)||(null==(r=e.constructor)?void 0:r.name)===t.name;var a,t,m=t=>e=>typeof e===t;let g=e=>{return t=typeof(e=e),(null===e?"null":"object"==t&&Array.isArray(e)?"array":"object"==t&&n(e,String,(e,t)=>t.isPrototypeOf(e))?"string":t)===a;var t},h=m("boolean"),v=m("function"),b=(m=t=>e=>e.options.get(t))("quickbars_selection_toolbar"),f=m("quickbars_insert_toolbar"),p=m("quickbars_image_toolbar"),y=(t=!(a="string"),()=>t);class k{constructor(e,t){this.tag=e,this.value=t}static some(e){return new k(!0,e)}static none(){return k.singletonNone}fold(e,t){return this.tag?t(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?k.some(e(this.value)):k.none()}bind(e){return this.tag?e(this.value):k.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:k.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw new Error(null!=e?e:"Called getOrDie on None")}static from(e){return null==e?k.none():k.some(e)}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}k.singletonNone=new k(!1),"undefined"==typeof window&&Function("return this;")();let w=1,T=e=>e.dom.nodeName.toLowerCase(),N=(e,t)=>{e=e.dom;return!(!e||!e.hasAttribute)&&e.hasAttribute(t)};var q=(e,t,r,o,i)=>e(r,o)?k.some(r):v(i)&&i(r)?k.none():t(r,o,i);let C=e=>{if(null==e)throw new Error("Node cannot be null or undefined");return{dom:e}},E={fromHtml:(e,t)=>{var r,t=(t||document).createElement("div");if(t.innerHTML=e,!t.hasChildNodes()||1<t.childNodes.length)throw r="HTML does not have a single root node",console.error(r,e),new Error(r);return C(t.childNodes[0])},fromTag:(e,t)=>{t=(t||document).createElement(e);return C(t)},fromText:(e,t)=>{t=(t||document).createTextNode(e);return C(t)},fromDom:C,fromPoint:(e,t,r)=>k.from(e.dom.elementFromPoint(t,r)).map(C)},M=(e,t)=>{e=e.dom;if(e.nodeType!==w)return!1;if(void 0!==e.matches)return e.matches(t);if(void 0!==e.msMatchesSelector)return e.msMatchesSelector(t);if(void 0!==e.webkitMatchesSelector)return e.webkitMatchesSelector(t);if(void 0!==e.mozMatchesSelector)return e.mozMatchesSelector(t);throw new Error("Browser lacks native selectors")},_=(e,t,r)=>{let o=e.dom;for(var i=v(r)?r:y;o.parentNode;){o=o.parentNode;var n=E.fromDom(o);if(t(n))return k.some(n);if(i(n))break}return k.none()},I=(e,t,r)=>q((e,t)=>t(e),_,e,t,r),S=(e,t,r)=>I(e,t,r).isSome(),x=(e,t,r)=>_(e,e=>M(e,t),r),A=(e,t,r)=>q((e,t)=>M(e,t),x,e,t,r),D=e=>void 0!==e.dom.classList,L=(e,t)=>D(e)&&e.dom.classList.contains(t),O=t=>{let o=e=>t.dom.isEditable(e),r=e=>{var t="FIGURE"===e.nodeName&&/image/i.test(e.className),t="IMG"===e.nodeName||t,r=L(E.fromDom(e),"mce-pagebreak");return t&&(t=e,o(t.parentElement))&&!r};var e=p(t),e=(0<e.length&&t.ui.registry.addContextToolbar("imageselection",{predicate:r,items:e,position:"node"}),b(t));0<e.length&&t.ui.registry.addContextToolbar("textselection",{predicate:e=>!r(e)&&!t.selection.isCollapsed()&&o(e),items:e,position:"selection",scope:"editor"})};e.add("quickbars",e=>{var t,r,o,i,n,a;(a=(a=e).options.register)("quickbars_selection_toolbar",{processor:(t=r=>e=>{var t=h(e)||g(e);return t?h(e)?{value:e?r:"",valid:t}:{value:e.trim(),valid:t}:{valid:!1,message:"Must be a boolean or string."}})(r="bold italic | quicklink h2 h3 blockquote"),default:r}),a("quickbars_insert_toolbar",{processor:t(r="quickimage quicktable"),default:r}),a("quickbars_image_toolbar",{processor:t(r="alignleft aligncenter alignright"),default:r}),(o=e).on("PreInit",()=>{o.queryCommandSupported("QuickbarInsertImage")||o.addCommand("QuickbarInsertImage",()=>{d(o).then(e=>{if(0<e.length){let t=e[0];u(t).then(e=>{l(o,e,t)})}})})}),(i=e).ui.registry.addButton("quickimage",{icon:"image",tooltip:"Insert image",onAction:()=>i.execCommand("QuickbarInsertImage")}),i.ui.registry.addButton("quicktable",{icon:"table",tooltip:"Insert table",onAction:()=>{s(i,2,2)}}),n=e,0<(a=f(n)).length&&n.ui.registry.addContextToolbar("quickblock",{predicate:e=>{let t=E.fromDom(e),r=n.schema.getTextBlockElements(),o=e=>e.dom===n.getBody();return!N(t,"data-mce-bogus")&&A(t,'table,[data-mce-bogus="all"]',o).fold(()=>S(t,e=>T(e)in r&&n.dom.isEmpty(e.dom),o),y)},items:a,position:"line",scope:"editor"}),O(e)})})();