(()=>{var M=tinymce.util.Tools.resolve("tinymce.PluginManager");let j=Object.getPrototypeOf,r=(e,t,a)=>!!a(e,t.prototype)||(null==(a=e.constructor)?void 0:a.name)===t.name;var t,e=a=>e=>{return t=typeof(e=e),(null===e?"null":"object"==t&&Array.isArray(e)?"array":"object"==t&&r(e,String,(e,t)=>t.isPrototypeOf(e))?"string":t)===a;var t},a=t=>e=>typeof e===t;let P=(e,t)=>i(e)&&r(e,t,(e,t)=>j(e)===t),b=e("string"),i=e("object"),o=e=>P(e,Object),l=e("array"),R=(t=null,e=>t===e),n=a("boolean"),B=e=>null==e,s=e=>!B(e),m=a("function"),H=a("number"),F=(a,r)=>{if(l(a)){for(let e=0,t=a.length;e<t;++e)if(!r(a[e]))return!1;return!0}return!1},G=()=>{};class v{constructor(e,t){this.tag=e,this.value=t}static some(e){return new v(!0,e)}static none(){return v.singletonNone}fold(e,t){return this.tag?t(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?v.some(e(this.value)):v.none()}bind(e){return this.tag?e(this.value):v.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:v.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw new Error(null!=e?e:"Called getOrDie on None")}static from(e){return s(e)?v.some(e):v.none()}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}v.singletonNone=new v(!1);let W=Object.keys,$=Object.hasOwnProperty,V=(a,r)=>{var i=W(a);for(let e=0,t=i.length;e<t;e++){var o=i[e];r(a[o],o)}},K=a=>(e,t)=>{a[t]=e},Z=(e,a,r,i)=>{V(e,(e,t)=>{(a(e,t)?r:i)(e,t)})},q=(e,t)=>{var a={};return Z(e,t,K(a),G),a},d=(e,t)=>$.call(e,t),J=(e,t)=>d(e,t)&&null!=e[t],Q=Array.prototype.push,y=a=>{var r=[];for(let e=0,t=a.length;e<t;++e){if(!l(a[e]))throw new Error("Arr.flatten item "+e+" was not an array, input: "+a);Q.apply(r,a[e])}return r},X=(e,t)=>0<=t&&t<e.length?v.some(e[t]):v.none(),Y=e=>X(e,0),ee=(t,a)=>{for(let e=0;e<t.length;e++){var r=a(t[e],e);if(r.isSome())return r}return v.none()},te=("undefined"!=typeof window||Function("return this;")(),(e,t,a)=>{if(!(b(a)||n(a)||H(a)))throw console.error("Invalid call to Attribute.set. Key ",t,":: Value ",a,":: Element ",e),new Error("Attribute value was not simple");e.setAttribute(t,a+"")}),c=(e,t,a)=>{te(e.dom,t,a)},ae=(e,t)=>{e.dom.removeAttribute(t)},g=e=>{if(null==e)throw new Error("Node cannot be null or undefined");return{dom:e}},u={fromHtml:(e,t)=>{var a,t=(t||document).createElement("div");if(t.innerHTML=e,!t.hasChildNodes()||1<t.childNodes.length)throw a="HTML does not have a single root node",console.error(a,e),new Error(a);return g(t.childNodes[0])},fromTag:(e,t)=>{t=(t||document).createElement(e);return g(t)},fromText:(e,t)=>{t=(t||document).createTextNode(e);return g(t)},fromDom:g,fromPoint:(e,t,a)=>v.from(e.dom.elementFromPoint(t,a)).map(g)},re=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils");var p,ie=tinymce.util.Tools.resolve("tinymce.util.URI");let h=e=>0<e.length,f=(e=t=>e=>e.options.get(t))("image_dimensions"),oe=e("image_advtab"),le=e("image_uploadtab"),ne=e("image_prepend_url"),se=e("image_class_list"),me=e("image_description"),de=e("image_title"),ce=e("image_caption"),ge=e("image_list"),ue=e("a11y_advanced_options"),pe=e("automatic_uploads"),he=e=>h(e.options.get("images_upload_url")),be=e=>s(e.options.get("images_upload_handler")),w=(e,t)=>Math.max(parseInt(e,10),parseInt(t,10)),ve=i=>new Promise(t=>{let a=document.createElement("img"),r=e=>{a.onload=a.onerror=null,a.parentNode&&a.parentNode.removeChild(a),t(e)};a.onload=()=>{var e={width:w(a.width,a.clientWidth),height:w(a.height,a.clientHeight)};r(Promise.resolve(e))},a.onerror=()=>{r(Promise.reject("Failed to get image dimensions for: "+i))};var e=a.style;e.visibility="hidden",e.position="fixed",e.bottom=e.left="0px",e.width=e.height="auto",document.body.appendChild(a),a.src=i}),A=e=>e=e&&e.replace(/px$/,""),D=e=>(0<e.length&&/^[0-9]+$/.test(e)&&(e+="px"),e),ye=e=>{if(e.margin){var t=String(e.margin).split(" ");switch(t.length){case 1:e["margin-top"]=e["margin-top"]||t[0],e["margin-right"]=e["margin-right"]||t[0],e["margin-bottom"]=e["margin-bottom"]||t[0],e["margin-left"]=e["margin-left"]||t[0];break;case 2:e["margin-top"]=e["margin-top"]||t[0],e["margin-right"]=e["margin-right"]||t[1],e["margin-bottom"]=e["margin-bottom"]||t[0],e["margin-left"]=e["margin-left"]||t[1];break;case 3:e["margin-top"]=e["margin-top"]||t[0],e["margin-right"]=e["margin-right"]||t[1],e["margin-bottom"]=e["margin-bottom"]||t[2],e["margin-left"]=e["margin-left"]||t[1];break;case 4:e["margin-top"]=e["margin-top"]||t[0],e["margin-right"]=e["margin-right"]||t[1],e["margin-bottom"]=e["margin-bottom"]||t[2],e["margin-left"]=e["margin-left"]||t[3]}delete e.margin}return e},fe=(e,t)=>{e=ge(e);b(e)?fetch(e).then(e=>{e.ok&&e.json().then(t)}):m(e)?e(t):t(e)},we=(e,t,a)=>{let r=()=>{a.onload=a.onerror=null,e.selection&&(e.selection.select(a),e.nodeChanged())};a.onload=()=>{t.width||t.height||!f(e)||e.dom.setAttribs(a,{width:String(a.clientWidth),height:String(a.clientHeight)}),r()},a.onerror=r},Ae=r=>new Promise((e,t)=>{let a=new FileReader;a.onload=()=>{e(a.result)},a.onerror=()=>{var e;t(null==(e=a.error)?void 0:e.message)},a.readAsDataURL(r)}),De=e=>"IMG"===e.nodeName&&(e.hasAttribute("data-mce-object")||e.hasAttribute("data-mce-placeholder")),_e=(e,t)=>{e=e.options.get;return ie.isDomSafe(t,"img",{allow_html_data_urls:e("allow_html_data_urls"),allow_script_urls:e("allow_script_urls"),allow_svg_data_urls:e("allow_svg_data_urls")})},_=re.DOM,Ce=e=>e.style.marginLeft&&e.style.marginRight&&e.style.marginLeft===e.style.marginRight?A(e.style.marginLeft):"",Ie=e=>e.style.marginTop&&e.style.marginBottom&&e.style.marginTop===e.style.marginBottom?A(e.style.marginTop):"",xe=e=>e.style.borderWidth?A(e.style.borderWidth):"",C=(e,t)=>e.hasAttribute(t)&&null!=(e=e.getAttribute(t))?e:"",Te=e=>null!==e.parentNode&&"FIGURE"===e.parentNode.nodeName,I=(e,t,a)=>{""===a||null===a?e.removeAttribute(t):e.setAttribute(t,a)},Ue=e=>{var t=_.create("figure",{class:"image"});_.insertAfter(t,e),t.appendChild(e),t.appendChild(_.create("figcaption",{contentEditable:"true"},"Caption")),t.contentEditable="false"},Se=e=>{var t=e.parentNode;s(t)&&(_.insertAfter(e,t),_.remove(t))},Ne=e=>{(Te(e)?Se:Ue)(e)},Ee=(e,t)=>{var a=e.getAttribute("style"),t=t(null!==a?a:"");0<t.length?(e.setAttribute("style",t),e.setAttribute("data-mce-style",t)):e.removeAttribute("style")},Le=(e,i)=>(e,t,a)=>{var r=e.style;r[t]?(r[t]=D(a),Ee(e,i)):I(e,t,a)},Oe=(e,t)=>e.style[t]?A(e.style[t]):C(e,t),ke=(e,t)=>{t=D(t);e.style.marginLeft=t,e.style.marginRight=t},ze=(e,t)=>{t=D(t);e.style.marginTop=t,e.style.marginBottom=t},Me=(e,t)=>{t=D(t);e.style.borderWidth=t},je=(e,t)=>{e.style.borderStyle=t},Pe=e=>null!=(e=e.style.borderStyle)?e:"",x=e=>s(e)&&"FIGURE"===e.nodeName,Re=e=>"IMG"===e.nodeName,Be=e=>0===_.getAttrib(e,"alt").length&&"presentation"===_.getAttrib(e,"role"),He=e=>Be(e)?"":C(e,"alt"),Fe=()=>({src:"",alt:"",title:"",width:"",height:"",class:"",style:"",caption:!1,hspace:"",vspace:"",border:"",borderStyle:"",isDecorative:!1}),Ge=(e,t)=>{var a=document.createElement("img");return I(a,"style",t.style),!Ce(a)&&""===t.hspace||ke(a,t.hspace),!Ie(a)&&""===t.vspace||ze(a,t.vspace),!xe(a)&&""===t.border||Me(a,t.border),!Pe(a)&&""===t.borderStyle||je(a,t.borderStyle),e(null!=(t=a.getAttribute("style"))?t:"")},We=(e,t)=>{var a=document.createElement("img");return Ke(e,{...t,caption:!1},a),$e(a,t.alt,t.isDecorative),t.caption?((e=_.create("figure",{class:"image"})).appendChild(a),e.appendChild(_.create("figcaption",{contentEditable:"true"},"Caption")),e.contentEditable="false",e):a},T=(e,t)=>({src:C(t,"src"),alt:He(t),title:C(t,"title"),width:Oe(t,"width"),height:Oe(t,"height"),class:C(t,"class"),style:e(C(t,"style")),caption:Te(t),hspace:Ce(t),vspace:Ie(t),border:xe(t),borderStyle:Pe(t),isDecorative:Be(t)}),U=(e,t,a,r,i)=>{a[r]!==t[r]&&i(e,r,String(a[r]))},$e=(e,t,a)=>{a?(_.setAttrib(e,"role","presentation"),a=u.fromDom(e),c(a,"alt","")):(R(t)?(a=u.fromDom(e),ae(a,"alt")):(a=u.fromDom(e),c(a,"alt",t)),"presentation"===_.getAttrib(e,"role")&&_.setAttrib(e,"role",""))},Ve=(e,t,a)=>{a.alt===t.alt&&a.isDecorative===t.isDecorative||$e(e,a.alt,a.isDecorative)},S=(r,i)=>(e,t,a)=>{r(e,a),Ee(e,i)},Ke=(e,t,a)=>{var r=T(e,a);U(a,r,t,"caption",(e,t,a)=>Ne(e)),U(a,r,t,"src",I),U(a,r,t,"title",I),U(a,r,t,"width",Le("width",e)),U(a,r,t,"height",Le("height",e)),U(a,r,t,"class",I),U(a,r,t,"style",S((e,t)=>I(e,"style",t),e)),U(a,r,t,"hspace",S(ke,e)),U(a,r,t,"vspace",S(ze,e)),U(a,r,t,"border",S(Me,e)),U(a,r,t,"borderStyle",S(je,e)),Ve(a,r,t)},N=(e,t)=>{t=e.dom.styles.parse(t),t=ye(t),t=e.dom.styles.parse(e.dom.styles.serialize(t));return e.dom.styles.serialize(t)},E=e=>{var t=e.selection.getNode(),a=e.dom.getParent(t,"figure.image");return a?e.dom.select("img",a)[0]:t&&("IMG"!==t.nodeName||De(t))?null:t},Ze=(a,e)=>{var t=a.dom;let r=q(a.schema.getTextBlockElements(),(e,t)=>!a.schema.isValidChild(t,"figure"));var i=t.getParent(e.parentNode,e=>J(r,e.nodeName),a.getBody());return i&&null!=(t=t.split(i,e))?t:e},qe=t=>{var e=E(t);return e?T(e=>N(t,e),e):Fe()},Je=(t,e)=>{var a,e=We(e=>N(t,e),e),e=(t.dom.setAttrib(e,"data-mce-id","__mcenew"),t.focus(),t.selection.setContent(e.outerHTML),t.dom.select('*[data-mce-id="__mcenew"]')[0]);t.dom.setAttrib(e,"data-mce-id",null),x(e)?(a=Ze(t,e),t.selection.select(a)):t.selection.select(e)},Qe=(e,t)=>{e.dom.setAttrib(t,"src",t.getAttribute("src"))},Xe=(e,t)=>{t&&(t=e.dom.is(t.parentNode,"figure.image")?t.parentNode:t,e.dom.remove(t),e.focus(),e.nodeChanged(),e.dom.isEmpty(e.getBody()))&&(e.setContent(""),e.selection.setCursorLocation())},Ye=(t,e)=>{var a,r=E(t);r&&(Ke(e=>N(t,e),e,r),Qe(t,r),x(r.parentNode)?(a=r.parentNode,Ze(t,a),t.selection.select(r.parentNode)):(t.selection.select(r),we(t,e,r)))},et=(e,t)=>{var a=t.src;return{...t,src:_e(e,a)?a:""}},tt=(t,e)=>{var a,r,i=E(t);i?(a={...T(e=>N(t,e),i),...e},r=et(t,a),a.src?Ye(t,r):Xe(t,i)):e.src&&Je(t,{...Fe(),...e})},L=(p=(e,t)=>o(e)&&o(t)?L(e,t):t,(...t)=>{if(0===t.length)throw new Error("Can't merge zero objects");var a={};for(let e=0;e<t.length;e++){var r,i=t[e];for(r in i)d(i,r)&&(a[r]=p(a[r],i[r]))}return a});var at=tinymce.util.Tools.resolve("tinymce.util.ImageUploader"),rt=tinymce.util.Tools.resolve("tinymce.util.Tools");let it=e=>b(e.value)?e.value:"",ot=e=>b(e.text)?e.text:b(e.title)?e.title:"",lt=(e,r)=>{let i=[];return rt.each(e,e=>{var t,a=ot(e);void 0!==e.menu?(t=lt(e.menu,r),i.push({text:a,items:t})):(t=r(e),i.push({text:a,value:t}))}),i},nt=(t=it)=>e=>e?v.from(e).map(e=>lt(e,t)):v.none(),st=e=>d(e,"items"),mt=(e,t)=>ee(e,e=>st(e)?mt(e.items,t):e.value===t?v.some(e):v.none()),O={sanitizer:nt,sanitize:e=>nt(it)(e),findEntry:(e,t)=>e.bind(e=>mt(e,t))},dt={makeTab:e=>({title:"Advanced",name:"advanced",items:[{type:"grid",columns:2,items:[{type:"input",label:"Vertical space",name:"vspace",inputMode:"numeric"},{type:"input",label:"Horizontal space",name:"hspace",inputMode:"numeric"},{type:"input",label:"Border width",name:"border",inputMode:"numeric"},{type:"listbox",name:"borderstyle",label:"Border style",items:[{text:"Select...",value:""},{text:"Solid",value:"solid"},{text:"Dotted",value:"dotted"},{text:"Dashed",value:"dashed"},{text:"Double",value:"double"},{text:"Groove",value:"groove"},{text:"Ridge",value:"ridge"},{text:"Inset",value:"inset"},{text:"Outset",value:"outset"},{text:"None",value:"none"},{text:"Hidden",value:"hidden"}]}]}]})},ct=a=>{let r=O.sanitizer(e=>a.convertURL(e.value||e.url||"","src"));var e=new Promise(t=>{fe(a,e=>{t(r(e).map(e=>y([[{text:"None",value:""}],e])))})});let t=O.sanitize(se(a)),i=oe(a),o=le(a),l=he(a),n=be(a),s=qe(a),m=me(a),d=de(a),c=f(a),g=ce(a),u=ue(a),p=pe(a),h=v.some(ne(a)).filter(e=>b(e)&&0<e.length);return e.then(e=>({image:s,imageList:e,classList:t,hasAdvTab:i,hasUploadTab:o,hasUploadUrl:l,hasUploadHandler:n,hasDescription:m,hasImageTitle:d,hasDimensions:c,hasImageCaption:g,prependURL:h,hasAccessibilityOptions:u,automaticUploads:p}))},gt=e=>{var t=e.imageList.map(e=>({name:"images",type:"listbox",label:"Image list",items:e})),a={name:"alt",type:"input",label:"Alternative description",enabled:!(e.hasAccessibilityOptions&&e.image.isDecorative)},r=e.classList.map(e=>({name:"classes",type:"listbox",label:"Class",items:e}));return y([[{name:"src",type:"urlinput",filetype:"image",label:"Source",picker_text:"Browse files"}],t.toArray(),e.hasAccessibilityOptions&&e.hasDescription?[{type:"label",label:"Accessibility",items:[{name:"isDecorative",type:"checkbox",label:"Image is decorative"}]}]:[],e.hasDescription?[a]:[],e.hasImageTitle?[{name:"title",type:"input",label:"Image title"}]:[],e.hasDimensions?[{name:"dimensions",type:"sizeinput"}]:[],[{...(t=e.classList.isSome()&&e.hasImageCaption,t?{type:"grid",columns:2}:{type:"panel"}),items:y([r.toArray(),e.hasImageCaption?[{type:"label",label:"Caption",items:[{type:"checkbox",name:"caption",label:"Show caption"}]}]:[]])}]])},ut={makeTab:e=>({title:"General",name:"general",items:gt(e)}),makeItems:gt},pt={makeTab:e=>({title:"Upload",name:"upload",items:[{type:"dropzone",name:"fileinput"}]})},ht=e=>({prevImage:O.findEntry(e.imageList,e.image.src),prevAlt:e.image.alt,open:!0}),bt=e=>({src:{value:e.src,meta:{}},images:e.src,alt:e.alt,title:e.title,dimensions:{width:e.width,height:e.height},classes:e.class,caption:e.caption,style:e.style,vspace:e.vspace,border:e.border,hspace:e.hspace,borderstyle:e.borderStyle,fileinput:[],isDecorative:e.isDecorative}),vt=(e,t)=>({src:e.src.value,alt:null!==e.alt&&0!==e.alt.length||!t?e.alt:null,title:e.title,width:e.dimensions.width,height:e.dimensions.height,class:e.classes,style:e.style,caption:e.caption,hspace:e.hspace,vspace:e.vspace,border:e.border,borderStyle:e.borderstyle,isDecorative:e.isDecorative}),yt=(e,t)=>/^(?:[a-zA-Z]+:)?\/\//.test(t)?v.none():e.prependURL.bind(e=>t.substring(0,e.length)!==e?v.some(e+t):v.none()),ft=(e,t)=>{let a=t.getData();yt(e,a.src.value).each(e=>{t.setData({src:{value:e,meta:a.src.meta}})})},wt=(e,t,a)=>{e.hasDescription&&b(a.alt)&&(t.alt=a.alt),e.hasAccessibilityOptions&&(t.isDecorative=a.isDecorative||t.isDecorative||!1),e.hasImageTitle&&b(a.title)&&(t.title=a.title),e.hasDimensions&&(b(a.width)&&(t.dimensions.width=a.width),b(a.height))&&(t.dimensions.height=a.height),b(a.class)&&O.findEntry(e.classList,a.class).each(e=>{t.classes=e.value}),e.hasImageCaption&&n(a.caption)&&(t.caption=a.caption),e.hasAdvTab&&(b(a.style)&&(t.style=a.style),b(a.vspace)&&(t.vspace=a.vspace),b(a.border)&&(t.border=a.border),b(a.hspace)&&(t.hspace=a.hspace),b(a.borderstyle))&&(t.borderstyle=a.borderstyle)},At=(e,t)=>{var a=t.getData(),r=a.src.meta;void 0!==r&&(a=L({},a),wt(e,a,r),t.setData(a))},Dt=(e,t,a,r)=>{var i=r.getData(),o=i.src.value,i=i.src.meta||{};i.width||i.height||!t.hasDimensions||(h(o)?e.imageSize(o).then(e=>{a.open&&r.setData({dimensions:e})}).catch(e=>console.error(e)):r.setData({dimensions:{width:"",height:""}}))},_t=(e,t,a)=>{var r=a.getData(),e=O.findEntry(e.imageList,r.src.value);t.prevImage=e,a.setData({images:e.map(e=>e.value).getOr("")})},k=(e,t,a,r)=>{ft(t,r),At(t,r),Dt(e,t,a,r),_t(t,a,r)},Ct=(e,t,a,r)=>{let i=r.getData();var o=O.findEntry(t.imageList,i.images);o.each(e=>{""===i.alt||a.prevImage.map(e=>e.text===i.alt).getOr(!1)?""===e.value?r.setData({src:e,alt:a.prevAlt}):r.setData({src:e,alt:e.text}):r.setData({src:e})}),a.prevImage=o,k(e,t,a,r)},It=(o,l,n,s)=>{var e=s.getData();s.block("Uploading image"),Y(e.fileinput).fold(()=>{s.unblock()},t=>{let a=URL.createObjectURL(t),r=()=>{s.unblock(),URL.revokeObjectURL(a)},i=e=>{s.setData({src:{value:e,meta:{}}}),s.showTab("general"),k(o,l,n,s),s.focus("src")};Ae(t).then(e=>{e=o.createBlobCache(t,a,e);l.automaticUploads?o.uploadImage(e).then(e=>{i(e.url),r()}).catch(e=>{r(),o.alertErr(e,()=>{s.focus("fileinput")})}):(o.addToBlobCache(e),i(e.blobUri()),s.unblock())})})},xt=(a,r,i)=>(e,t)=>{"src"===t.name?k(a,r,i,e):"images"===t.name?Ct(a,r,i,e):"alt"===t.name?i.prevAlt=e.getData().alt:"fileinput"===t.name?It(a,r,i,e):"isDecorative"===t.name&&e.setEnabled("alt",!e.getData().isDecorative)},Tt=e=>()=>{e.open=!1},Ut=e=>e.hasAdvTab||e.hasUploadUrl||e.hasUploadHandler?{type:"tabpanel",tabs:y([[ut.makeTab(e)],e.hasAdvTab?[dt.makeTab(e)]:[],e.hasUploadTab&&(e.hasUploadUrl||e.hasUploadHandler)?[pt.makeTab(e)]:[]])}:{type:"panel",items:ut.makeItems(e)},St=(a,r,i)=>e=>{var t=L(bt(r.image),e.getData()),t={...t,style:Ge(i.normalizeCss,vt(t,!1))};a.execCommand("mceUpdateImage",!1,vt(t,r.hasAccessibilityOptions)),a.editorUpload.uploadImagesAuto(),e.close()},Nt=t=>e=>_e(t,e)?ve(t.documentBaseURI.toAbsolute(e)).then(e=>({width:String(e.width),height:String(e.height)})):Promise.resolve({width:"",height:""}),Et=r=>(e,t,a)=>r.editorUpload.blobCache.create({blob:e,blobUri:t,name:null==(t=e.name)?void 0:t.replace(/\.[^\.]+$/,""),filename:e.name,base64:a.split(",")[1]}),Lt=t=>e=>{t.editorUpload.blobCache.add(e)},Ot=a=>(e,t)=>{a.windowManager.alert(e,t)},kt=t=>e=>N(t,e),zt=t=>e=>t.dom.parseStyle(e),Mt=a=>(e,t)=>a.dom.serializeStyle(e,t),jt=t=>e=>at(t).upload([e],!1).then(e=>{var t;return 0===e.length?Promise.reject("Failed to upload image"):!1===e[0].status?Promise.reject(null==(t=e[0].error)?void 0:t.message):e[0]}),z=a=>{let r={imageSize:Nt(a),addToBlobCache:Lt(a),createBlobCache:Et(a),alertErr:Ot(a),normalizeCss:kt(a),parseStyle:zt(a),serializeStyle:Mt(a),uploadImage:jt(a)};return{open:()=>{ct(a).then(e=>{var t=ht(e);return{title:"Insert/Edit Image",size:"normal",body:Ut(e),buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:bt(e.image),onSubmit:St(a,e,r),onChange:xt(r,e,t),onClose:Tt(t)}}).then(a.windowManager.open)}}},Pt=e=>{e=e.attr("class");return s(e)&&/\bimage\b/.test(e)},Rt=i=>e=>{let t=e.length;for(var a=e=>{e.attr("contenteditable",i?"true":null)};t--;){var r=e[t];Pt(r)&&(r.attr("contenteditable",i?"false":null),rt.each(r.getAll("figcaption"),a))}},Bt=a=>e=>{let t=()=>{e.setEnabled(a.selection.isEditable())};return a.on("NodeChange",t),t(),()=>{a.off("NodeChange",t)}};M.add("image",e=>{var t,r,a;(e=>{e=e.options.register;e("image_dimensions",{processor:"boolean",default:!0}),e("image_advtab",{processor:"boolean",default:!1}),e("image_uploadtab",{processor:"boolean",default:!0}),e("image_prepend_url",{processor:"string",default:""}),e("image_class_list",{processor:"object[]"}),e("image_description",{processor:"boolean",default:!0}),e("image_title",{processor:"boolean",default:!1}),e("image_caption",{processor:"boolean",default:!1}),e("image_list",{processor:e=>{var t=!1===e||b(e)||F(e,i)||m(e);return t?{value:e,valid:t}:{valid:!1,message:"Must be false, a string, an array or a function."}},default:!1})})(e),(t=e).on("PreInit",()=>{t.parser.addNodeFilter("figure",Rt(!0)),t.serializer.addNodeFilter("figure",Rt(!1))}),(r=e).ui.registry.addToggleButton("image",{icon:"image",tooltip:"Insert/edit image",onAction:z(r).open,onSetup:e=>{e.setActive(s(E(r)));let t=r.selection.selectorChangedWithUnbind("img:not([data-mce-object]):not([data-mce-placeholder]),figure.image",e.setActive).unbind,a=Bt(r)(e);return()=>{t(),a()}}}),r.ui.registry.addMenuItem("image",{icon:"image",text:"Image...",onAction:z(r).open,onSetup:Bt(r)}),r.ui.registry.addContextMenu("image",{update:e=>r.selection.isEditable()&&(x(e)||Re(e)&&!De(e))?["image"]:[]}),(a=e).addCommand("mceImage",z(a).open),a.addCommand("mceUpdateImage",(e,t)=>{a.undoManager.transact(()=>tt(a,t))})})})();