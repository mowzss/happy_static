(()=>{var t,e=tinymce.util.Tools.resolve("tinymce.PluginManager"),a=tinymce.util.Tools.resolve("tinymce.dom.RangeUtils"),o=tinymce.util.Tools.resolve("tinymce.util.Tools");t="allow_html_in_named_anchor";let n=e=>e.options.get(t),r="a:not([href])",i=e=>!e,l=e=>e.getAttribute("id")||e.getAttribute("name")||"",d=e=>"a"===e.nodeName.toLowerCase(),s=e=>d(e)&&!e.getAttribute("href")&&""!==l(e),c=e=>s(e)&&!e.firstChild,m=e=>{let t=e.dom;a(t).walk(e.selection.getRng(),e=>{o.each(e,e=>{c(e)&&t.remove(e,!1)})})},u=e=>/^[A-Za-z][A-Za-z0-9\-:._]*$/.test(e),h=e=>e.dom.getParent(e.selection.getStart(),r),g=e=>{e=h(e);return e?l(e):""},p=(e,t)=>{e.undoManager.transact(()=>{n(e)||e.selection.collapse(!0),e.selection.isCollapsed()?e.insertContent(e.dom.createHTML("a",{id:t})):(m(e),e.formatter.remove("namedAnchor",void 0,void 0,!0),e.formatter.apply("namedAnchor",{value:t}),e.addVisual())})},b=(e,t,a)=>{a.removeAttribute("name"),a.id=t,e.addVisual(),e.undoManager.add()},v=(e,t)=>{var a=h(e);a?b(e,t,a):p(e,t),e.focus()},y=(e,t)=>u(t)?(v(e,t),!0):(e.windowManager.alert("ID should start with a letter, followed only by letters, numbers, dashes, dots, colons or underscores."),!1),A=t=>{var e=g(t);t.windowManager.open({title:"Anchor",size:"normal",body:{type:"panel",items:[{name:"id",type:"input",label:"ID",placeholder:"example"}]},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:{id:e},onSubmit:e=>{y(t,e.getData().id)&&e.close()}})},f=e=>i(e.attr("href"))&&!i(e.attr("id")||e.attr("name")),C=e=>f(e)&&!e.firstChild,w=o=>t=>{for(let e=0;e<t.length;e++){var a=t[e];C(a)&&a.attr("contenteditable",o)}},_=a=>e=>{let t=()=>{e.setEnabled(a.selection.isEditable())};return a.on("NodeChange",t),t(),()=>{a.off("NodeChange",t)}};e.add("anchor",e=>{var t,a,o,n;(0,e.options.register)("allow_html_in_named_anchor",{processor:"boolean",default:!1}),(t=e).on("PreInit",()=>{t.parser.addNodeFilter("a",w("false")),t.serializer.addNodeFilter("a",w(null))}),(a=e).addCommand("mceAnchor",()=>{A(a)}),n=()=>o.execCommand("mceAnchor"),(o=e).ui.registry.addToggleButton("anchor",{icon:"bookmark",tooltip:"Anchor",onAction:n,onSetup:e=>{let t=o.selection.selectorChangedWithUnbind("a:not([href])",e.setActive).unbind,a=_(o)(e);return()=>{t(),a()}}}),o.ui.registry.addMenuItem("anchor",{icon:"bookmark",text:"Anchor...",onAction:n,onSetup:_(o)}),e.on("PreInit",()=>{e.formatter.register("namedAnchor",{inline:"a",selector:r,remove:"all",split:!0,deep:!0,attributes:{id:"%value"},onmatch:(e,t,a)=>s(e)})})})})();