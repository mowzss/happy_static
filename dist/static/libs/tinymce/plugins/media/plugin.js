(()=>{var t=tinymce.util.Tools.resolve("tinymce.PluginManager");let R=(e,t,r)=>!!r(e,t.prototype)||(null==(r=e.constructor)?void 0:r.name)===t.name,o=(e=r=>e=>{return t=typeof(e=e),(null===e?"null":"object"==t&&Array.isArray(e)?"array":"object"==t&&R(e,String,(e,t)=>t.isPrototypeOf(e))?"string":t)===r;var t})("string"),s=e("object"),E=e("array"),U=e=>null==e,l=e=>!U(e);class n{constructor(e,t){this.tag=e,this.value=t}static some(e){return new n(!0,e)}static none(){return n.singletonNone}fold(e,t){return this.tag?t(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?n.some(e(this.value)):n.none()}bind(e){return this.tag?e(this.value):n.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:n.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw new Error(null!=e?e:"Called getOrDie on None")}static from(e){return l(e)?n.some(e):n.none()}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}n.singletonNone=new n(!1);let L=Array.prototype.push,m=(r,a)=>{for(let e=0,t=r.length;e<t;e++)a(r[e],e)},I=r=>{var a=[];for(let e=0,t=r.length;e<t;++e){if(!E(r[e]))throw new Error("Arr.flatten item "+e+" was not an array, input: "+r);L.apply(a,r[e])}return a},B=e=>{let t=e;return{get:()=>t,set:e=>{t=e}}},G=Object.keys,W=Object.hasOwnProperty,q=(r,a)=>{var o=G(r);for(let e=0,t=o.length;e<t;e++){var i=o[e];a(r[i],i)}},c=(e,t)=>i(e,t)?n.from(e[t]):n.none(),i=(e,t)=>W.call(e,t),H=(e=t=>e=>e.options.get(t))("audio_template_callback"),J=e("video_template_callback"),K=e("iframe_template_callback"),Q=e("media_live_embeds"),V=e("media_filter_html"),X=e("media_url_resolver"),Y=e("media_alt_source"),Z=e("media_poster"),u=e("media_dimensions");var d=tinymce.util.Tools.resolve("tinymce.util.Tools"),e=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),h=tinymce.util.Tools.resolve("tinymce.html.DomParser");let ee=e.DOM,r=e=>e.replace(/px$/,""),te=e=>{var t=e.attr("style"),t=t?ee.parseStyle(t):{};return{type:"ephox-embed-iri",source:e.attr("data-ephox-embed-iri"),altsource:"",poster:"",width:c(t,"max-width").map(r).getOr(""),height:c(t,"max-height").map(r).getOr("")}},p=(t,r)=>{let a={};for(let e=h({validate:!1,forced_root_block:!1},r).parse(t);e;e=e.walk())if(1===e.type){var o=e.name;if(e.attr("data-ephox-embed-iri")){a=te(e);break}a.source||"param"!==o||(a.source=e.attr("movie")),"iframe"!==o&&"object"!==o&&"embed"!==o&&"video"!==o&&"audio"!==o||(a.type||(a.type=o),a=d.extend(e.attributes.map,a)),"source"===o&&(a.source?a.altsource||(a.altsource=e.attr("src")):a.source=e.attr("src")),"img"!==o||a.poster||(a.poster=e.attr("src"))}return a.source=a.source||a.src||"",a.altsource=a.altsource||"",a.poster=a.poster||"",a},g=e=>{e=null!=(e=e.toLowerCase().split(".").pop())?e:"";return c({mp3:"audio/mpeg",m4a:"audio/x-m4a",wav:"audio/wav",mp4:"video/mp4",webm:"video/webm",ogg:"video/ogg",swf:"application/x-shockwave-flash"},e).getOr("")};var b=tinymce.util.Tools.resolve("tinymce.html.Node"),v=tinymce.util.Tools.resolve("tinymce.html.Serializer");let w=(e,t={})=>h({forced_root_block:!1,validate:!1,allow_conditional_comments:!0,...t},e),a=e.DOM,y=e=>/^[0-9.]+$/.test(e)?e+"px":e,re=(e,t)=>{var r=t.attr("style"),r=r?a.parseStyle(r):{};l(e.width)&&(r["max-width"]=y(e.width)),l(e.height)&&(r["max-height"]=y(e.height)),t.attr("style",a.serializeStyle(r))},f=["source","altsource"],x=(e,r,a,t)=>{let o=0,i=0;var l=w(t),l=(l.addNodeFilter("source",e=>o=e.length),l.parse(e));for(let t=l;t;t=t.walk())if(1===t.type){var s,n=t.name;if(t.attr("data-ephox-embed-iri")){re(r,t);break}switch(n){case"video":case"object":case"embed":case"img":case"iframe":void 0!==r.height&&void 0!==r.width&&(t.attr("width",r.width),t.attr("height",r.height))}if(a)switch(n){case"video":t.attr("poster",r.poster),t.attr("src",null);for(let e=o;e<2;e++)r[f[e]]&&((s=new b("source",1)).attr("src",r[f[e]]),s.attr("type",r[f[e]+"mime"]||null),t.append(s));break;case"iframe":t.attr("src",r.source);break;case"object":var c=0<t.getAll("img").length;r.poster&&!c&&(t.attr("src",r.poster),(c=new b("img",1)).attr("src",r.poster),c.attr("width",r.width),c.attr("height",r.height),t.append(c));break;case"source":i<2&&(t.attr("src",r[f[i]]),t.attr("type",r[f[i]+"mime"]||null),!r[f[i]])?t.remove():i++;break;case"img":r.poster||t.remove()}}return v({},t).serialize(l)},ae=[{regex:/youtu\.be\/([\w\-_\?&=.]+)/i,type:"iframe",w:560,h:314,url:"www.youtube.com/embed/$1",allowFullscreen:!0},{regex:/youtube\.com(.+)v=([^&]+)(&([a-z0-9&=\-_]+))?/i,type:"iframe",w:560,h:314,url:"www.youtube.com/embed/$2?$4",allowFullscreen:!0},{regex:/youtube.com\/embed\/([a-z0-9\?&=\-_]+)/i,type:"iframe",w:560,h:314,url:"www.youtube.com/embed/$1",allowFullscreen:!0},{regex:/vimeo\.com\/([0-9]+)\?h=(\w+)/,type:"iframe",w:425,h:350,url:"player.vimeo.com/video/$1?h=$2&title=0&byline=0&portrait=0&color=8dc7dc",allowFullscreen:!0},{regex:/vimeo\.com\/(.*)\/([0-9]+)\?h=(\w+)/,type:"iframe",w:425,h:350,url:"player.vimeo.com/video/$2?h=$3&title=0&amp;byline=0",allowFullscreen:!0},{regex:/vimeo\.com\/([0-9]+)/,type:"iframe",w:425,h:350,url:"player.vimeo.com/video/$1?title=0&byline=0&portrait=0&color=8dc7dc",allowFullscreen:!0},{regex:/vimeo\.com\/(.*)\/([0-9]+)/,type:"iframe",w:425,h:350,url:"player.vimeo.com/video/$2?title=0&amp;byline=0",allowFullscreen:!0},{regex:/maps\.google\.([a-z]{2,3})\/maps\/(.+)msid=(.+)/,type:"iframe",w:425,h:350,url:'maps.google.com/maps/ms?msid=$2&output=embed"',allowFullscreen:!1},{regex:/dailymotion\.com\/video\/([^_]+)/,type:"iframe",w:480,h:270,url:"www.dailymotion.com/embed/video/$1",allowFullscreen:!0},{regex:/dai\.ly\/([^_]+)/,type:"iframe",w:480,h:270,url:"www.dailymotion.com/embed/video/$1",allowFullscreen:!0}],oe=e=>{e=e.match(/^(https?:\/\/|www\.)(.+)$/i);return!(e&&1<e.length)||"www."===e[1]?"https://":e[1]},ie=(e,t)=>{var r=oe(t);let a=e.regex.exec(t),o=r+e.url;if(l(a))for(let e=0;e<a.length;e++)o=o.replace("$"+e,()=>a[e]||"");return o.replace(/\?$/,"")},_=t=>{var e=ae.filter(e=>e.regex.test(t));return 0<e.length?d.extend({},e[0],{url:ie(e[0],t)}):null},le=(e,t)=>t?t(e):(t=e.allowfullscreen?' allowFullscreen="1"':"",'<iframe src="'+e.source+'" width="'+e.width+'" height="'+e.height+'"'+t+"></iframe>"),se=e=>{let t='<object data="'+e.source+'" width="'+e.width+'" height="'+e.height+'" type="application/x-shockwave-flash">';return e.poster&&(t+='<img src="'+e.poster+'" width="'+e.width+'" height="'+e.height+'" />'),t+="</object>"},ne=(e,t)=>t?t(e):'<audio controls="controls" src="'+e.source+'">'+(e.altsource?'\n<source src="'+e.altsource+'"'+(e.altsourcemime?' type="'+e.altsourcemime+'"':"")+" />\n":"")+"</audio>",ce=(e,t)=>t?t(e):'<video width="'+e.width+'" height="'+e.height+'"'+(e.poster?' poster="'+e.poster+'"':"")+' controls="controls">\n<source src="'+e.source+'"'+(e.sourcemime?' type="'+e.sourcemime+'"':"")+" />\n"+(e.altsource?'<source src="'+e.altsource+'"'+(e.altsourcemime?' type="'+e.altsourcemime+'"':"")+" />\n":"")+"</video>",k=(r,e)=>{let t,a=d.extend({},e);if(!a.source&&(d.extend(a,p(null!=(t=a.embed)?t:"",r.schema)),!a.source))return"";a.altsource||(a.altsource=""),a.poster||(a.poster=""),a.source=r.convertURL(a.source,"source"),a.altsource=r.convertURL(a.altsource,"source"),a.sourcemime=g(a.source),a.altsourcemime=g(a.altsource),a.poster=r.convertURL(a.poster,"poster");var o,i,e=_(a.source);return e&&(a.source=e.url,a.type=e.type,a.allowfullscreen=e.allowFullscreen,a.width=a.width||String(e.w),a.height=a.height||String(e.h)),a.embed?x(a.embed,a,!0,r.schema):(e=H(r),o=J(r),i=K(r),a.width=a.width||"300",a.height=a.height||"150",d.each(a,(e,t)=>{a[t]=r.dom.encode(""+e)}),"iframe"===a.type?le(a,i):"application/x-shockwave-flash"===a.sourcemime?se(a):-1!==a.sourcemime.indexOf("audio")?ne(a,e):ce(a,o))},j=e=>e.hasAttribute("data-mce-object")||e.hasAttribute("data-ephox-embed-iri"),O={},me=(a,o,i)=>new Promise((t,e)=>{var r=e=>(e.html&&(O[a.source]=e),t({url:a.source,html:e.html||o(a)}));O[a.source]?r(O[a.source]):i({url:a.source}).then(r).catch(e)}),ue=(e,t)=>Promise.resolve({html:t(e),url:e.source}),A=t=>e=>k(t,e),S=(e,t)=>{var r=X(e);return r?me(t,A(e),r):ue(t,A(e))},de=e=>i(O,e),he=(e,t)=>c(t,e).bind(e=>c(e,"meta")),pe=(o,i,l)=>e=>{let t=()=>c(o,e),r=()=>c(i,e),a=e=>c(e,"value").bind(e=>0<e.length?n.some(e):n.none());return{[e]:(e===l?t().bind(e=>s(e)?a(e).orThunk(r):r().orThunk(()=>n.from(e))):r().orThunk(()=>t().bind(e=>s(e)?a(e):n.from(e)))).getOr("")}},ge=(e,r)=>{let a={};return c(e,"dimensions").each(e=>{m(["width","height"],t=>{c(r,t).orThunk(()=>c(e,t)).each(e=>a[t]=e)})}),a},$=(e,t)=>{var r=t&&"dimensions"!==t?he(t,e).getOr({}):{},t=pe(e,r,t);return{...t("source"),...t("altsource"),...t("poster"),...t("embed"),...ge(e,r)}},C=e=>{let a={...e,source:{value:c(e,"source").getOr("")},altsource:{value:c(e,"altsource").getOr("")},poster:{value:c(e,"poster").getOr("")}};return m(["width","height"],r=>{c(e,r).each(e=>{var t=a.dimensions||{};t[r]=e,a.dimensions=t})}),a},T=t=>e=>{e=e&&e.msg?"Media embed handler error: "+e.msg:"Media embed handler threw unknown error.";t.notificationManager.open({type:"error",text:e})},be=e=>{let t=e.selection.getNode();var r=j(t)?e.serializer.serialize(t,{selection:!0}):"";let a=p(r,e.schema);e=F(a.source,a.type)?{width:(e=e.dom.getRect(t)).w.toString().replace(/px$/,""),height:e.h.toString().replace(/px$/,"")}:{};return{embed:r,...a,...e}},z=(r,a)=>e=>{var t;o(e.url)&&0<e.url.trim().length&&(t=e.html,e={...p(t,a.schema),source:e.url,embed:t},r.setData(C(e)))},ve=(e,r)=>{var a=e.dom.select("*[data-mce-object]");for(let t=0;t<r.length;t++)for(let e=a.length-1;0<=e;e--)r[t]===a[e]&&a.splice(e,1);e.selection.select(a[0])},D=(e,t)=>{var r=e.dom.select("*[data-mce-object]");e.insertContent(t),ve(e,r),e.nodeChanged()},F=(e,t)=>l(t)&&"ephox-embed-iri"===t&&l(_(e)),M=(e,t)=>{var r,a;return a=t,((r=e).width!==a.width||r.height!==a.height)&&F(t.source,e.type)},we=(e,t,r)=>{var a;t.embed=M(e,t)&&u(r)?k(r,{...t,embed:""}):x(null!=(a=t.embed)?a:"",t,!1,r.schema),t.embed&&(e.source===t.source||de(t.source))?D(r,t.embed):S(r,t).then(e=>{D(r,e.html)}).catch(T(r))},N=o=>{var e=be(o);let i=B(e);e=C(e);var t=u(o)?[{type:"sizeinput",name:"dimensions",label:"Constrain proportions",constrain:!0}]:[],t={title:"General",name:"general",items:I([[{name:"source",type:"urlinput",filetype:"media",label:"Source",picker_text:"Browse files"}],t])},r={title:"Embed",items:[{type:"textarea",name:"embed",label:"Paste your embed code below:"}]},a=[],l=(Y(o)&&a.push({name:"altsource",type:"urlinput",filetype:"media",label:"Alternative source URL"}),Z(o)&&a.push({name:"poster",type:"urlinput",filetype:"image",label:"Media poster (Image URL)"}),{title:"Advanced",name:"advanced",items:a}),t=[t,r],r=(0<a.length&&t.push(l),{type:"tabpanel",tabs:t});let s=o.windowManager.open({title:"Insert/Edit Media",size:"normal",body:r,buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],onSubmit:e=>{var t=$(e.getData());we(i.get(),t,o),e.close()},onChange:(e,t)=>{switch(t.name){case"source":((e,t)=>{t=$(t.getData(),"source");e.source!==t.source&&(z(s,o)({url:t.source,html:""}),S(o,t).then(z(s,o)).catch(T(o)))})(i.get(),e);break;case"embed":r=e,a=$(r.getData()),a=p(null!=(a=a.embed)?a:"",o.schema),r.setData(C(a));break;case"dimensions":case"altsource":case"poster":((e,t,r)=>{t=$(e.getData(),t),r=M(r,t)&&u(o)?{...t,embed:""}:t,t=k(o,r);e.setData(C({...r,embed:t}))})(e,t.name,i.get())}var r,a;i.set($(e.getData()))},initialData:e})},ye=(e,t,r)=>""===t||e.length>=t.length&&e.substr(r,r+t.length)===t,fe=(e,t)=>ye(e,t,0);var xe=tinymce.util.Tools.resolve("tinymce.Env");let _e=e=>{e=e.name;return"iframe"===e||"video"===e||"audio"===e},P=(e,t,r,a=null)=>{e=e.attr(r);return l(e)?e:i(t,r)?null:a},ke=(e,t,r)=>{var a="img"===t.name||"video"===e.name,o=a?"300":null,i="audio"===e.name?"30":"150",a=a?i:null;t.attr({width:P(e,r,"width",o),height:P(e,r,"height",a)})},je=(e,t,r,a)=>{for(var o=w(e.schema).parse(a,{context:t});o.firstChild;)r.append(o.firstChild)},Oe=(e,t)=>{var r=t.name,a=new b("img",1);return Se(e,t,a),ke(t,a,{}),a.attr({style:t.attr("style"),src:xe.transparentSrc,"data-mce-object":r,class:"mce-object mce-object-"+r}),a},Ae=(e,t)=>{var r=t.name,a=new b("span",1),o=(a.attr({contentEditable:"false",style:t.attr("style"),"data-mce-object":r,class:"mce-preview-object mce-object-"+r}),Se(e,t,a),e.dom.parseStyle(null!=(o=t.attr("style"))?o:""));let i=new b(r,1);ke(t,i,o),i.attr({src:t.attr("src"),style:t.attr("style"),class:t.attr("class")}),"iframe"===r?i.attr({allowfullscreen:t.attr("allowfullscreen"),frameborder:"0",sandbox:t.attr("sandbox"),referrerpolicy:t.attr("referrerpolicy")}):(o=["controls","crossorigin","currentTime","loop","muted","poster","preload"],m(o,e=>{i.attr(e,t.attr(e))}),o=a.attr("data-mce-html"),l(o)&&je(e,r,i,unescape(o)));e=new b("span",1);return e.attr("class","mce-shim"),a.append(i),a.append(e),a},Se=(t,e,r)=>{var a=null!=(l=e.attributes)?l:[];let o=a.length;for(;o--;){var i=a[o].name;let e=a[o].value;"width"===i||"height"===i||"style"===i||fe(i,"data-mce-")||("data"!==i&&"src"!==i||(e=t.convertURL(e,i)),r.attr("data-mce-p-"+i,e))}var l=v({inner:!0},t.schema);let s=new b("div",1);m(e.children(),e=>s.append(e));e=l.serialize(s);e&&(r.attr("data-mce-html",escape(e)),r.empty())},$e=e=>{e=e.attr("class");return o(e)&&/\btiny-pageembed\b/.test(e)},Ce=e=>{let t=e;for(;t=t.parent;)if(t.attr("data-ephox-embed-iri")||$e(t))return!0;return!1},Te=a=>e=>{let t=e.length;for(var r;t--;)!(r=e[t]).parent||r.parent.attr("data-mce-object")||(_e(r)&&Q(a)?Ce(r)||r.replace(Ae(a,r)):Ce(r)||r.replace(Oe(a,r)))},ze=(e,t,r)=>{var a=(0,e.options.get)("xss_sanitization"),o=V(e);return w(e.schema,{sanitize:a,validate:o}).parse(r,{context:t})},De=r=>e=>{let t=()=>{e.setEnabled(r.selection.isEditable())};return r.on("NodeChange",t),t(),()=>{r.off("NodeChange",t)}};t.add("media",e=>{var t,o,r,c,a,i;return(e=>{e=e.options.register;e("audio_template_callback",{processor:"function"}),e("video_template_callback",{processor:"function"}),e("iframe_template_callback",{processor:"function"}),e("media_live_embeds",{processor:"boolean",default:!0}),e("media_filter_html",{processor:"boolean",default:!0}),e("media_url_resolver",{processor:"function"}),e("media_alt_source",{processor:"boolean",default:!0}),e("media_poster",{processor:"boolean",default:!0}),e("media_dimensions",{processor:"boolean",default:!0})})(e),(t=e).addCommand("mceMedia",()=>{N(t)}),r=()=>o.execCommand("mceMedia"),(o=e).ui.registry.addToggleButton("media",{tooltip:"Insert/edit media",icon:"embed",onAction:r,onSetup:e=>{var t=o.selection;e.setActive(j(t.getNode()));let r=t.selectorChangedWithUnbind("img[data-mce-object],span[data-mce-object],div[data-ephox-embed-iri]",e.setActive).unbind,a=De(o)(e);return()=>{r(),a()}}}),o.ui.registry.addMenuItem("media",{icon:"embed",text:"Media...",onAction:r,onSetup:De(o)}),e.on("ResolveName",e=>{let t;1===e.target.nodeType&&(t=e.target.getAttribute("data-mce-object"))&&(e.name=t)}),(c=e).on("PreInit",()=>{let{schema:a,serializer:e,parser:t}=c,r=a.getBoolAttrs();m("webkitallowfullscreen mozallowfullscreen".split(" "),e=>{r[e]={}}),q({embed:["wmode"]},(e,t)=>{let r=a.getElementRule(t);r&&m(e,e=>{r.attributes[e]={},r.attributesOrder.push(e)})}),t.addNodeFilter("iframe,video,audio,object,embed",Te(c)),e.addAttributeFilter("data-mce-object",(e,r)=>{let a,t=e.length;for(;t--;){var o=e[t];if(o.parent){var i=o.attr(r);let t=new b(i,1);"audio"!==i&&((n=o.attr("class"))&&-1!==n.indexOf("mce-preview-object")&&o.firstChild?t.attr({width:o.firstChild.attr("width"),height:o.firstChild.attr("height")}):t.attr({width:o.attr("width"),height:o.attr("height")})),t.attr({style:o.attr("style")});var l=null!=(a=o.attributes)?a:[];let e=l.length;for(;e--;){var s=l[e].name;0===s.indexOf("data-mce-p-")&&t.attr(s.substr(11),l[e].value)}var n=o.attr("data-mce-html");n&&(i=ze(c,i,unescape(n)),m(i.children(),e=>t.append(e))),o.replace(t)}}})}),c.on("SetContent",()=>{let t=c.dom;m(t.select("span.mce-preview-object"),e=>{0===t.select("span.mce-shim",e).length&&t.add(e,"span",{class:"mce-shim"})})}),(a=e).on("mousedown",e=>{var t=a.dom.getParent(e.target,".mce-preview-object");t&&"2"===a.dom.getAttrib(t,"data-mce-selected")&&e.stopImmediatePropagation()}),a.on("click keyup touchend",()=>{var e=a.selection.getNode();e&&a.dom.hasClass(e,"mce-preview-object")&&a.dom.getAttrib(e,"data-mce-selected")&&e.setAttribute("data-mce-selected","2")}),a.on("ObjectResized",e=>{var t,r=e.target;r.getAttribute("data-mce-object")&&(t=r.getAttribute("data-mce-html"))&&(t=unescape(t),r.setAttribute("data-mce-html",escape(x(t,{width:String(e.width),height:String(e.height)},!1,a.schema))))}),i=e,{showDialog:()=>{N(i)}}})})();