<!DOCTYPE html><html><head><meta charset="UTF-8"><title>系统安装</title><link rel="stylesheet" href="/static/libs/layui/css/layui.css"><style>
        body {
            background-color: #f2f2f2;
        }

        .layui-btn-container {
            margin: 40px 0 0;
            text-align: center;
        }
    </style></head><body><div class="layui-container" style="margin-top: 50px;"><div class="layui-row layui-col-space20"><div class="layui-col-md6 layui-col-md-offset3"><div class="layui-card"><div class="layui-card-header">环境检测</div><div class="layui-card-body"><table class="layui-table" id="environment-check"></table><blockquote id="tips" class="layui-elem-quote layui-font-red layui-hide"></blockquote><div class="layui-btn-container"> <button type="button" class="layui-btn layui-bg-green layui-btn-disabled" id="next">下一步</button> <button type="button" class="layui-btn layui-btn-primary" id="refresh"> 刷新检测结果</button></div></div></div></div></div></div><script src="/static/libs/layui/layui.js"></script><script>
    layui.use(['form', 'jquery'], function () {

        var $ = layui.jquery;
        $('#refresh').click(function () {
            displayEnvironmentStatus();
        })
        $('#next').click(function () {
            window.location.href = '{:urls("install/index/data")}';
        })

        function displayEnvironmentStatus() {
            $.ajax({
                url: '{:urls("checkEnvironment")}', // 确保这里的URL指向正确的API
                type: 'GET',
                success: function (response) {
                    if (response.status === 'success') {
                        var envCheckTable = $('#environment-check');
                        envCheckTable.empty(); // 清空之前的检测结果
                        envCheckTable.append('<thead><tr><th>检查项</th><th>状态</th></tr></thead><tbody>');

                        for (var requirement in response.requirements) {
                            var statusClass = response.requirements[requirement] === '支持' ? 'layui-font-green' : 'layui-font-red';
                            envCheckTable.append('<tr><td>' + requirement + '</td><td class="' + statusClass + '">' + response.requirements[requirement] + '</td></tr>');
                        }

                        envCheckTable.append('</tbody>');
                        if (response.passed) {
                            $('#next').removeClass('layui-btn-disabled');
                            $('#refresh').text('✅️环境检查通过');
                            layer.msg('环境检测通过，请点击下一步继续', {icon: 1});
                        } else {
                            $('#tips').removeClass('layui-hide').text('环境检测未通过，请配置后再试');
                        }
                    } else {
                        layer.msg('网络错误，请稍后再试', {icon: 2});
                    }
                },
                error: function () {
                    layer.msg('请求失败，请重试', {icon: 2});
                }
            });
        }

        // 页面加载完成后自动执行一次环境检测
        $(document).ready(function () {
            displayEnvironmentStatus();
        });
    });
</script></body></html>