{extend name="../layout" /} {block name="css"}<style>
</style> {/block} {block name="content"}<div class="layui-row layui-col-space15"><div class="layui-col-md6"><div class="layui-card"><div class="layui-card-header">今日蜘蛛爬取数据占比</div><div class="layui-card-body"><div id="pieChart" style="height:400px;"></div></div></div></div><div class="layui-col-md6"><div class="layui-card"><div class="layui-card-header">昨日与今日各蜘蛛爬取对比</div><div class="layui-card-body"><div id="barChart" style="height:400px;"></div></div></div></div></div><div class="layui-row layui-col-space15"><div class="layui-col-md12"><div class="layui-card"><div class="layui-card-header">最近七天趋势</div><div class="layui-card-body"><div id="lineChart" style="height:400px;"></div></div></div></div></div><div id="chartData" class="layui-hide">{$chartData|raw}</div> {/block} {block name="js"}<script type="text/javascript">
    layui.use(['echarts', 'jquery'], function () {
        var $ = layui.jquery;
        var chartData = JSON.parse($('#chartData').text());

        // 使用ECharts绘制饼图（保持不变）
        var pieChart = echarts.init(document.getElementById('pieChart'));
        pieChart.setOption({
            tooltip: {
                trigger: 'item'
            },
            legend: {
                orient: 'vertical',
                left: 'left'
            },
            series: [
                {
                    name: '访问量',
                    type: 'pie',
                    radius: '50%',
                    data: chartData.today_pie_chart,
                    emphasis: {
                        itemStyle: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }
            ]
        });

        // 使用ECharts绘制柱状图：蜘蛛为X轴，每组显示今日/昨日柱子
        var barChart = echarts.init(document.getElementById('barChart'));

        // 准备数据
        let xAxisData = [];
        let todayData = [];
        let yesterdayData = [];

        chartData.yesterday_today_compare.forEach(function (item) {
            xAxisData.push(item.name);
            yesterdayData.push(item.yesterday);
            todayData.push(item.today);
        });

        barChart.setOption({
            tooltip: {
                trigger: 'axis'
            },
            legend: {
                data: ['昨日', '今日']
            },
            xAxis: {
                type: 'category',
                data: xAxisData
            },
            yAxis: {
                type: 'value'
            },
            series: [
                {
                    name: '昨日',
                    type: 'bar',
                    data: yesterdayData
                },
                {
                    name: '今日',
                    type: 'bar',
                    data: todayData
                }
            ]
        });

        // 使用ECharts绘制折线图（保持不变）
        var lineChart = echarts.init(document.getElementById('lineChart'));
        var seriesLine = [];
        for (var name in chartData.seven_days_trend.data) {
            seriesLine.push({
                name: name,
                type: 'line',
                data: chartData.seven_days_trend.data[name]
            });
        }
        lineChart.setOption({
            tooltip: {
                trigger: 'axis'
            },
            legend: {
                data: Object.keys(chartData.seven_days_trend.data)
            },
            xAxis: {
                type: 'category',
                data: chartData.seven_days_trend.dates
            },
            yAxis: {
                type: 'value'
            },
            series: seriesLine
        });
    });
</script> {/block}