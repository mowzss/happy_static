{extend name="../layout" /}
{block name="css"}
<style>
</style>
{/block}
{block name="content"}
<!-- 饼图 -->
<div class="layui-row layui-col-space15">
    <div class="layui-col-md6">
        <div class="layui-card">
            <div class="layui-card-header">今日蜘蛛爬取数据占比</div>
            <div class="layui-card-body">
                <div id="pieChart" style="height:400px;"></div>
            </div>
        </div>
    </div>

    <!-- 柱状图 -->
    <div class="layui-col-md6">
        <div class="layui-card">
            <div class="layui-card-header">昨日与今日各蜘蛛爬取对比</div>
            <div class="layui-card-body">
                <div id="barChart" style="height:400px;"></div>
            </div>
        </div>
    </div>
</div>
<!-- 每小时趋势对比 -->
<div class="layui-row layui-col-space15" style="margin-top: 20px;">
    <div class="layui-col-md12">
        <div class="layui-card">
            <div class="layui-card-header">分时数据</div>
            <div class="layui-card-body">
                <div id="hourlyChart" style="height:400px;"></div>
            </div>
        </div>
    </div>
</div>
<!-- 折线图 -->
<div class="layui-row layui-col-space15">
    <div class="layui-col-md12">
        <div class="layui-card">
            <div class="layui-card-header">最近七天趋势</div>
            <div class="layui-card-body">
                <div id="lineChart" style="height:400px;"></div>
            </div>
        </div>
    </div>
</div>
<div id="chartData" class="layui-hide">{$chartData|raw}</div>
{/block}
{block name="js"}
<script type="text/javascript">
    layui.use(['echarts', 'jquery'], function () {
        var $ = layui.jquery;
        var chartData = JSON.parse($('#chartData').text());

        // 使用ECharts绘制饼图（修改版 - 显示扇区间隙）
        var pieChart = echarts.init(document.getElementById('pieChart'));
        pieChart.setOption({
            tooltip: {
                trigger: 'item'
            },
            legend: {
                orient: 'vertical',
                left: 'left'
            },
            series: [
                {
                    name: '访问量',
                    type: 'pie',
                    radius: ['40%', '70%'], // 设置内外圆半径比例，形成空心效果
                    itemStyle: {
                        borderRadius: 5,     // 扇区圆角（可选）
                        borderColor: '#fff', // 设置扇区间隔的颜色（模拟间隙）
                        borderWidth: 2       // 设置边框宽度，越大间隙越明显
                    },
                    data: chartData.today_pie_chart,
                    emphasis: {
                        itemStyle: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    }
                }
            ]
        });

        // 使用ECharts绘制柱状图：蜘蛛为X轴，每组显示今日/昨日柱子
        var barChart = echarts.init(document.getElementById('barChart'));

        // 准备数据
        let xAxisData = [];
        let todayData = [];
        let yesterdayData = [];

        chartData.yesterday_today_compare.forEach(function (item) {
            xAxisData.push(item.name);
            yesterdayData.push(item.yesterday);
            todayData.push(item.today);
        });

        barChart.setOption({
            tooltip: {
                trigger: 'axis'
            },
            legend: {
                data: ['昨日', '今日']
            },
            xAxis: {
                type: 'category',
                data: xAxisData
            },
            yAxis: {
                type: 'value'
            },
            series: [
                {
                    name: '昨日',
                    type: 'bar',
                    data: yesterdayData
                },
                {
                    name: '今日',
                    type: 'bar',
                    data: todayData
                }
            ]
        });

        // 使用ECharts绘制折线图（保持不变）
        var lineChart = echarts.init(document.getElementById('lineChart'));
        var seriesLine = [];
        for (var name in chartData.seven_days_trend.data) {
            seriesLine.push({
                name: name,
                type: 'line',
                data: chartData.seven_days_trend.data[name]
            });
        }
        lineChart.setOption({
            tooltip: {
                trigger: 'axis'
            },
            legend: {
                data: Object.keys(chartData.seven_days_trend.data)
            },
            xAxis: {
                type: 'category',
                data: chartData.seven_days_trend.dates
            },
            yAxis: {
                type: 'value'
            },
            series: seriesLine
        });
// 使用ECharts绘制每小时趋势对比图（按蜘蛛分组）
        var hourlyChart = echarts.init(document.getElementById('hourlyChart'));

        var hours = chartData.hourly_trend_by_spider.hours;
        var spiderData = chartData.hourly_trend_by_spider.spiderData;

        var series = [];

        spiderData.forEach(function (spider) {
            // 今日数据
            series.push({
                name: spider.name + '（今日）',
                type: 'line',
                data: spider.today,
                smooth: true
            });

            // 昨日数据
            series.push({
                name: spider.name + '（昨日）',
                type: 'line',
                data: spider.yesterday,
                lineStyle: {type: 'dashed'},
                smooth: true
            });
        });

        hourlyChart.setOption({
            tooltip: {
                trigger: 'axis'
            },
            legend: {
                data: series.map(s => s.name),
                bottom: 10
            },
            xAxis: {
                type: 'category',
                data: hours
            },
            yAxis: {
                type: 'value'
            },
            series: series,
            grid: {
                bottom: 80
            }
        });
    });

</script>
{/block}
