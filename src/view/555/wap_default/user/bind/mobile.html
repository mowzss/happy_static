{extend name="form" /} {block name="content"}<form class="layui-form layui-form-pane" action="{:url()}" data-auto method="post"><div class="layui-form-item"><div class="layui-inline"> <label class="layui-form-label">手机号</label><div class="layui-input-block"> <input type="tel" name="phone" value="{$userdb.mobile|default=''}" required lay-verify="required|phone" autocomplete="off" class="layui-input bind-phone"></div></div></div><div class="layui-form-item"> <label class="layui-form-label">验证码</label><div class="layui-input-block"> <input type="text" name="vercode" required autocomplete="off" class="layui-input"></div><div class="layui-form-mid" style="padding: 0!important;"> <button type="button" class="layui-btn layui-btn-primary" lay-on="get-vercode">获取验证码</button></div></div> {if !empty($userdb.mobile) && $userdb.mobile_status==1}<div class="layui-form-item"><div class="layui-inline"> <label class="layui-form-label">原手机号</label><div class="layui-input-block"> <input type="text" name="old_phone" required lay-verify="required|phone" autocomplete="off" class="layui-input"></div><div class="layui-form-mid layui-word-aux">请填写已认证的完整手机号: {:hide_info($userdb.mobile)}</div></div></div> {/if}<div class="layui-form-item"><div class="layui-input-block"> <button class="layui-btn" lay-submit>提交绑定</button> <button type="reset" class="layui-btn layui-btn-primary">重置</button></div></div></form> {/block} {block name="footer_js"}<script type="text/javascript">
    // 发送验证码
    layui.util.on('lay-on', {
        "get-vercode": function (othis) {
            var isValid = form.validate('.bind-phone');
            var phone = $(".bind-phone");
            if (isValid) {
                $.ajax({
                    url: "{:url('getCode')}",
                    data: {
                        phone: phone.val(),
                        type: 'mobile'
                    },
                    type: 'post',
                    success: function (result) {
                        if (result.code === 1) {
                            $.msg.success(result.info)
                        } else {
                            $.msg.error(result.info)
                        }
                    }
                });
            }
        }
    });
</script> {/block}