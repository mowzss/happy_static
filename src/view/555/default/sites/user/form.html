{extend name="../common/layout" /}
{block name='content'}
<div class="layui-card">
    <div class="layui-card-header">信息提交</div>
    <div class="layui-card-body">
        <form action="{:url()}" class="layui-form" data-auto="true" method="post">
            <!--基本信息-->
            <fieldset class="layui-elem-field layui-form-item layui-bg-gray">
                <legend class="layui-bg-green layui-font-12">基本信息</legend>
                <div class="layui-field-box">
                    <div class="layui-form-item">
                        <label class="layui-form-label">网站地址</label>
                        <div class="layui-input-block">
                            <input class="layui-input" id="site_url" lay-verify="url" name="site_url"
                                   placeholder="请输入网站地址"
                                   required value='{$vo.site_url|default=""}'>
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <label class="layui-form-label">网站名称</label>
                        <div class="layui-input-block">
                            <input class="layui-input" name="title" placeholder="请输入网站名称" required
                                   value='{$vo.title|default=""}'>
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <label class="layui-form-label">网站简介</label>
                        <div class="layui-input-block">
                    <textarea class="layui-textarea" name="content"
                              placeholder="请输入简介">{$vo.content|default=''}</textarea>
                        </div>
                    </div>

                    <div class="layui-form-item">
                        <div class="layui-col-xs4">
                            <label class="layui-form-label">网站截图</label>
                            <div class="layui-input-block">
                                <input class="data-upload" data-max-height="1024" data-max-width="2048" name="picurl"
                                       type="hidden" value="{$vo.picurl|default=''}">
                                <button class="layui-btn layui-btn-sm layui-btn-primary"
                                        data-cut-width="1376" data-field="picurl"
                                        data-file="btn" data-title="上传图片" data-type="jpg,png,jpeg"
                                        type="button">
                                    <i class="layui-icon">&#xe67c;</i>上传图片
                                </button>
                                <div class="layui-upload-list">
                                    <img class="layui-upload-img" data-tips-image id="picurl">
                                </div>
                            </div>
                        </div>
                        <div class="layui-col-xs4">
                            <label class="layui-form-label">网站LOGO</label>
                            <div class="layui-input-block">
                                <input class="data-upload" data-max-height="512" data-max-width="512" name="logo"
                                       type="hidden" value="{$vo.logo|default=''}">
                                <button class="layui-btn layui-btn-sm layui-btn-primary" data-field="logo"
                                        data-file="btn" data-title="上传图片" data-type="jpg,png,jpeg"
                                        type="button">
                                    <i class="layui-icon">&#xe67c;</i>上传图片
                                </button>
                                <div class="layui-upload-list">
                                    <img class="layui-upload-img" data-tips-image id="logo">
                                </div>
                            </div>
                        </div>
                        <div class="layui-col-xs4">
                            <label class="layui-form-label">网站ICO</label>
                            <div class="layui-input-block">
                                <input class="data-upload" data-max-height="200" data-max-width="200" name="icon"
                                       type="hidden" value="{$vo.icon|default=''}">
                                <button class="layui-btn layui-btn-sm layui-btn-primary" data-field="logo"
                                        data-file="btn" data-title="上传图片" data-type='png,jpg,gif,jpeg,ico'
                                        type="button">
                                    <i class="layui-icon">&#xe67c;</i>上传图片
                                </button>
                                <div class="layui-upload-list">
                                    <img class="layui-upload-img" data-tips-image id="icon">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </fieldset>
            <!--分类属性-->
            <fieldset class="layui-elem-field layui-form-item layui-bg-gray">
                <legend class="layui-bg-green layui-font-12">分类属性</legend>
                <div class="layui-field-box">
                    <div class="layui-form-item">
                        <div class="layui-inline">
                            <label class="layui-form-label">选择分类</label>
                            <div class="layui-inline">
                                <input id="cid" name="cid" value="{$vo.cid|default=''}">
                            </div>
                        </div>
                        <div class="layui-inline">
                            <label class="layui-form-label">所属地域</label>
                            <div class="layui-inline">
                                <input id="area_id" name="area_id" value="{$vo.area_id|default=''}">
                            </div>
                        </div>
                    </div>


                    <div class="layui-form-item">
                        <label class="layui-form-label">标签</label>
                        <div class="layui-input-block">
                            <div id="tag"></div>
                        </div>
                    </div>
                </div>
            </fieldset>

            <div class="hr-line-dashed"></div>
            {notempty name='vo.id'}<input name='id' type='hidden' value='{$vo.id}'>{/notempty}
            <div class="layui-form-item text-center">
                <button class="layui-btn" type="submit">提交信息</button>
                <button class="layui-btn layui-btn-danger" data-confirm="确定要取消编辑吗？" data-history-back
                        type='button'>
                    取消编辑
                </button>
            </div>
        </form>
    </div>
</div>

{/block}
{block name='footer_js'}
<script>
    layui.use(['xmSelect', 'Cascader', 'layer', 'jquery'], function () {
        let xmSelect = layui.xmSelect, layCascader = layui.Cascader, $ = layui.jquery, layer = layui.layer;
        $('.data-upload').on('change', function (value) {
            $(this).siblings('.layui-upload-list').children().attr('src', this.value)
        });
        $("#site_url").change(function () {
            let url = $(this).val();
            $.ajax({
                url: '{:url(\'getSiteRepeat\')}',
                type: 'get',
                data: {
                    url: url
                },
                dataType: 'json',
                success: function (res) {
                    if (res.code === 0) {
                        $.msg.error(res.info)
                        $('#site-auto').hide();
                    } else {
                        $.msg.success(res.info)
                    }
                }
            });
        })
        let cate = new layCascader({
            elem: '#cid',
            options: JSON.parse('{$cates|raw}'),
            value: parseInt('{$vo.cid|default=""}'),
            filterable: true,
            props: {
                expandTrigger: 'hover'
                , value: 'id'
                , label: 'title'
                , children: 'sub'
            }
        });
        let area = new layCascader({
            elem: '#area_id',
            options: JSON.parse('{$areas|raw}'),
            value: parseInt('{$vo.area_id|default=""}'),
            filterable: true,
            props: {
                expandTrigger: 'hover'
                , value: 'id'
                , label: 'short'
                , children: 'sub'
            }
        });
        xmSelect.render({
            el: '#tag',
            name: 'tag',
            autoRow: true,
            toolbar: {show: true},
            filterable: true,
            empty: '输入内容搜一下吧！',
            max: 5,
            paging: true,
            pageRemote: true,
            prop: {
                name: 'title',
                value: 'id',
            },
            data: JSON.parse('{$vo.tag|raw|default="[]"}'),
            maxMethod(seles, item) {
                layer.msg('最多选择5个标签')
            },
            remoteSearch: true,
            remoteMethod: function (val, cb, show, pageIndex) {
                if (!val) {
                    return cb([]);
                }
                $.ajax({
                    url: '{:url(\'getTag\')}',
                    data: {page: pageIndex, title: val, add: true},
                    type: 'post',
                    datatype: 'json',
                    success: function (res) {
                        let ret = res.data
                        cb(ret.data, ret.last_page)
                    }
                })
            },
        });
    })
</script>
{/block}
